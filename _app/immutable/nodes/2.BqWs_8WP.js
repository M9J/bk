import{t as L,a as N,c as re}from"../chunks/CyOrqUXm.js";import{i as J}from"../chunks/CL0QEqD9.js";import{A as Q,l as $,a0 as Ce,$ as Be,x as Re,i as Ve,g as x,N as se,y as Oe,z as ce,B as Z,m as P,ad as Te,C as be,j as ke,D as Fe,ah as Ae,a8 as je,F as D,ap as ve,aq as X,a2 as de,ar as Me,as as Pe,at as ze,ag as De,au as Ue,k as He,av as Ye,aw as Je,ab as Ge,ax as Ke,ay as qe,az as We,aA as Qe,aj as ye,aB as Ze,p as G,s as k,v as _,w as I,t as V,q as K,J as Y,o as M,aC as Xe,aD as ee}from"../chunks/DZpqQ712.js";import{p as fe,i as w,s as j,a as q,b as ea}from"../chunks/B8VvTqyC.js";import{o as Ne,w as H,g as ue}from"../chunks/HU1d89I3.js";import{l as aa,e as ne,s as O}from"../chunks/DUnFqAGD.js";function oe(t,a){return a}function ta(t,a,e,r){for(var s=[],n=a.length,i=0;i<n;i++)ze(a[i].e,s,!0);var o=n>0&&s.length===0&&e!==null;if(o){var v=e.parentNode;De(v),v.append(e),r.clear(),R(t,a[0].prev,a[n-1].next)}Ue(s,()=>{for(var p=0;p<n;p++){var l=a[p];o||(r.delete(l.k),R(t,l.prev,l.next)),He(l.e,!o)}})}function ie(t,a,e,r,s,n=null){var i=t,o={flags:a,items:new Map,first:null};{var v=t;i=$?Q(Ce(v)):v.appendChild(Be())}$&&Re();var p=null,l=!1,m=se(()=>{var h=e();return je(h)?h:h==null?[]:Ae(h)});Ve(()=>{var h=x(m),d=h.length;if(l&&d===0)return;l=d===0;let u=!1;if($){var b=i.data===Oe;b!==(d===0)&&(i=ce(),Q(i),Z(!1),u=!0)}if($){for(var g=null,c,f=0;f<d;f++){if(P.nodeType===8&&P.data===Te){i=P,u=!0,Z(!1);break}var A=h[f],y=r(A,f);c=xe(P,o,g,null,A,y,f,s,a,e),o.items.set(y,c),g=c}d>0&&Q(ce())}$||ra(h,o,i,s,a,r,e),n!==null&&(d===0?p?be(p):p=ke(()=>n(i)):p!==null&&Fe(p,()=>{p=null})),u&&Z(!0),x(m)}),$&&(i=P)}function ra(t,a,e,r,s,n,i){var o=t.length,v=a.items,p=a.first,l=p,m,h=null,d=[],u=[],b,g,c,f;for(f=0;f<o;f+=1){if(b=t[f],g=n(b,f),c=v.get(g),c===void 0){var A=l?l.e.nodes_start:e;h=xe(A,a,h,h===null?a.first:h.next,b,g,f,r,s,i),v.set(g,h),d=[],u=[],l=h.next;continue}if(sa(c,b,f),(c.e.f&X)!==0&&be(c.e),c!==l){if(m!==void 0&&m.has(c)){if(d.length<u.length){var y=u[0],E;h=y.prev;var T=d[0],S=d[d.length-1];for(E=0;E<d.length;E+=1)he(d[E],y,e);for(E=0;E<u.length;E+=1)m.delete(u[E]);R(a,T.prev,S.next),R(a,h,T),R(a,S,y),l=y,h=S,f-=1,d=[],u=[]}else m.delete(c),he(c,l,e),R(a,c.prev,c.next),R(a,c,h===null?a.first:h.next),R(a,h,c),h=c;continue}for(d=[],u=[];l!==null&&l.k!==g;)(l.e.f&X)===0&&(m??(m=new Set)).add(l),u.push(l),l=l.next;if(l===null)continue;c=l}d.push(c),h=c,l=c.next}if(l!==null||m!==void 0){for(var C=m===void 0?[]:Ae(m);l!==null;)(l.e.f&X)===0&&C.push(l),l=l.next;var B=C.length;if(B>0){var F=o===0?e:null;ta(a,C,F,v)}}de.first=a.first&&a.first.e,de.last=h&&h.e}function sa(t,a,e,r){Pe(t.v,a),t.i=e}function xe(t,a,e,r,s,n,i,o,v,p){var l=(v&Ye)!==0,m=(v&Je)===0,h=l?m?D(s):ve(s):s,d=(v&Me)===0?i:ve(i),u={i:d,v:h,k:n,a:null,e:null,prev:e,next:r};try{return u.e=ke(()=>o(t,h,d,p),$),u.e.prev=e&&e.e,u.e.next=r&&r.e,e===null?a.first=u:(e.next=u,e.e.next=u.e),r!==null&&(r.prev=u,r.e.prev=u.e),u}finally{}}function he(t,a,e){for(var r=t.next?t.next.e.nodes_start:e,s=a?a.e.nodes_start:e,n=t.e.nodes_start;n!==r;){var i=Ge(n);s.before(n),n=i}}function R(t,a,e){a===null?t.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const pe=[...` 	
\r\f \v\uFEFF`];function na(t,a,e){var r=""+t;if(e){for(var s in e)if(e[s])r=r?r+" "+s:s;else if(r.length)for(var n=s.length,i=0;(i=r.indexOf(s,i))>=0;){var o=i+n;(i===0||pe.includes(r[i-1]))&&(o===r.length||pe.includes(r[o]))?r=(i===0?"":r.substring(0,i))+r.substring(o+1):i=o}}return r===""?null:r}function oa(t,a,e,r,s,n){var i=t.__className;if($||i!==e||i===void 0){var o=na(e,r,n);(!$||o!==t.getAttribute("class"))&&(o==null?t.removeAttribute("class"):t.className=o),t.__className=e}else if(n&&s!==n)for(var v in n){var p=!!n[v];(s==null||p!==!!s[v])&&t.classList.toggle(v,p)}return n}const ia=Symbol("is custom element"),la=Symbol("is html");function z(t,a,e,r){var s=ca(t);$&&(s[a]=t.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&t.nodeName==="LINK")||s[a]!==(s[a]=e)&&(a==="loading"&&(t[qe]=e),e==null?t.removeAttribute(a):typeof e!="string"&&va(t).includes(a)?t[a]=e:t.setAttribute(a,e))}function ca(t){return t.__attributes??(t.__attributes={[ia]:t.nodeName.includes("-"),[la]:t.namespaceURI===Ke})}var me=new Map;function va(t){var a=me.get(t.nodeName);if(a)return a;me.set(t.nodeName,a=[]);for(var e,r=t,s=Element.prototype;s!==r;){e=Qe(r);for(var n in e)e[n].set&&a.push(n);r=We(r)}return a}function Ie(t,a,e){if(t.multiple)return ua(t,a);for(var r of t.options){var s=U(r);if(Ze(s,a)){r.selected=!0;return}}(!e||a!==void 0)&&(t.selectedIndex=-1)}function da(t,a){ye(()=>{var e=new MutationObserver(()=>{var r=t.__value;Ie(t,r)});return e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function fa(t,a,e=a){var r=!0;aa(t,"change",s=>{var n=s?"[selected]":":checked",i;if(t.multiple)i=[].map.call(t.querySelectorAll(n),U);else{var o=t.querySelector(n)??t.querySelector("option:not([disabled])");i=o&&U(o)}e(i)}),ye(()=>{var s=a();if(Ie(t,s,r),r&&s===void 0){var n=t.querySelector(":checked");n!==null&&(s=U(n),e(s))}t.__value=s,r=!1}),da(t)}function ua(t,a){for(var e of t.options)e.selected=~a.indexOf(U(e))}function U(t){return"__value"in t?t.__value:t.value}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ee={faviconSize:128,faviconFetchServiceURL:t=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${t}&size=${Ee.faviconSize}`};async function ha(){const a="/bk"+"/bookmarks";try{const e=await fetch(a+"/index.json");if(e){const r=await e.json();if(Array.isArray(r)?r.length>0:!1){const i=r.sort().map(o=>fetch(a+"/"+o+".json").then(v=>v.json()).then(v=>(v.bookmarkIndexName=o,v)));return await Promise.all(i)}}}catch(e){console.error("bookmarks folder or bookmarks/index.json not found. Error:",e)}}async function pa(t){const a={};if(Array.isArray(t)?t.length>0:!1)for(let r=0;r<t.length;r++){const s=t[r],n=s.LINK,i=s.ICON;let o="";if(i)o=i;else if(n){const v=new URL(n),p=v.protocol+"//"+v.hostname;o=Ee.faviconFetchServiceURL(p)}else o=Le;s.bookmarkIndexName&&(a[s.bookmarkIndexName]=o)}return a}var ma=L('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),ga=L('<div class="bk-title svelte-1jzx7ns"> </div>'),_a=L('<div class="bk-desc svelte-1jzx7ns"> </div>'),ba=L('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function ge(t,a){G(a,!1);let e=fe(a,"bookmark",8),r=fe(a,"faviconLink",8);const s=e().LINK||"javascript:void(0)";let n=e().NAME||e().LINK;function i(c){const f=c==null?void 0:c.target;f&&(f.src=Le)}J();var o=ba();z(o,"href",s),z(o,"title",n);var v=k(o),p=k(v),l=k(p);_(p);var m=I(p,2);{var h=c=>{var f=ma(),A=k(f),y=k(A,!0);_(A);var E=I(A,2),T=k(E,!0);_(E),_(f),V(()=>{O(y,e().NAME),O(T,e().LINK)}),N(c,f)};w(m,c=>{e().IS_PINNED||c(h)})}_(v);var d=I(v,2);{var u=c=>{var f=ga(),A=k(f,!0);_(f),V(()=>O(A,e().TITLE)),N(c,f)};w(d,c=>{e().TITLE&&c(u)})}var b=I(d,2);{var g=c=>{var f=_a(),A=k(f,!0);_(f),V(()=>O(A,e().DESC)),N(c,f)};w(b,c=>{e().DESC&&c(g)})}_(o),V(()=>{z(o,"data-bookmark-icon",e().ICON),z(l,"src",r())}),ne("error",l,i),N(t,o),K()}var ka=L('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),Aa=L('<div class="bk-container-grid svelte-1uu4y0a"></div>'),ya=L('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Na(t,a){G(a,!1);let e=[],r=D([]),s=D([]),n=D({});async function i(){const d=await ha();d&&(e=d.sort((b,g)=>b.NAME.localeCompare(g.NAME)),Y(r,e.filter(b=>b.IS_PINNED)),Y(s,e.filter(b=>!b.IS_PINNED)))}Ne(async()=>{await i();const d=await pa(e);d&&Y(n,d)}),J();var o=ya(),v=k(o),p=k(v);{var l=d=>{var u=ka();ie(u,5,()=>x(r),oe,(b,g)=>{var c=re(),f=M(c);{var A=y=>{ge(y,{get bookmark(){return x(g)},get faviconLink(){return x(n)[x(g).bookmarkIndexName]}})};w(f,y=>{x(g).bookmarkIndexName&&y(A)})}N(b,c)}),_(u),N(d,u)};w(p,d=>{x(r).length>0&&d(l)})}var m=I(p,2);{var h=d=>{var u=Aa();ie(u,5,()=>x(s),oe,(b,g)=>{var c=re(),f=M(c);{var A=y=>{ge(y,{get bookmark(){return x(g)},get faviconLink(){return x(n)[x(g).bookmarkIndexName]}})};w(f,y=>{x(g).bookmarkIndexName&&y(A)})}N(b,c)}),_(u),N(d,u)};w(m,d=>{x(s).length>0&&d(h)})}_(v),_(o),N(t,o),K()}const le=H("home"),ae=H(null),te=H(null);var xa=L('<hr class="separator svelte-obx2py">'),Ia=L('<div class="header svelte-obx2py"><a class="brand svelte-obx2py"></a> <select class="view-list svelte-obx2py" id="view-list"><option>Home</option><option>Settings</option></select></div> <!>',1);function La(t){const[a,e]=q(),r=()=>j(le,"$selectedPage",a),s="https://m9j.github.io/bk";var n=Ia(),i=M(n),o=k(i);z(o,"href",s),o.textContent="BOOKMARKS";var v=I(o,2);V(()=>{r(),Xe(()=>{})});var p=k(v);p.value=p.__value="home";var l=I(p);l.value=l.__value="settings",_(v),_(i);var m=I(i,2);{var h=d=>{var u=xa();N(d,u)};w(m,d=>{r()!=="home"&&d(h)})}fa(v,r,d=>ea(le,d)),N(t,n),e()}async function Ea(t){if(t){let a=setTimeout(()=>{clearTimeout(a),t()},0)}}async function wa(){const a="/bk"+"/lambdas";try{const e=await fetch(a+"/index.json");if(e){let r=await e.json();if(r=r.filter(n=>!!n),Array.isArray(r)?r.length>0:!1){const n=r.map(i=>import(a+"/"+i+".lambda.js"));return await Promise.all(n)}}}catch(e){console.error("lambdas folder or lambdas/index.json not found. Error:",e)}}async function Sa(t){if(Array.isArray(t)?t.length>0:!1)for(const[e,r]of Object.entries(t))$a(r,Number(e))}const we=H([]);async function $a(t,a){Ea(async()=>{if(t.action&&typeof t.action=="function"){const e=o=>{we.update(v=>(v[a]=o,v))},r=await t.action(e),s=["string","number","boolean"].includes(typeof r),n=typeof r=="object",i=typeof r=="function";if(r){if(s)e(r);else if(n){const o=Array.isArray(r);e(o?r.join(","):JSON.stringify(r))}else if(i){const o=()=>{let v=setTimeout(()=>{clearTimeout(v),r(e),o()},t.CONFIG_ACTION_DELAY||1e3)};o()}}}})}var Ca=L('<div class="lambda svelte-1opn7g2"><div class="lambda-title"> </div> <p class="lambda-result svelte-1opn7g2"> </p></div>'),Ba=L('<div class="lambdas-container svelte-1opn7g2"></div>');function Ra(t,a){G(a,!1);const[e,r]=q(),s=()=>j(i,"$results",e);let n=D([]);const i=we;Ne(async()=>{const l=await wa();l&&(Array.isArray(l)&&l.length>0)&&(Y(n,l),Sa(x(n)))}),J();var o=re(),v=M(o);{var p=l=>{var m=Ba();ie(m,5,()=>x(n),oe,(h,d,u)=>{var b=Ca(),g=k(b),c=k(g);_(g);var f=I(g,2),A=k(f,!0);_(f),_(b),V(()=>{O(c,`${x(d).prompt??""}: `),O(A,s()[u]??"...")}),N(h,b)}),_(m),N(l,m)};w(v,l=>{x(n).length>0&&l(p)})}N(t,o),K(),r()}function Va(){navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(a=>a.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(a=>Promise.all(a.map(e=>caches.delete(e)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(t){if(t){const a=new Date(Number(t)),e=String(a.getFullYear()),r=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),n=String(a.getHours()).padStart(2,"0"),i=String(a.getMinutes()).padStart(2,"0"),o=String(a.getSeconds()).padStart(2,"0");return`${e}.${r}${s}.${n}${i}${o}`}}async function Oa(){const a="/bk"+"/version.json";try{const e=await fetch(a);if(!e.ok)console.log(new Error("Failed to fetch current version"));else return(await e.json()).version}catch(e){console.error("Current version check failed: ",e)}}async function Ta(){const t="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const a=await fetch(t,{cache:"no-store"});if(!a.ok)console.log(new Error("Failed to fetch latest version"));else{const e=await a.json();return JSON.parse(atob(e.content)).version}}catch(a){console.error("Latest version check failed: ",a)}}var Fa=L('<span class="monospace svelte-2le08x"> </span> <br>',1),ja=L("<span> </span><br>",1),Ma=L("<div>Versions:<br> <!> <!></div>"),Pa=L('<div class="settings-container hide svelte-2le08x" id="settings-container"><div class="columns svelte-2le08x"><!></div> <div class="rows svelte-2le08x"><button class="settings-button svelte-2le08x">Check for latest version</button> <button class="settings-button svelte-2le08x">Hard reload application</button></div> <br> <div class="columns svelte-2le08x"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function za(t,a){G(a,!1);const[e,r]=q(),s=()=>j(ae,"$currentVersion",e),n=()=>j(te,"$latestVersion",e),i=()=>j(o,"$isNew",e),o=H(!1);(async()=>(await v(),await p()))();async function v(){const c=await Oa();ae.update(f=>c)}async function p(){const c=await Ta();te.update(f=>c),o.update(f=>Number(ue(te))>Number(ue(ae)))}J();var l=Pa(),m=k(l),h=k(m);{var d=c=>{var f=Ma(),A=I(k(f),3);{var y=S=>{var C=Fa(),B=M(C),F=k(B);_(B),ee(2),V(W=>O(F,`${W??""} [CURRENT]`),[()=>_e(s())],se),N(S,C)};w(A,S=>{s()&&S(y)})}var E=I(A,2);{var T=S=>{var C=ja(),B=M(C);let F;var W=k(B);_(B),ee(),V((Se,$e)=>{F=oa(B,1,"monospace svelte-2le08x",null,F,Se),O(W,`${$e??""} [LATEST]`)},[()=>({"is-new":i()}),()=>_e(n())],se),N(S,C)};w(E,S=>{n()&&S(T)})}_(f),N(c,f)};w(h,c=>{(s()||n())&&c(d)})}_(m);var u=I(m,2),b=k(u),g=I(b,2);_(u),ee(4),_(l),ne("click",b,()=>p()),ne("click",g,()=>Va()),N(t,l),K(),r()}var Da=L('<div class="app-wrapper svelte-lehtuv"><!> <!> <div class="app-bottom-wrapper svelte-lehtuv"><!> <!></div></div>');function qa(t){const[a,e]=q(),r=()=>j(le,"$selectedPage",a);var s=Da(),n=k(s);Na(n,{});var i=I(n,2);Ra(i,{});var o=I(i,2),v=k(o);La(v);var p=I(v,2);{var l=m=>{za(m,{})};w(p,m=>{r()==="settings"&&m(l)})}_(o),_(s),N(t,s),e()}export{qa as component};
