import{t as x,a as y,c as J}from"../chunks/Ckovk0Fb.js";import{i as K}from"../chunks/Dkq-dmRF.js";import{ap as He,i as Be,l as E,x as Ce,aq as ge,y as Re,z as de,A as X,B as H,U as be,ar as ee,as as re,F,j as z,a9 as Ge,m as M,a6 as ke,a5 as Ae,at as ye,c as Ye,C as G,D as ae,al as Je,a0 as Ke,$ as qe,g as N,N as ue,ad as We,ah as Oe,a8 as Ze,au as oe,a2 as Ne,av as Qe,aw as Xe,ag as ea,ax as aa,k as ta,ay as ra,az as sa,ab as na,aA as oa,aB as ia,aC as la,aD as ca,aj as Te,aE as va,p as q,s as A,v as b,w as I,t as C,q as W,J as te,o as V,aF as fa,aG as ie}from"../chunks/pgIx-I-f.js";import{l as da,e as me,s as R}from"../chunks/DECt84H4.js";import{p as we,i as S,s as D,a as se,b as ua}from"../chunks/FXgdP5Kz.js";import{o as Ve,w as Z,g as xe}from"../chunks/CLLsfbKB.js";const le=0,Q=1,ce=2;function ma(t,a,e,r,s){E&&Ce();var n=t,o=He(),l=Ye,v=be,f,i,h,p=(o?re:F)(void 0),d=(o?re:F)(void 0),m=!1;function _(c,u){m=!0,u&&(ke(g),Ae(g),ye(l));try{c===le&&e&&(f?G(f):f=z(()=>e(n))),c===Q&&r&&(i?G(i):i=z(()=>r(n,p))),c===ce&&s&&(h?G(h):h=z(()=>s(n,d))),c!==le&&f&&ae(f,()=>f=null),c!==Q&&i&&ae(i,()=>i=null),c!==ce&&h&&ae(h,()=>h=null)}finally{u&&(ye(null),Ae(null),ke(null),Je())}}var g=Be(()=>{if(v===(v=a()))return;let c=E&&ge(v)===(n.data===Re);if(c&&(n=de(),X(n),H(!1),c=!0),ge(v)){var u=v;m=!1,u.then(k=>{u===v&&(ee(p,k),_(Q,!0))},k=>{if(u===v&&(ee(d,k),_(ce,!0),!s))throw d.v}),E?e&&(f=z(()=>e(n))):Ge(()=>{m||_(le,!0)})}else ee(p,v),_(Q,!1);return c&&H(!0),()=>v=be});E&&(n=M)}function pe(t,a){return a}function pa(t,a,e,r){for(var s=[],n=a.length,o=0;o<n;o++)Xe(a[o].e,s,!0);var l=n>0&&s.length===0&&e!==null;if(l){var v=e.parentNode;ea(v),v.append(e),r.clear(),T(t,a[0].prev,a[n-1].next)}aa(s,()=>{for(var f=0;f<n;f++){var i=a[f];l||(r.delete(i.k),T(t,i.prev,i.next)),ta(i.e,!l)}})}function he(t,a,e,r,s,n=null){var o=t,l={flags:a,items:new Map,first:null};{var v=t;o=E?X(Ke(v)):v.appendChild(qe())}E&&Ce();var f=null,i=!1,h=ue(()=>{var p=e();return Ze(p)?p:p==null?[]:Oe(p)});Be(()=>{var p=N(h),d=p.length;if(i&&d===0)return;i=d===0;let m=!1;if(E){var _=o.data===Re;_!==(d===0)&&(o=de(),X(o),H(!1),m=!0)}if(E){for(var g=null,c,u=0;u<d;u++){if(M.nodeType===8&&M.data===We){o=M,m=!0,H(!1);break}var k=p[u],w=r(k,u);c=Fe(M,l,g,null,k,w,u,s,a,e),l.items.set(w,c),g=c}d>0&&X(de())}E||ha(p,l,o,s,a,r,e),n!==null&&(d===0?f?G(f):f=z(()=>n(o)):f!==null&&ae(f,()=>{f=null})),m&&H(!0),N(h)}),E&&(o=M)}function ha(t,a,e,r,s,n,o){var l=t.length,v=a.items,f=a.first,i=f,h,p=null,d=[],m=[],_,g,c,u;for(u=0;u<l;u+=1){if(_=t[u],g=n(_,u),c=v.get(g),c===void 0){var k=i?i.e.nodes_start:e;p=Fe(k,a,p,p===null?a.first:p.next,_,g,u,r,s,o),v.set(g,p),d=[],m=[],i=p.next;continue}if(_a(c,_,u),(c.e.f&oe)!==0&&G(c.e),c!==i){if(h!==void 0&&h.has(c)){if(d.length<m.length){var w=m[0],L;p=w.prev;var P=d[0],$=d[d.length-1];for(L=0;L<d.length;L+=1)Ie(d[L],w,e);for(L=0;L<m.length;L+=1)h.delete(m[L]);T(a,P.prev,$.next),T(a,p,P),T(a,$,w),i=w,p=$,u-=1,d=[],m=[]}else h.delete(c),Ie(c,i,e),T(a,c.prev,c.next),T(a,c,p===null?a.first:p.next),T(a,p,c),p=c;continue}for(d=[],m=[];i!==null&&i.k!==g;)(i.e.f&oe)===0&&(h??(h=new Set)).add(i),m.push(i),i=i.next;if(i===null)continue;c=i}d.push(c),p=c,i=c.next}if(i!==null||h!==void 0){for(var B=h===void 0?[]:Oe(h);i!==null;)(i.e.f&oe)===0&&B.push(i),i=i.next;var O=B.length;if(O>0){var j=l===0?e:null;pa(a,B,j,v)}}Ne.first=a.first&&a.first.e,Ne.last=p&&p.e}function _a(t,a,e,r){ee(t.v,a),t.i=e}function Fe(t,a,e,r,s,n,o,l,v,f){var i=(v&ra)!==0,h=(v&sa)===0,p=i?h?F(s):re(s):s,d=(v&Qe)===0?o:re(o),m={i:d,v:p,k:n,a:null,e:null,prev:e,next:r};try{return m.e=z(()=>l(t,p,d,f),E),m.e.prev=e&&e.e,m.e.next=r&&r.e,e===null?a.first=m:(e.next=m,e.e.next=m.e),r!==null&&(r.prev=m,r.e.prev=m.e),m}finally{}}function Ie(t,a,e){for(var r=t.next?t.next.e.nodes_start:e,s=a?a.e.nodes_start:e,n=t.e.nodes_start;n!==r;){var o=na(n);s.before(n),n=o}}function T(t,a,e){a===null?t.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const Ee=[...` 	
\r\f \v\uFEFF`];function ga(t,a,e){var r=""+t;if(e){for(var s in e)if(e[s])r=r?r+" "+s:s;else if(r.length)for(var n=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+n;(o===0||Ee.includes(r[o-1]))&&(l===r.length||Ee.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function ba(t,a,e,r,s,n){var o=t.__className;if(E||o!==e||o===void 0){var l=ga(e,r,n);(!E||l!==t.getAttribute("class"))&&(l==null?t.removeAttribute("class"):t.className=l),t.__className=e}else if(n&&s!==n)for(var v in n){var f=!!n[v];(s==null||f!==!!s[v])&&t.classList.toggle(v,f)}return n}const ka=Symbol("is custom element"),Aa=Symbol("is html");function U(t,a,e,r){var s=ya(t);E&&(s[a]=t.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&t.nodeName==="LINK")||s[a]!==(s[a]=e)&&(a==="loading"&&(t[ia]=e),e==null?t.removeAttribute(a):typeof e!="string"&&Na(t).includes(a)?t[a]=e:t.setAttribute(a,e))}function ya(t){return t.__attributes??(t.__attributes={[ka]:t.nodeName.includes("-"),[Aa]:t.namespaceURI===oa})}var Se=new Map;function Na(t){var a=Se.get(t.nodeName);if(a)return a;Se.set(t.nodeName,a=[]);for(var e,r=t,s=Element.prototype;s!==r;){e=ca(r);for(var n in e)e[n].set&&a.push(n);r=la(r)}return a}function Pe(t,a,e){if(t.multiple)return Ia(t,a);for(var r of t.options){var s=Y(r);if(va(s,a)){r.selected=!0;return}}(!e||a!==void 0)&&(t.selectedIndex=-1)}function wa(t,a){Te(()=>{var e=new MutationObserver(()=>{var r=t.__value;Pe(t,r)});return e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function xa(t,a,e=a){var r=!0;da(t,"change",s=>{var n=s?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(n),Y);else{var l=t.querySelector(n)??t.querySelector("option:not([disabled])");o=l&&Y(l)}e(o)}),Te(()=>{var s=a();if(Pe(t,s,r),r&&s===void 0){var n=t.querySelector(":checked");n!==null&&(s=Y(n),e(s))}t.__value=s,r=!1}),wa(t)}function Ia(t,a){for(var e of t.options)e.selected=~a.indexOf(Y(e))}function Y(t){return"__value"in t?t.__value:t.value}const Ea=async()=>await $a(),Sa="c3bb7c6ce286577d5945d6e452b9c8dca103276a88f9c5c4587372b957f164d6d636acce2422ce3410488b3feb6a9e7b2bf3aeb576614d23d958d3086e5f00f4",La="1976f6ba3ea71cc44453f8de0e412b6b";async function $a(){const t=localStorage.getItem("pwd")||prompt("Password")||"",a=await Ra(t);return a&&localStorage.setItem("pwd",t),a}async function Ba(t,a){const e=new TextEncoder,r=await window.crypto.subtle.importKey("raw",e.encode(t),{name:"PBKDF2"},!1,["deriveBits"]),s=await window.crypto.subtle.deriveBits({name:"PBKDF2",salt:e.encode(a),iterations:1e5,hash:"SHA-512"},r,512);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function Ca(t,a,e){return await Ba(t,e)===a}async function Ra(t){return await Ca(t,Sa,La)}const je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Me={faviconSize:128,faviconFetchServiceURL:t=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${t}&size=${Me.faviconSize}`};async function Oa(){const a="/bk"+"/bookmarks";try{const e=await fetch(a+"/index.json");if(e){const r=await e.json();if(Array.isArray(r)?r.length>0:!1){const o=r.sort().map(l=>fetch(a+"/"+l+".json").then(v=>v.json()).then(v=>(v.bookmarkIndexName=l,v)));return await Promise.all(o)}}}catch(e){console.error("bookmarks folder or bookmarks/index.json not found. Error:",e)}}async function Ta(t){const a={};if(Array.isArray(t)?t.length>0:!1)for(let r=0;r<t.length;r++){const s=t[r],n=s.LINK,o=s.ICON;let l="";if(o)l=o;else if(n){const v=new URL(n),f=v.protocol+"//"+v.hostname;l=Me.faviconFetchServiceURL(f)}else l=je;s.bookmarkIndexName&&(a[s.bookmarkIndexName]=l)}return a}var Va=x('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),Fa=x('<div class="bk-title svelte-1jzx7ns"> </div>'),Pa=x('<div class="bk-desc svelte-1jzx7ns"> </div>'),ja=x('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function Le(t,a){q(a,!1);let e=we(a,"bookmark",8),r=we(a,"faviconLink",8);const s=e().LINK||"javascript:void(0)";let n=e().NAME||e().LINK;function o(c){const u=c==null?void 0:c.target;u&&(u.src=je)}K();var l=ja();U(l,"href",s),U(l,"title",n);var v=A(l),f=A(v),i=A(f);b(f);var h=I(f,2);{var p=c=>{var u=Va(),k=A(u),w=A(k,!0);b(k);var L=I(k,2),P=A(L,!0);b(L),b(u),C(()=>{R(w,e().NAME),R(P,e().LINK)}),y(c,u)};S(h,c=>{e().IS_PINNED||c(p)})}b(v);var d=I(v,2);{var m=c=>{var u=Fa(),k=A(u,!0);b(u),C(()=>R(k,e().TITLE)),y(c,u)};S(d,c=>{e().TITLE&&c(m)})}var _=I(d,2);{var g=c=>{var u=Pa(),k=A(u,!0);b(u),C(()=>R(k,e().DESC)),y(c,u)};S(_,c=>{e().DESC&&c(g)})}b(l),C(()=>{U(l,"data-bookmark-icon",e().ICON),U(i,"src",r())}),me("error",i,o),y(t,l),W()}var Ma=x('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),za=x('<div class="bk-container-grid svelte-1uu4y0a"></div>'),Da=x('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Ua(t,a){q(a,!1);let e=[],r=F([]),s=F([]),n=F({});async function o(){const d=await Oa();d&&(e=d.sort((_,g)=>_.NAME.localeCompare(g.NAME)),te(r,e.filter(_=>_.IS_PINNED)),te(s,e.filter(_=>!_.IS_PINNED)))}Ve(async()=>{await o();const d=await Ta(e);d&&te(n,d)}),K();var l=Da(),v=A(l),f=A(v);{var i=d=>{var m=Ma();he(m,5,()=>N(r),pe,(_,g)=>{var c=J(),u=V(c);{var k=w=>{Le(w,{get bookmark(){return N(g)},get faviconLink(){return N(n)[N(g).bookmarkIndexName]}})};S(u,w=>{N(g).bookmarkIndexName&&w(k)})}y(_,c)}),b(m),y(d,m)};S(f,d=>{N(r).length>0&&d(i)})}var h=I(f,2);{var p=d=>{var m=za();he(m,5,()=>N(s),pe,(_,g)=>{var c=J(),u=V(c);{var k=w=>{Le(w,{get bookmark(){return N(g)},get faviconLink(){return N(n)[N(g).bookmarkIndexName]}})};S(u,w=>{N(g).bookmarkIndexName&&w(k)})}y(_,c)}),b(m),y(d,m)};S(h,d=>{N(s).length>0&&d(p)})}b(v),b(l),y(t,l),W()}const _e=Z("home"),ve=Z(null),fe=Z(null);var Ha=x('<hr class="separator svelte-obx2py">'),Ga=x('<div class="header svelte-obx2py"><a class="brand svelte-obx2py"></a> <select class="view-list svelte-obx2py" id="view-list"><option>Home</option><option>Settings</option></select></div> <!>',1);function Ya(t){const[a,e]=se(),r=()=>D(_e,"$selectedPage",a),s="https://m9j.github.io/bk";var n=Ga(),o=V(n),l=A(o);U(l,"href",s),l.textContent="BOOKMARKS";var v=I(l,2);C(()=>{r(),fa(()=>{})});var f=A(v);f.value=f.__value="home";var i=I(f);i.value=i.__value="settings",b(v),b(o);var h=I(o,2);{var p=d=>{var m=Ha();y(d,m)};S(h,d=>{r()!=="home"&&d(p)})}xa(v,r,d=>ua(_e,d)),y(t,n),e()}async function Ja(t){if(t){let a=setTimeout(()=>{clearTimeout(a),t()},0)}}async function Ka(){const a="/bk"+"/lambdas";try{const e=await fetch(a+"/index.json");if(e){let r=await e.json();if(r=r.filter(n=>!!n),Array.isArray(r)?r.length>0:!1){const n=r.map(o=>import(a+"/"+o+".lambda.js"));return await Promise.all(n)}}}catch(e){console.error("lambdas folder or lambdas/index.json not found. Error:",e)}}async function qa(t){if(Array.isArray(t)?t.length>0:!1)for(const[e,r]of Object.entries(t))Wa(r,Number(e))}const ze=Z([]);async function Wa(t,a){Ja(async()=>{if(t.action&&typeof t.action=="function"){const e=v=>{ze.update(f=>(f[a]=v,f))},r={updateValue:e},s=await t.action(r),n=["string","number","boolean"].includes(typeof s),o=typeof s=="object",l=typeof s=="function";if(s){if(n)e(s);else if(o){const v=Array.isArray(s);e(v?s.join(","):JSON.stringify(s))}else if(l){const v=()=>{let f=setTimeout(()=>{clearTimeout(f),s(e),v()},t.CONFIG_ACTION_DELAY||1e3)};v()}}}})}var Za=x('<div class="lambda svelte-19zltv"><div class="lambda-title"> </div> <p class="lambda-result svelte-19zltv"> </p></div>'),Qa=x('<div class="lambdas-container svelte-19zltv"></div>');function Xa(t,a){q(a,!1);const[e,r]=se(),s=()=>D(o,"$results",e);let n=F([]);const o=ze;Ve(async()=>{const i=await Ka();i&&(Array.isArray(i)&&i.length>0)&&(te(n,i),qa(N(n)))}),K();var l=J(),v=V(l);{var f=i=>{var h=Qa();he(h,5,()=>N(n),pe,(p,d,m)=>{var _=Za(),g=A(_),c=A(g);b(g);var u=I(g,2),k=A(u,!0);b(u),b(_),C(()=>{R(c,`${N(d).prompt??""}: `),R(k,s()[m]??"...")}),y(p,_)}),b(h),y(i,h)};S(v,i=>{N(n).length>0&&i(f)})}y(t,l),W(),r()}function et(){navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(a=>a.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(a=>Promise.all(a.map(e=>caches.delete(e)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function $e(t){if(t){const a=new Date(Number(t)),e=String(a.getFullYear()),r=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),n=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0"),l=String(a.getSeconds()).padStart(2,"0");return`${e}.${r}${s}.${n}${o}${l}`}}async function at(){const a="/bk"+"/version.json";try{const e=await fetch(a);if(!e.ok)console.log(new Error("Failed to fetch current version"));else return(await e.json()).version}catch(e){console.error("Current version check failed: ",e)}}async function tt(){const t="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const a=await fetch(t,{cache:"no-store"});if(!a.ok)console.log(new Error("Failed to fetch latest version"));else{const e=await a.json();return JSON.parse(atob(e.content)).version}}catch(a){console.error("Latest version check failed: ",a)}}var rt=x('<span class="monospace svelte-2le08x"> </span> <br>',1),st=x("<span> </span><br>",1),nt=x("<div>Versions:<br> <!> <!></div>"),ot=x('<div class="settings-container hide svelte-2le08x" id="settings-container"><div class="columns svelte-2le08x"><!></div> <div class="rows svelte-2le08x"><button class="settings-button svelte-2le08x">Check for latest version</button> <button class="settings-button svelte-2le08x">Hard reload application</button></div> <br> <div class="columns svelte-2le08x"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function it(t,a){q(a,!1);const[e,r]=se(),s=()=>D(ve,"$currentVersion",e),n=()=>D(fe,"$latestVersion",e),o=()=>D(l,"$isNew",e),l=Z(!1);(async()=>(await v(),await f()))();async function v(){const c=await at();ve.update(u=>c)}async function f(){const c=await tt();fe.update(u=>c),l.update(u=>Number(xe(fe))>Number(xe(ve)))}K();var i=ot(),h=A(i),p=A(h);{var d=c=>{var u=nt(),k=I(A(u),3);{var w=$=>{var B=rt(),O=V(B),j=A(O);b(O),ie(2),C(ne=>R(j,`${ne??""} [CURRENT]`),[()=>$e(s())],ue),y($,B)};S(k,$=>{s()&&$(w)})}var L=I(k,2);{var P=$=>{var B=st(),O=V(B);let j;var ne=A(O);b(O),ie(),C((De,Ue)=>{j=ba(O,1,"monospace svelte-2le08x",null,j,De),R(ne,`${Ue??""} [LATEST]`)},[()=>({"is-new":o()}),()=>$e(n())],ue),y($,B)};S(L,$=>{n()&&$(P)})}b(u),y(c,u)};S(p,c=>{(s()||n())&&c(d)})}b(h);var m=I(h,2),_=A(m),g=I(_,2);b(m),ie(4),b(i),me("click",_,()=>f()),me("click",g,()=>et()),y(t,i),W(),r()}var lt=x('<div class="app-wrapper svelte-lehtuv"><!> <!> <div class="app-bottom-wrapper svelte-lehtuv"><!> <!></div></div>');function ct(t){const[a,e]=se(),r=()=>D(_e,"$selectedPage",a);var s=lt(),n=A(s);Ua(n,{});var o=I(n,2);Xa(o,{});var l=I(o,2),v=A(l);Ya(v);var f=I(v,2);{var i=h=>{it(h,{})};S(f,h=>{r()==="settings"&&h(i)})}b(l),b(s),y(t,s),e()}var vt=x('<div class="message svelte-170vfwx">Access: 401 Unauthorized</div>'),ft=x('<div class="message svelte-170vfwx"> </div>'),dt=x('<div class="message svelte-170vfwx">Access: Checking...</div>');function bt(t,a){q(a,!1),K();var e=J(),r=V(e);ma(r,Ea,s=>{var n=dt();y(s,n)},(s,n)=>{var o=J(),l=V(o);{var v=i=>{ct(i)},f=i=>{var h=vt();y(i,h)};S(l,i=>{N(n)?i(v):i(f,!1)})}y(s,o)},(s,n)=>{var o=ft(),l=A(o);b(o),C(()=>R(l,`Access: ERROR: ${N(n)??""}`)),y(s,o)}),y(t,e),W()}export{bt as component};
