import{t as y,a as I,c as oe}from"../chunks/CyOrqUXm.js";import{i as re}from"../chunks/CL0QEqD9.js";import{A as J,l as B,a0 as Se,$ as Be,x as Ce,i as $e,g as E,N as X,y as Re,z as ie,B as G,m as T,ad as Ve,C as me,j as be,D as ze,ah as Ae,a8 as Oe,F as U,ap as le,aq as K,a2 as ve,ar as Me,as as Te,at as Pe,ag as De,au as Fe,k as Ue,av as je,aw as He,ab as Ye,ax as Je,ay as Ge,az as Ke,aA as qe,aj as Ne,aB as We,p as te,s as b,v as k,w,t as V,q as ne,J as q,o as j,aC as Qe,aD as W}from"../chunks/DZpqQ712.js";import{p as ce,i as S,s as D,a as se,b as Ze}from"../chunks/B8VvTqyC.js";import{o as Xe,w as H,g as fe}from"../chunks/HU1d89I3.js";import{l as ea,e as ee,s as M}from"../chunks/DUnFqAGD.js";function ue(r,e){return e}function aa(r,e,a,t){for(var n=[],s=e.length,o=0;o<s;o++)Pe(e[o].e,n,!0);var i=s>0&&n.length===0&&a!==null;if(i){var c=a.parentNode;De(c),c.append(a),t.clear(),R(r,e[0].prev,e[s-1].next)}Fe(n,()=>{for(var p=0;p<s;p++){var v=e[p];i||(t.delete(v.k),R(r,v.prev,v.next)),Ue(v.e,!i)}})}function de(r,e,a,t,n,s=null){var o=r,i={flags:e,items:new Map,first:null};{var c=r;o=B?J(Se(c)):c.appendChild(Be())}B&&Ce();var p=null,v=!1,_=X(()=>{var g=a();return Oe(g)?g:g==null?[]:Ae(g)});$e(()=>{var g=E(_),u=g.length;if(v&&u===0)return;v=u===0;let d=!1;if(B){var m=o.data===Re;m!==(u===0)&&(o=ie(),J(o),G(!1),d=!0)}if(B){for(var h=null,l,f=0;f<u;f++){if(T.nodeType===8&&T.data===Ve){o=T,d=!0,G(!1);break}var A=g[f],N=t(A,f);l=Ie(T,i,h,null,A,N,f,n,e,a),i.items.set(N,l),h=l}u>0&&J(ie())}B||ra(g,i,o,n,e,t,a),s!==null&&(u===0?p?me(p):p=be(()=>s(o)):p!==null&&ze(p,()=>{p=null})),d&&G(!0),E(_)}),B&&(o=T)}function ra(r,e,a,t,n,s,o){var i=r.length,c=e.items,p=e.first,v=p,_,g=null,u=[],d=[],m,h,l,f;for(f=0;f<i;f+=1){if(m=r[f],h=s(m,f),l=c.get(h),l===void 0){var A=v?v.e.nodes_start:a;g=Ie(A,e,g,g===null?e.first:g.next,m,h,f,t,n,o),c.set(h,g),u=[],d=[],v=g.next;continue}if(ta(l,m,f),(l.e.f&K)!==0&&me(l.e),l!==v){if(_!==void 0&&_.has(l)){if(u.length<d.length){var N=d[0],x;g=N.prev;var z=u[0],L=u[u.length-1];for(x=0;x<u.length;x+=1)pe(u[x],N,a);for(x=0;x<d.length;x+=1)_.delete(d[x]);R(e,z.prev,L.next),R(e,g,z),R(e,L,N),v=N,g=L,f-=1,u=[],d=[]}else _.delete(l),pe(l,v,a),R(e,l.prev,l.next),R(e,l,g===null?e.first:g.next),R(e,g,l),g=l;continue}for(u=[],d=[];v!==null&&v.k!==h;)(v.e.f&K)===0&&(_??(_=new Set)).add(v),d.push(v),v=v.next;if(v===null)continue;l=v}u.push(l),g=l,v=l.next}if(v!==null||_!==void 0){for(var C=_===void 0?[]:Ae(_);v!==null;)(v.e.f&K)===0&&C.push(v),v=v.next;var $=C.length;if($>0){var O=i===0?a:null;aa(e,C,O,c)}}ve.first=e.first&&e.first.e,ve.last=g&&g.e}function ta(r,e,a,t){Te(r.v,e),r.i=a}function Ie(r,e,a,t,n,s,o,i,c,p){var v=(c&je)!==0,_=(c&He)===0,g=v?_?U(n):le(n):n,u=(c&Me)===0?o:le(o),d={i:u,v:g,k:s,a:null,e:null,prev:a,next:t};try{return d.e=be(()=>i(r,g,u,p),B),d.e.prev=a&&a.e,d.e.next=t&&t.e,a===null?e.first=d:(a.next=d,a.e.next=d.e),t!==null&&(t.prev=d,t.e.prev=d.e),d}finally{}}function pe(r,e,a){for(var t=r.next?r.next.e.nodes_start:a,n=e?e.e.nodes_start:a,s=r.e.nodes_start;s!==t;){var o=Ye(s);n.before(s),s=o}}function R(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}const ge=[...` 	
\r\fÂ \v\uFEFF`];function na(r,e,a){var t=""+r;if(a){for(var n in a)if(a[n])t=t?t+" "+n:n;else if(t.length)for(var s=n.length,o=0;(o=t.indexOf(n,o))>=0;){var i=o+s;(o===0||ge.includes(t[o-1]))&&(i===t.length||ge.includes(t[i]))?t=(o===0?"":t.substring(0,o))+t.substring(i+1):o=i}}return t===""?null:t}function sa(r,e,a,t,n,s){var o=r.__className;if(B||o!==a||o===void 0){var i=na(a,t,s);(!B||i!==r.getAttribute("class"))&&(i==null?r.removeAttribute("class"):r.className=i),r.__className=a}else if(s&&n!==s)for(var c in s){var p=!!s[c];(n==null||p!==!!n[c])&&r.classList.toggle(c,p)}return s}const oa=Symbol("is custom element"),ia=Symbol("is html");function P(r,e,a,t){var n=la(r);B&&(n[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||n[e]!==(n[e]=a)&&(e==="loading"&&(r[Ge]=a),a==null?r.removeAttribute(e):typeof a!="string"&&va(r).includes(e)?r[e]=a:r.setAttribute(e,a))}function la(r){return r.__attributes??(r.__attributes={[oa]:r.nodeName.includes("-"),[ia]:r.namespaceURI===Je})}var he=new Map;function va(r){var e=he.get(r.nodeName);if(e)return e;he.set(r.nodeName,e=[]);for(var a,t=r,n=Element.prototype;n!==t;){a=qe(t);for(var s in a)a[s].set&&e.push(s);t=Ke(t)}return e}function Ee(r,e,a){if(r.multiple)return ua(r,e);for(var t of r.options){var n=F(t);if(We(n,e)){t.selected=!0;return}}(!a||e!==void 0)&&(r.selectedIndex=-1)}function ca(r,e){Ne(()=>{var a=new MutationObserver(()=>{var t=r.__value;Ee(r,t)});return a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function fa(r,e,a=e){var t=!0;ea(r,"change",n=>{var s=n?"[selected]":":checked",o;if(r.multiple)o=[].map.call(r.querySelectorAll(s),F);else{var i=r.querySelector(s)??r.querySelector("option:not([disabled])");o=i&&F(i)}a(o)}),Ne(()=>{var n=e();if(Ee(r,n,t),t&&n===void 0){var s=r.querySelector(":checked");s!==null&&(n=F(s),a(n))}r.__value=n,t=!1}),ca(r)}function ua(r,e){for(var a of r.options)a.selected=~e.indexOf(F(a))}function F(r){return"__value"in r?r.__value:r.value}const xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",we={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${we.faviconSize}`};async function da(){const e="/bk"+"/bookmarks";try{const a=await fetch(e+"/index.json");if(a){const t=await a.json();if(Array.isArray(t)?t.length>0:!1){const o=t.sort().map(i=>fetch(e+"/"+i+".json").then(c=>c.json()).then(c=>(c.bookmarkIndexName=i,c)));return await Promise.all(o)}}}catch(a){console.error("bookmarks folder or bookmarks/index.json not found. Error:",a)}}async function pa(r){const e={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const n=r[t],s=n.LINK,o=n.ICON;let i="";if(o)i=o;else if(s){const c=new URL(s),p=c.protocol+"//"+c.hostname;i=we.faviconFetchServiceURL(p)}else i=xe;n.bookmarkIndexName&&(e[n.bookmarkIndexName]=i)}return e}var ga=y('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),ha=y('<div class="bk-title svelte-1jzx7ns"> </div>'),ka=y('<div class="bk-desc svelte-1jzx7ns"> </div>'),_a=y('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function ke(r,e){te(e,!1);let a=ce(e,"bookmark",8),t=ce(e,"faviconLink",8);const n=a().LINK||"javascript:void(0)";let s=a().NAME||a().LINK;function o(l){const f=l==null?void 0:l.target;f&&(f.src=xe)}re();var i=_a();P(i,"href",n),P(i,"title",s);var c=b(i),p=b(c),v=b(p);k(p);var _=w(p,2);{var g=l=>{var f=ga(),A=b(f),N=b(A,!0);k(A);var x=w(A,2),z=b(x,!0);k(x),k(f),V(()=>{M(N,a().NAME),M(z,a().LINK)}),I(l,f)};S(_,l=>{a().IS_PINNED||l(g)})}k(c);var u=w(c,2);{var d=l=>{var f=ha(),A=b(f,!0);k(f),V(()=>M(A,a().TITLE)),I(l,f)};S(u,l=>{a().TITLE&&l(d)})}var m=w(u,2);{var h=l=>{var f=ka(),A=b(f,!0);k(f),V(()=>M(A,a().DESC)),I(l,f)};S(m,l=>{a().DESC&&l(h)})}k(i),V(()=>{P(i,"data-bookmark-icon",a().ICON),P(v,"src",t())}),ee("error",v,o),I(r,i),ne()}var ma=y('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),ba=y('<div class="bk-container-grid svelte-1uu4y0a"></div>'),Aa=y('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Na(r,e){te(e,!1);let a=[],t=U([]),n=U([]),s=U({});async function o(){const u=await da();u&&(a=u.sort((m,h)=>m.NAME.localeCompare(h.NAME)),q(t,a.filter(m=>m.IS_PINNED)),q(n,a.filter(m=>!m.IS_PINNED)))}Xe(async()=>{await o();const u=await pa(a);u&&q(s,u)}),re();var i=Aa(),c=b(i),p=b(c);{var v=u=>{var d=ma();de(d,5,()=>E(t),ue,(m,h)=>{var l=oe(),f=j(l);{var A=N=>{ke(N,{get bookmark(){return E(h)},get faviconLink(){return E(s)[E(h).bookmarkIndexName]}})};S(f,N=>{E(h).bookmarkIndexName&&N(A)})}I(m,l)}),k(d),I(u,d)};S(p,u=>{E(t).length>0&&u(v)})}var _=w(p,2);{var g=u=>{var d=ba();de(d,5,()=>E(n),ue,(m,h)=>{var l=oe(),f=j(l);{var A=N=>{ke(N,{get bookmark(){return E(h)},get faviconLink(){return E(s)[E(h).bookmarkIndexName]}})};S(f,N=>{E(h).bookmarkIndexName&&N(A)})}I(m,l)}),k(d),I(u,d)};S(_,u=>{E(n).length>0&&u(g)})}k(c),k(i),I(r,i),ne()}const ae=H("home"),Q=H(null),Z=H(null);var Ia=y('<div class="header svelte-148zt7e"><a class="brand svelte-148zt7e"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function Ea(r){const[e,a]=se(),t=()=>D(ae,"$selectedPage",e),n="https://m9j.github.io/bk";var s=Ia(),o=b(s);P(o,"href",n),o.textContent="BOOKMARKS";var i=w(o,2);V(()=>{t(),Qe(()=>{})});var c=b(i);c.value=c.__value="home";var p=w(c);p.value=p.__value="settings",k(i),k(s),fa(i,t,v=>Ze(ae,v)),I(r,s),a()}function xa(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(a=>caches.delete(a)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(r){if(r){const e=new Date(Number(r)),a=String(e.getFullYear()),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()),o=String(e.getMinutes()),i=String(e.getSeconds());return`${a}.${t}${n}.${s}${o}${i}`}}async function wa(){const e="/bk"+"/version.json";try{const a=await fetch(e);if(!a.ok)console.log(new Error("Failed to fetch current version"));else return(await a.json()).version}catch(a){console.error("Current version check failed: ",a)}}async function ya(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(r,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const a=await e.json();return JSON.parse(atob(a.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var La=y('<span class="monospace svelte-1kpux3b"> </span> <br>',1),Sa=y("<span> </span><br>",1),Ba=y("<div>Versions:<br> <!> <!></div>"),Ca=y('<div class="settings-container hide svelte-1kpux3b" id="settings-container"><div class="columns svelte-1kpux3b"><!></div> <div class="rows svelte-1kpux3b"><button class="settings-button svelte-1kpux3b">Check for latest version</button> <button class="settings-button svelte-1kpux3b">Hard reload application</button></div> <br> <div class="columns svelte-1kpux3b"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function $a(r,e){te(e,!1);const[a,t]=se(),n=()=>D(Q,"$currentVersion",a),s=()=>D(Z,"$latestVersion",a),o=()=>D(i,"$isNew",a),i=H(!1);(async()=>(await c(),await p()))();async function c(){const l=await wa();Q.update(f=>l)}async function p(){const l=await ya();Z.update(f=>l),i.update(f=>Number(fe(Z))>Number(fe(Q)))}re();var v=Ca(),_=b(v),g=b(_);{var u=l=>{var f=Ba(),A=w(b(f),3);{var N=L=>{var C=La(),$=j(C),O=b($);k($),W(2),V(Y=>M(O,`${Y??""} [CURRENT]`),[()=>_e(n())],X),I(L,C)};S(A,L=>{n()&&L(N)})}var x=w(A,2);{var z=L=>{var C=Sa(),$=j(C);let O;var Y=b($);k($),W(),V((ye,Le)=>{O=sa($,1,"monospace svelte-1kpux3b",null,O,ye),M(Y,`${Le??""} [LATEST]`)},[()=>({"is-new":o()}),()=>_e(s())],X),I(L,C)};S(x,L=>{s()&&L(z)})}k(f),I(l,f)};S(g,l=>{(n()||s())&&l(u)})}k(_);var d=w(_,2),m=b(d),h=w(m,2);k(d),W(4),k(v),ee("click",m,()=>p()),ee("click",h,()=>xa()),I(r,v),ne(),t()}var Ra=y('<div class="app-wrapper svelte-17nvpzi"><!> <div class="app-bottom-wrapper svelte-17nvpzi"><!> <!></div></div>');function Da(r){const[e,a]=se(),t=()=>D(ae,"$selectedPage",e);var n=Ra(),s=b(n);Na(s,{});var o=w(s,2),i=b(o);Ea(i);var c=w(i,2);{var p=v=>{$a(v,{})};S(c,v=>{t()==="settings"&&v(p)})}k(o),k(n),I(r,n),a()}export{Da as component};
