import{t as L,a as N,c as re}from"../chunks/CyOrqUXm.js";import{i as J}from"../chunks/CL0QEqD9.js";import{A as Q,l as $,a0 as Ce,$ as Be,x as Ve,i as Oe,g as x,N as se,y as Re,z as ce,B as Z,m as P,ad as Te,C as be,j as ke,D as je,ah as Ae,a8 as Fe,F as D,ap as ve,aq as X,a2 as de,ar as Me,as as Pe,at as ze,ag as De,au as Ue,k as He,av as Ye,aw as Je,ab as Ge,ax as Ke,ay as qe,az as We,aA as Qe,aj as ye,aB as Ze,p as G,s as k,v as _,w as I,t as O,q as K,J as Y,o as M,aC as Xe,aD as ee}from"../chunks/DZpqQ712.js";import{p as fe,i as w,s as F,a as q,b as ea}from"../chunks/B8VvTqyC.js";import{o as Ne,w as H,g as ue}from"../chunks/HU1d89I3.js";import{l as aa,e as ne,s as R}from"../chunks/DUnFqAGD.js";function oe(t,a){return a}function ta(t,a,e,r){for(var s=[],n=a.length,o=0;o<n;o++)ze(a[o].e,s,!0);var i=n>0&&s.length===0&&e!==null;if(i){var v=e.parentNode;De(v),v.append(e),r.clear(),V(t,a[0].prev,a[n-1].next)}Ue(s,()=>{for(var u=0;u<n;u++){var l=a[u];i||(r.delete(l.k),V(t,l.prev,l.next)),He(l.e,!i)}})}function ie(t,a,e,r,s,n=null){var o=t,i={flags:a,items:new Map,first:null};{var v=t;o=$?Q(Ce(v)):v.appendChild(Be())}$&&Ve();var u=null,l=!1,p=se(()=>{var m=e();return Fe(m)?m:m==null?[]:Ae(m)});Oe(()=>{var m=x(p),d=m.length;if(l&&d===0)return;l=d===0;let h=!1;if($){var b=o.data===Re;b!==(d===0)&&(o=ce(),Q(o),Z(!1),h=!0)}if($){for(var g=null,c,f=0;f<d;f++){if(P.nodeType===8&&P.data===Te){o=P,h=!0,Z(!1);break}var A=m[f],y=r(A,f);c=xe(P,i,g,null,A,y,f,s,a,e),i.items.set(y,c),g=c}d>0&&Q(ce())}$||ra(m,i,o,s,a,r,e),n!==null&&(d===0?u?be(u):u=ke(()=>n(o)):u!==null&&je(u,()=>{u=null})),h&&Z(!0),x(p)}),$&&(o=P)}function ra(t,a,e,r,s,n,o){var i=t.length,v=a.items,u=a.first,l=u,p,m=null,d=[],h=[],b,g,c,f;for(f=0;f<i;f+=1){if(b=t[f],g=n(b,f),c=v.get(g),c===void 0){var A=l?l.e.nodes_start:e;m=xe(A,a,m,m===null?a.first:m.next,b,g,f,r,s,o),v.set(g,m),d=[],h=[],l=m.next;continue}if(sa(c,b,f),(c.e.f&X)!==0&&be(c.e),c!==l){if(p!==void 0&&p.has(c)){if(d.length<h.length){var y=h[0],E;m=y.prev;var T=d[0],S=d[d.length-1];for(E=0;E<d.length;E+=1)he(d[E],y,e);for(E=0;E<h.length;E+=1)p.delete(h[E]);V(a,T.prev,S.next),V(a,m,T),V(a,S,y),l=y,m=S,f-=1,d=[],h=[]}else p.delete(c),he(c,l,e),V(a,c.prev,c.next),V(a,c,m===null?a.first:m.next),V(a,m,c),m=c;continue}for(d=[],h=[];l!==null&&l.k!==g;)(l.e.f&X)===0&&(p??(p=new Set)).add(l),h.push(l),l=l.next;if(l===null)continue;c=l}d.push(c),m=c,l=c.next}if(l!==null||p!==void 0){for(var C=p===void 0?[]:Ae(p);l!==null;)(l.e.f&X)===0&&C.push(l),l=l.next;var B=C.length;if(B>0){var j=i===0?e:null;ta(a,C,j,v)}}de.first=a.first&&a.first.e,de.last=m&&m.e}function sa(t,a,e,r){Pe(t.v,a),t.i=e}function xe(t,a,e,r,s,n,o,i,v,u){var l=(v&Ye)!==0,p=(v&Je)===0,m=l?p?D(s):ve(s):s,d=(v&Me)===0?o:ve(o),h={i:d,v:m,k:n,a:null,e:null,prev:e,next:r};try{return h.e=ke(()=>i(t,m,d,u),$),h.e.prev=e&&e.e,h.e.next=r&&r.e,e===null?a.first=h:(e.next=h,e.e.next=h.e),r!==null&&(r.prev=h,r.e.prev=h.e),h}finally{}}function he(t,a,e){for(var r=t.next?t.next.e.nodes_start:e,s=a?a.e.nodes_start:e,n=t.e.nodes_start;n!==r;){var o=Ge(n);s.before(n),n=o}}function V(t,a,e){a===null?t.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const me=[...` 	
\r\f \v\uFEFF`];function na(t,a,e){var r=""+t;if(e){for(var s in e)if(e[s])r=r?r+" "+s:s;else if(r.length)for(var n=s.length,o=0;(o=r.indexOf(s,o))>=0;){var i=o+n;(o===0||me.includes(r[o-1]))&&(i===r.length||me.includes(r[i]))?r=(o===0?"":r.substring(0,o))+r.substring(i+1):o=i}}return r===""?null:r}function oa(t,a,e,r,s,n){var o=t.__className;if($||o!==e||o===void 0){var i=na(e,r,n);(!$||i!==t.getAttribute("class"))&&(i==null?t.removeAttribute("class"):t.className=i),t.__className=e}else if(n&&s!==n)for(var v in n){var u=!!n[v];(s==null||u!==!!s[v])&&t.classList.toggle(v,u)}return n}const ia=Symbol("is custom element"),la=Symbol("is html");function z(t,a,e,r){var s=ca(t);$&&(s[a]=t.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&t.nodeName==="LINK")||s[a]!==(s[a]=e)&&(a==="loading"&&(t[qe]=e),e==null?t.removeAttribute(a):typeof e!="string"&&va(t).includes(a)?t[a]=e:t.setAttribute(a,e))}function ca(t){return t.__attributes??(t.__attributes={[ia]:t.nodeName.includes("-"),[la]:t.namespaceURI===Ke})}var pe=new Map;function va(t){var a=pe.get(t.nodeName);if(a)return a;pe.set(t.nodeName,a=[]);for(var e,r=t,s=Element.prototype;s!==r;){e=Qe(r);for(var n in e)e[n].set&&a.push(n);r=We(r)}return a}function Ie(t,a,e){if(t.multiple)return ua(t,a);for(var r of t.options){var s=U(r);if(Ze(s,a)){r.selected=!0;return}}(!e||a!==void 0)&&(t.selectedIndex=-1)}function da(t,a){ye(()=>{var e=new MutationObserver(()=>{var r=t.__value;Ie(t,r)});return e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function fa(t,a,e=a){var r=!0;aa(t,"change",s=>{var n=s?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(n),U);else{var i=t.querySelector(n)??t.querySelector("option:not([disabled])");o=i&&U(i)}e(o)}),ye(()=>{var s=a();if(Ie(t,s,r),r&&s===void 0){var n=t.querySelector(":checked");n!==null&&(s=U(n),e(s))}t.__value=s,r=!1}),da(t)}function ua(t,a){for(var e of t.options)e.selected=~a.indexOf(U(e))}function U(t){return"__value"in t?t.__value:t.value}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ee={faviconSize:128,faviconFetchServiceURL:t=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${t}&size=${Ee.faviconSize}`};async function ha(){const a="/bk"+"/bookmarks";try{const e=await fetch(a+"/index.json");if(e){const r=await e.json();if(Array.isArray(r)?r.length>0:!1){const o=r.sort().map(i=>fetch(a+"/"+i+".json").then(v=>v.json()).then(v=>(v.bookmarkIndexName=i,v)));return await Promise.all(o)}}}catch(e){console.error("bookmarks folder or bookmarks/index.json not found. Error:",e)}}async function ma(t){const a={};if(Array.isArray(t)?t.length>0:!1)for(let r=0;r<t.length;r++){const s=t[r],n=s.LINK,o=s.ICON;let i="";if(o)i=o;else if(n){const v=new URL(n),u=v.protocol+"//"+v.hostname;i=Ee.faviconFetchServiceURL(u)}else i=Le;s.bookmarkIndexName&&(a[s.bookmarkIndexName]=i)}return a}var pa=L('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),ga=L('<div class="bk-title svelte-1jzx7ns"> </div>'),_a=L('<div class="bk-desc svelte-1jzx7ns"> </div>'),ba=L('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function ge(t,a){G(a,!1);let e=fe(a,"bookmark",8),r=fe(a,"faviconLink",8);const s=e().LINK||"javascript:void(0)";let n=e().NAME||e().LINK;function o(c){const f=c==null?void 0:c.target;f&&(f.src=Le)}J();var i=ba();z(i,"href",s),z(i,"title",n);var v=k(i),u=k(v),l=k(u);_(u);var p=I(u,2);{var m=c=>{var f=pa(),A=k(f),y=k(A,!0);_(A);var E=I(A,2),T=k(E,!0);_(E),_(f),O(()=>{R(y,e().NAME),R(T,e().LINK)}),N(c,f)};w(p,c=>{e().IS_PINNED||c(m)})}_(v);var d=I(v,2);{var h=c=>{var f=ga(),A=k(f,!0);_(f),O(()=>R(A,e().TITLE)),N(c,f)};w(d,c=>{e().TITLE&&c(h)})}var b=I(d,2);{var g=c=>{var f=_a(),A=k(f,!0);_(f),O(()=>R(A,e().DESC)),N(c,f)};w(b,c=>{e().DESC&&c(g)})}_(i),O(()=>{z(i,"data-bookmark-icon",e().ICON),z(l,"src",r())}),ne("error",l,o),N(t,i),K()}var ka=L('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),Aa=L('<div class="bk-container-grid svelte-1uu4y0a"></div>'),ya=L('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Na(t,a){G(a,!1);let e=[],r=D([]),s=D([]),n=D({});async function o(){const d=await ha();d&&(e=d.sort((b,g)=>b.NAME.localeCompare(g.NAME)),Y(r,e.filter(b=>b.IS_PINNED)),Y(s,e.filter(b=>!b.IS_PINNED)))}Ne(async()=>{await o();const d=await ma(e);d&&Y(n,d)}),J();var i=ya(),v=k(i),u=k(v);{var l=d=>{var h=ka();ie(h,5,()=>x(r),oe,(b,g)=>{var c=re(),f=M(c);{var A=y=>{ge(y,{get bookmark(){return x(g)},get faviconLink(){return x(n)[x(g).bookmarkIndexName]}})};w(f,y=>{x(g).bookmarkIndexName&&y(A)})}N(b,c)}),_(h),N(d,h)};w(u,d=>{x(r).length>0&&d(l)})}var p=I(u,2);{var m=d=>{var h=Aa();ie(h,5,()=>x(s),oe,(b,g)=>{var c=re(),f=M(c);{var A=y=>{ge(y,{get bookmark(){return x(g)},get faviconLink(){return x(n)[x(g).bookmarkIndexName]}})};w(f,y=>{x(g).bookmarkIndexName&&y(A)})}N(b,c)}),_(h),N(d,h)};w(p,d=>{x(s).length>0&&d(m)})}_(v),_(i),N(t,i),K()}const le=H("home"),ae=H(null),te=H(null);var xa=L('<hr class="separator svelte-obx2py">'),Ia=L('<div class="header svelte-obx2py"><a class="brand svelte-obx2py"></a> <select class="view-list svelte-obx2py" id="view-list"><option>Home</option><option>Settings</option></select></div> <!>',1);function La(t){const[a,e]=q(),r=()=>F(le,"$selectedPage",a),s="https://m9j.github.io/bk";var n=Ia(),o=M(n),i=k(o);z(i,"href",s),i.textContent="BOOKMARKS";var v=I(i,2);O(()=>{r(),Xe(()=>{})});var u=k(v);u.value=u.__value="home";var l=I(u);l.value=l.__value="settings",_(v),_(o);var p=I(o,2);{var m=d=>{var h=xa();N(d,h)};w(p,d=>{r()!=="home"&&d(m)})}fa(v,r,d=>ea(le,d)),N(t,n),e()}async function Ea(t){if(t){let a=setTimeout(()=>{clearTimeout(a),t()},0)}}async function wa(){const a="/bk"+"/lambdas";try{const e=await fetch(a+"/index.json");if(e){let r=await e.json();if(r=r.filter(n=>!!n),Array.isArray(r)?r.length>0:!1){const n=r.map(o=>import(a+"/"+o+".lambda.js"));return await Promise.all(n)}}}catch(e){console.error("lambdas folder or lambdas/index.json not found. Error:",e)}}async function Sa(t){if(Array.isArray(t)?t.length>0:!1)for(const[e,r]of Object.entries(t))$a(r,Number(e))}const we=H([]);async function $a(t,a){Ea(async()=>{if(t.action&&typeof t.action=="function"){const e=v=>{we.update(u=>(u[a]=v,u))},r={updateValue:e},s=await t.action(r),n=["string","number","boolean"].includes(typeof s),o=typeof s=="object",i=typeof s=="function";if(s){if(n)e(s);else if(o){const v=Array.isArray(s);e(v?s.join(","):JSON.stringify(s))}else if(i){const v=()=>{let u=setTimeout(()=>{clearTimeout(u),s(e),v()},t.CONFIG_ACTION_DELAY||1e3)};v()}}}})}var Ca=L('<div class="lambda svelte-19zltv"><div class="lambda-title"> </div> <p class="lambda-result svelte-19zltv"> </p></div>'),Ba=L('<div class="lambdas-container svelte-19zltv"></div>');function Va(t,a){G(a,!1);const[e,r]=q(),s=()=>F(o,"$results",e);let n=D([]);const o=we;Ne(async()=>{const l=await wa();l&&(Array.isArray(l)&&l.length>0)&&(Y(n,l),Sa(x(n)))}),J();var i=re(),v=M(i);{var u=l=>{var p=Ba();ie(p,5,()=>x(n),oe,(m,d,h)=>{var b=Ca(),g=k(b),c=k(g);_(g);var f=I(g,2),A=k(f,!0);_(f),_(b),O(()=>{R(c,`${x(d).prompt??""}: `),R(A,s()[h]??"...")}),N(m,b)}),_(p),N(l,p)};w(v,l=>{x(n).length>0&&l(u)})}N(t,i),K(),r()}function Oa(){navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(a=>a.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(a=>Promise.all(a.map(e=>caches.delete(e)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(t){if(t){const a=new Date(Number(t)),e=String(a.getFullYear()),r=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),n=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0"),i=String(a.getSeconds()).padStart(2,"0");return`${e}.${r}${s}.${n}${o}${i}`}}async function Ra(){const a="/bk"+"/version.json";try{const e=await fetch(a);if(!e.ok)console.log(new Error("Failed to fetch current version"));else return(await e.json()).version}catch(e){console.error("Current version check failed: ",e)}}async function Ta(){const t="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const a=await fetch(t,{cache:"no-store"});if(!a.ok)console.log(new Error("Failed to fetch latest version"));else{const e=await a.json();return JSON.parse(atob(e.content)).version}}catch(a){console.error("Latest version check failed: ",a)}}var ja=L('<span class="monospace svelte-2le08x"> </span> <br>',1),Fa=L("<span> </span><br>",1),Ma=L("<div>Versions:<br> <!> <!></div>"),Pa=L('<div class="settings-container hide svelte-2le08x" id="settings-container"><div class="columns svelte-2le08x"><!></div> <div class="rows svelte-2le08x"><button class="settings-button svelte-2le08x">Check for latest version</button> <button class="settings-button svelte-2le08x">Hard reload application</button></div> <br> <div class="columns svelte-2le08x"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function za(t,a){G(a,!1);const[e,r]=q(),s=()=>F(ae,"$currentVersion",e),n=()=>F(te,"$latestVersion",e),o=()=>F(i,"$isNew",e),i=H(!1);(async()=>(await v(),await u()))();async function v(){const c=await Ra();ae.update(f=>c)}async function u(){const c=await Ta();te.update(f=>c),i.update(f=>Number(ue(te))>Number(ue(ae)))}J();var l=Pa(),p=k(l),m=k(p);{var d=c=>{var f=Ma(),A=I(k(f),3);{var y=S=>{var C=ja(),B=M(C),j=k(B);_(B),ee(2),O(W=>R(j,`${W??""} [CURRENT]`),[()=>_e(s())],se),N(S,C)};w(A,S=>{s()&&S(y)})}var E=I(A,2);{var T=S=>{var C=Fa(),B=M(C);let j;var W=k(B);_(B),ee(),O((Se,$e)=>{j=oa(B,1,"monospace svelte-2le08x",null,j,Se),R(W,`${$e??""} [LATEST]`)},[()=>({"is-new":o()}),()=>_e(n())],se),N(S,C)};w(E,S=>{n()&&S(T)})}_(f),N(c,f)};w(m,c=>{(s()||n())&&c(d)})}_(p);var h=I(p,2),b=k(h),g=I(b,2);_(h),ee(4),_(l),ne("click",b,()=>u()),ne("click",g,()=>Oa()),N(t,l),K(),r()}var Da=L('<div class="app-wrapper svelte-lehtuv"><!> <!> <div class="app-bottom-wrapper svelte-lehtuv"><!> <!></div></div>');function qa(t){const[a,e]=q(),r=()=>F(le,"$selectedPage",a);var s=Da(),n=k(s);Na(n,{});var o=I(n,2);Va(o,{});var i=I(o,2),v=k(i);La(v);var u=I(v,2);{var l=p=>{za(p,{})};w(u,p=>{r()==="settings"&&p(l)})}_(i),_(s),N(t,s),e()}export{qa as component};
