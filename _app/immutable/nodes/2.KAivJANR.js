import{t as L,a as x,c as te}from"../chunks/CyOrqUXm.js";import{i as J}from"../chunks/CL0QEqD9.js";import{A as Q,l as $,a0 as $e,$ as Ce,x as Be,i as Re,g as y,N as se,y as Ve,z as ce,B as Z,m as z,ad as Me,C as be,j as ke,D as Oe,ah as Ae,a8 as Pe,F as U,ap as ve,aq as X,a2 as de,ar as Te,as as je,at as Fe,ag as ze,au as De,k as Ue,av as He,aw as Ye,ab as Je,ax as Ge,ay as Ke,az as qe,aA as We,aj as Ne,aB as Qe,p as G,s as k,v as b,w as I,t as V,q as K,J as Y,o as j,aC as Ze,aD as ee}from"../chunks/DZpqQ712.js";import{p as fe,i as w,s as T,a as q,b as Xe}from"../chunks/B8VvTqyC.js";import{o as xe,w as F,g as ue}from"../chunks/HU1d89I3.js";import{l as ea,e as ne,s as M}from"../chunks/DUnFqAGD.js";function oe(r,e){return e}function aa(r,e,a,t){for(var s=[],n=e.length,o=0;o<n;o++)Fe(e[o].e,s,!0);var i=n>0&&s.length===0&&a!==null;if(i){var u=a.parentNode;ze(u),u.append(a),t.clear(),R(r,e[0].prev,e[n-1].next)}De(s,()=>{for(var m=0;m<n;m++){var d=e[m];i||(t.delete(d.k),R(r,d.prev,d.next)),Ue(d.e,!i)}})}function ie(r,e,a,t,s,n=null){var o=r,i={flags:e,items:new Map,first:null};{var u=r;o=$?Q($e(u)):u.appendChild(Ce())}$&&Be();var m=null,d=!1,g=se(()=>{var c=a();return Pe(c)?c:c==null?[]:Ae(c)});Re(()=>{var c=y(g),v=c.length;if(d&&v===0)return;d=v===0;let f=!1;if($){var p=o.data===Ve;p!==(v===0)&&(o=ce(),Q(o),Z(!1),f=!0)}if($){for(var _=null,l,h=0;h<v;h++){if(z.nodeType===8&&z.data===Me){o=z,f=!0,Z(!1);break}var A=c[h],N=t(A,h);l=ye(z,i,_,null,A,N,h,s,e,a),i.items.set(N,l),_=l}v>0&&Q(ce())}$||ra(c,i,o,s,e,t,a),n!==null&&(v===0?m?be(m):m=ke(()=>n(o)):m!==null&&Oe(m,()=>{m=null})),f&&Z(!0),y(g)}),$&&(o=z)}function ra(r,e,a,t,s,n,o){var i=r.length,u=e.items,m=e.first,d=m,g,c=null,v=[],f=[],p,_,l,h;for(h=0;h<i;h+=1){if(p=r[h],_=n(p,h),l=u.get(_),l===void 0){var A=d?d.e.nodes_start:a;c=ye(A,e,c,c===null?e.first:c.next,p,_,h,t,s,o),u.set(_,c),v=[],f=[],d=c.next;continue}if(ta(l,p,h),(l.e.f&X)!==0&&be(l.e),l!==d){if(g!==void 0&&g.has(l)){if(v.length<f.length){var N=f[0],E;c=N.prev;var O=v[0],S=v[v.length-1];for(E=0;E<v.length;E+=1)he(v[E],N,a);for(E=0;E<f.length;E+=1)g.delete(f[E]);R(e,O.prev,S.next),R(e,c,O),R(e,S,N),d=N,c=S,h-=1,v=[],f=[]}else g.delete(l),he(l,d,a),R(e,l.prev,l.next),R(e,l,c===null?e.first:c.next),R(e,c,l),c=l;continue}for(v=[],f=[];d!==null&&d.k!==_;)(d.e.f&X)===0&&(g??(g=new Set)).add(d),f.push(d),d=d.next;if(d===null)continue;l=d}v.push(l),c=l,d=l.next}if(d!==null||g!==void 0){for(var C=g===void 0?[]:Ae(g);d!==null;)(d.e.f&X)===0&&C.push(d),d=d.next;var B=C.length;if(B>0){var P=i===0?a:null;aa(e,C,P,u)}}de.first=e.first&&e.first.e,de.last=c&&c.e}function ta(r,e,a,t){je(r.v,e),r.i=a}function ye(r,e,a,t,s,n,o,i,u,m){var d=(u&He)!==0,g=(u&Ye)===0,c=d?g?U(s):ve(s):s,v=(u&Te)===0?o:ve(o),f={i:v,v:c,k:n,a:null,e:null,prev:a,next:t};try{return f.e=ke(()=>i(r,c,v,m),$),f.e.prev=a&&a.e,f.e.next=t&&t.e,a===null?e.first=f:(a.next=f,a.e.next=f.e),t!==null&&(t.prev=f,t.e.prev=f.e),f}finally{}}function he(r,e,a){for(var t=r.next?r.next.e.nodes_start:a,s=e?e.e.nodes_start:a,n=r.e.nodes_start;n!==t;){var o=Je(n);s.before(n),n=o}}function R(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}const me=[...` 	
\r\fÂ \v\uFEFF`];function sa(r,e,a){var t=""+r;if(a){for(var s in a)if(a[s])t=t?t+" "+s:s;else if(t.length)for(var n=s.length,o=0;(o=t.indexOf(s,o))>=0;){var i=o+n;(o===0||me.includes(t[o-1]))&&(i===t.length||me.includes(t[i]))?t=(o===0?"":t.substring(0,o))+t.substring(i+1):o=i}}return t===""?null:t}function na(r,e,a,t,s,n){var o=r.__className;if($||o!==a||o===void 0){var i=sa(a,t,n);(!$||i!==r.getAttribute("class"))&&(i==null?r.removeAttribute("class"):r.className=i),r.__className=a}else if(n&&s!==n)for(var u in n){var m=!!n[u];(s==null||m!==!!s[u])&&r.classList.toggle(u,m)}return n}const oa=Symbol("is custom element"),ia=Symbol("is html");function D(r,e,a,t){var s=la(r);$&&(s[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||s[e]!==(s[e]=a)&&(e==="loading"&&(r[Ke]=a),a==null?r.removeAttribute(e):typeof a!="string"&&ca(r).includes(e)?r[e]=a:r.setAttribute(e,a))}function la(r){return r.__attributes??(r.__attributes={[oa]:r.nodeName.includes("-"),[ia]:r.namespaceURI===Ge})}var ge=new Map;function ca(r){var e=ge.get(r.nodeName);if(e)return e;ge.set(r.nodeName,e=[]);for(var a,t=r,s=Element.prototype;s!==t;){a=We(t);for(var n in a)a[n].set&&e.push(n);t=qe(t)}return e}function Ie(r,e,a){if(r.multiple)return fa(r,e);for(var t of r.options){var s=H(t);if(Qe(s,e)){t.selected=!0;return}}(!a||e!==void 0)&&(r.selectedIndex=-1)}function va(r,e){Ne(()=>{var a=new MutationObserver(()=>{var t=r.__value;Ie(r,t)});return a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function da(r,e,a=e){var t=!0;ea(r,"change",s=>{var n=s?"[selected]":":checked",o;if(r.multiple)o=[].map.call(r.querySelectorAll(n),H);else{var i=r.querySelector(n)??r.querySelector("option:not([disabled])");o=i&&H(i)}a(o)}),Ne(()=>{var s=e();if(Ie(r,s,t),t&&s===void 0){var n=r.querySelector(":checked");n!==null&&(s=H(n),a(s))}r.__value=s,t=!1}),va(r)}function fa(r,e){for(var a of r.options)a.selected=~e.indexOf(H(a))}function H(r){return"__value"in r?r.__value:r.value}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ee={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${Ee.faviconSize}`};async function ua(){const e="/bk"+"/bookmarks";try{const a=await fetch(e+"/index.json");if(a){const t=await a.json();if(Array.isArray(t)?t.length>0:!1){const o=t.sort().map(i=>fetch(e+"/"+i+".json").then(u=>u.json()).then(u=>(u.bookmarkIndexName=i,u)));return await Promise.all(o)}}}catch(a){console.error("bookmarks folder or bookmarks/index.json not found. Error:",a)}}async function ha(r){const e={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const s=r[t],n=s.LINK,o=s.ICON;let i="";if(o)i=o;else if(n){const u=new URL(n),m=u.protocol+"//"+u.hostname;i=Ee.faviconFetchServiceURL(m)}else i=Le;s.bookmarkIndexName&&(e[s.bookmarkIndexName]=i)}return e}var ma=L('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),ga=L('<div class="bk-title svelte-1jzx7ns"> </div>'),pa=L('<div class="bk-desc svelte-1jzx7ns"> </div>'),_a=L('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function pe(r,e){G(e,!1);let a=fe(e,"bookmark",8),t=fe(e,"faviconLink",8);const s=a().LINK||"javascript:void(0)";let n=a().NAME||a().LINK;function o(l){const h=l==null?void 0:l.target;h&&(h.src=Le)}J();var i=_a();D(i,"href",s),D(i,"title",n);var u=k(i),m=k(u),d=k(m);b(m);var g=I(m,2);{var c=l=>{var h=ma(),A=k(h),N=k(A,!0);b(A);var E=I(A,2),O=k(E,!0);b(E),b(h),V(()=>{M(N,a().NAME),M(O,a().LINK)}),x(l,h)};w(g,l=>{a().IS_PINNED||l(c)})}b(u);var v=I(u,2);{var f=l=>{var h=ga(),A=k(h,!0);b(h),V(()=>M(A,a().TITLE)),x(l,h)};w(v,l=>{a().TITLE&&l(f)})}var p=I(v,2);{var _=l=>{var h=pa(),A=k(h,!0);b(h),V(()=>M(A,a().DESC)),x(l,h)};w(p,l=>{a().DESC&&l(_)})}b(i),V(()=>{D(i,"data-bookmark-icon",a().ICON),D(d,"src",t())}),ne("error",d,o),x(r,i),K()}var ba=L('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),ka=L('<div class="bk-container-grid svelte-1uu4y0a"></div>'),Aa=L('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Na(r,e){G(e,!1);let a=[],t=U([]),s=U([]),n=U({});async function o(){const v=await ua();v&&(a=v.sort((p,_)=>p.NAME.localeCompare(_.NAME)),Y(t,a.filter(p=>p.IS_PINNED)),Y(s,a.filter(p=>!p.IS_PINNED)))}xe(async()=>{await o();const v=await ha(a);v&&Y(n,v)}),J();var i=Aa(),u=k(i),m=k(u);{var d=v=>{var f=ba();ie(f,5,()=>y(t),oe,(p,_)=>{var l=te(),h=j(l);{var A=N=>{pe(N,{get bookmark(){return y(_)},get faviconLink(){return y(n)[y(_).bookmarkIndexName]}})};w(h,N=>{y(_).bookmarkIndexName&&N(A)})}x(p,l)}),b(f),x(v,f)};w(m,v=>{y(t).length>0&&v(d)})}var g=I(m,2);{var c=v=>{var f=ka();ie(f,5,()=>y(s),oe,(p,_)=>{var l=te(),h=j(l);{var A=N=>{pe(N,{get bookmark(){return y(_)},get faviconLink(){return y(n)[y(_).bookmarkIndexName]}})};w(h,N=>{y(_).bookmarkIndexName&&N(A)})}x(p,l)}),b(f),x(v,f)};w(g,v=>{y(s).length>0&&v(c)})}b(u),b(i),x(r,i),K()}const le=F("home"),ae=F(null),re=F(null);var xa=L('<hr class="separator svelte-obx2py">'),ya=L('<div class="header svelte-obx2py"><a class="brand svelte-obx2py"></a> <select class="view-list svelte-obx2py" id="view-list"><option>Home</option><option>Settings</option></select></div> <!>',1);function Ia(r){const[e,a]=q(),t=()=>T(le,"$selectedPage",e),s="https://m9j.github.io/bk";var n=ya(),o=j(n),i=k(o);D(i,"href",s),i.textContent="BOOKMARKS";var u=I(i,2);V(()=>{t(),Ze(()=>{})});var m=k(u);m.value=m.__value="home";var d=I(m);d.value=d.__value="settings",b(u),b(o);var g=I(o,2);{var c=v=>{var f=xa();x(v,f)};w(g,v=>{t()!=="home"&&v(c)})}da(u,t,v=>Xe(le,v)),x(r,n),a()}async function La(){const e="/bk"+"/lambdas";try{const a=await fetch(e+"/index.json");if(a){const t=await a.json();if(Array.isArray(t)?t.length>0:!1){const n=t.map(o=>import(e+"/"+o+".lambda.js"));return await Promise.all(n)}}}catch(a){console.error("lambdas folder or lambdas/index.json not found. Error:",a)}}var Ea=L('<div class="lambda svelte-vmgkgn"><div class="lambda-title"> <span class="lambda-result"> </span></div></div>'),wa=L('<div class="lambdas-container svelte-vmgkgn"></div>');function Sa(r,e){G(e,!1);const[a,t]=q(),s=()=>T(o,"$results",a);let n=U([]);const o=F([]);xe(async()=>{const c=await La();if(c&&(console.log("lambdaModules",c),Array.isArray(c)?c.length>0:!1)){const f=[];for(const p of c)f.push({...p,result:F("")});Y(n,f),i(y(n))}});async function i(c){if(Array.isArray(c)?c.length>0:!1)for(const[f,p]of Object.entries(c))u(p,Number(f))}async function u(c,v){let f=setTimeout(()=>{if(c.action&&typeof c.action=="function"){clearTimeout(f);const p=c.action();o.update(_=>(_[v]=p,_))}},Math.random()*0)}J();var m=te(),d=j(m);{var g=c=>{var v=wa();ie(v,5,()=>y(n),oe,(f,p,_)=>{var l=Ea(),h=k(l),A=k(h),N=I(A),E=k(N,!0);b(N),b(h),b(l),V(()=>{M(A,`${y(p).prompt??""}: `),M(E,s()[_]??"...")}),x(f,l)}),b(v),x(c,v)};w(d,c=>{y(n).length>0&&c(g)})}x(r,m),K(),t()}function $a(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(a=>caches.delete(a)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(r){if(r){const e=new Date(Number(r)),a=String(e.getFullYear()),t=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return`${a}.${t}${s}.${n}${o}${i}`}}async function Ca(){const e="/bk"+"/version.json";try{const a=await fetch(e);if(!a.ok)console.log(new Error("Failed to fetch current version"));else return(await a.json()).version}catch(a){console.error("Current version check failed: ",a)}}async function Ba(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(r,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const a=await e.json();return JSON.parse(atob(a.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var Ra=L('<span class="monospace svelte-2le08x"> </span> <br>',1),Va=L("<span> </span><br>",1),Ma=L("<div>Versions:<br> <!> <!></div>"),Oa=L('<div class="settings-container hide svelte-2le08x" id="settings-container"><div class="columns svelte-2le08x"><!></div> <div class="rows svelte-2le08x"><button class="settings-button svelte-2le08x">Check for latest version</button> <button class="settings-button svelte-2le08x">Hard reload application</button></div> <br> <div class="columns svelte-2le08x"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function Pa(r,e){G(e,!1);const[a,t]=q(),s=()=>T(ae,"$currentVersion",a),n=()=>T(re,"$latestVersion",a),o=()=>T(i,"$isNew",a),i=F(!1);(async()=>(await u(),await m()))();async function u(){const l=await Ca();ae.update(h=>l)}async function m(){const l=await Ba();re.update(h=>l),i.update(h=>Number(ue(re))>Number(ue(ae)))}J();var d=Oa(),g=k(d),c=k(g);{var v=l=>{var h=Ma(),A=I(k(h),3);{var N=S=>{var C=Ra(),B=j(C),P=k(B);b(B),ee(2),V(W=>M(P,`${W??""} [CURRENT]`),[()=>_e(s())],se),x(S,C)};w(A,S=>{s()&&S(N)})}var E=I(A,2);{var O=S=>{var C=Va(),B=j(C);let P;var W=k(B);b(B),ee(),V((we,Se)=>{P=na(B,1,"monospace svelte-2le08x",null,P,we),M(W,`${Se??""} [LATEST]`)},[()=>({"is-new":o()}),()=>_e(n())],se),x(S,C)};w(E,S=>{n()&&S(O)})}b(h),x(l,h)};w(c,l=>{(s()||n())&&l(v)})}b(g);var f=I(g,2),p=k(f),_=I(p,2);b(f),ee(4),b(d),ne("click",p,()=>m()),ne("click",_,()=>$a()),x(r,d),K(),t()}var Ta=L('<div class="app-wrapper svelte-lehtuv"><!> <!> <div class="app-bottom-wrapper svelte-lehtuv"><!> <!></div></div>');function Ya(r){const[e,a]=q(),t=()=>T(le,"$selectedPage",e);var s=Ta(),n=k(s);Na(n,{});var o=I(n,2);Sa(o,{});var i=I(o,2),u=k(i);Ia(u);var m=I(u,2);{var d=g=>{Pa(g,{})};w(m,g=>{t()==="settings"&&g(d)})}b(i),b(s),x(r,s),a()}export{Ya as component};
