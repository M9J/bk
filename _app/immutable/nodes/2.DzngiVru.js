import{t as w,a as I,c as re}from"../chunks/CyOrqUXm.js";import{i as Y}from"../chunks/CL0QEqD9.js";import{A as W,l as $,a0 as $e,$ as Be,x as Ce,i as Re,g as x,N as te,y as Ve,z as ve,B as Q,m as P,ad as Fe,C as ke,j as be,D as Me,ah as Ae,a8 as Oe,F as T,ap as ce,aq as Z,a2 as de,ar as Pe,as as je,at as Te,ag as ze,au as De,k as Ue,av as He,aw as Ye,ab as Je,ax as Ge,ay as Ke,az as qe,aA as We,aj as Ne,aB as Qe,p as J,s as _,v as g,w as y,t as V,q as G,J as H,o as U,aC as Ze,aD as X}from"../chunks/DZpqQ712.js";import{p as fe,i as L,s as z,a as le,b as Xe}from"../chunks/B8VvTqyC.js";import{o as xe,w as K,g as ue}from"../chunks/HU1d89I3.js";import{l as ea,e as se,s as F}from"../chunks/DUnFqAGD.js";function ne(r,a){return a}function aa(r,a,e,t){for(var s=[],i=a.length,n=0;n<i;n++)Te(a[n].e,s,!0);var o=i>0&&s.length===0&&e!==null;if(o){var d=e.parentNode;ze(d),d.append(e),t.clear(),R(r,a[0].prev,a[i-1].next)}De(s,()=>{for(var c=0;c<i;c++){var v=a[c];o||(t.delete(v.k),R(r,v.prev,v.next)),Ue(v.e,!o)}})}function oe(r,a,e,t,s,i=null){var n=r,o={flags:a,items:new Map,first:null};{var d=r;n=$?W($e(d)):d.appendChild(Be())}$&&Ce();var c=null,v=!1,h=te(()=>{var p=e();return Oe(p)?p:p==null?[]:Ae(p)});Re(()=>{var p=x(h),f=p.length;if(v&&f===0)return;v=f===0;let m=!1;if($){var b=n.data===Ve;b!==(f===0)&&(n=ve(),W(n),Q(!1),m=!0)}if($){for(var k=null,l,u=0;u<f;u++){if(P.nodeType===8&&P.data===Fe){n=P,m=!0,Q(!1);break}var A=p[u],N=t(A,u);l=Ie(P,o,k,null,A,N,u,s,a,e),o.items.set(N,l),k=l}f>0&&W(ve())}$||ra(p,o,n,s,a,t,e),i!==null&&(f===0?c?ke(c):c=be(()=>i(n)):c!==null&&Me(c,()=>{c=null})),m&&Q(!0),x(h)}),$&&(n=P)}function ra(r,a,e,t,s,i,n){var o=r.length,d=a.items,c=a.first,v=c,h,p=null,f=[],m=[],b,k,l,u;for(u=0;u<o;u+=1){if(b=r[u],k=i(b,u),l=d.get(k),l===void 0){var A=v?v.e.nodes_start:e;p=Ie(A,a,p,p===null?a.first:p.next,b,k,u,t,s,n),d.set(k,p),f=[],m=[],v=p.next;continue}if(ta(l,b,u),(l.e.f&Z)!==0&&ke(l.e),l!==v){if(h!==void 0&&h.has(l)){if(f.length<m.length){var N=m[0],E;p=N.prev;var M=f[0],S=f[f.length-1];for(E=0;E<f.length;E+=1)me(f[E],N,e);for(E=0;E<m.length;E+=1)h.delete(m[E]);R(a,M.prev,S.next),R(a,p,M),R(a,S,N),v=N,p=S,u-=1,f=[],m=[]}else h.delete(l),me(l,v,e),R(a,l.prev,l.next),R(a,l,p===null?a.first:p.next),R(a,p,l),p=l;continue}for(f=[],m=[];v!==null&&v.k!==k;)(v.e.f&Z)===0&&(h??(h=new Set)).add(v),m.push(v),v=v.next;if(v===null)continue;l=v}f.push(l),p=l,v=l.next}if(v!==null||h!==void 0){for(var B=h===void 0?[]:Ae(h);v!==null;)(v.e.f&Z)===0&&B.push(v),v=v.next;var C=B.length;if(C>0){var O=o===0?e:null;aa(a,B,O,d)}}de.first=a.first&&a.first.e,de.last=p&&p.e}function ta(r,a,e,t){je(r.v,a),r.i=e}function Ie(r,a,e,t,s,i,n,o,d,c){var v=(d&He)!==0,h=(d&Ye)===0,p=v?h?T(s):ce(s):s,f=(d&Pe)===0?n:ce(n),m={i:f,v:p,k:i,a:null,e:null,prev:e,next:t};try{return m.e=be(()=>o(r,p,f,c),$),m.e.prev=e&&e.e,m.e.next=t&&t.e,e===null?a.first=m:(e.next=m,e.e.next=m.e),t!==null&&(t.prev=m,t.e.prev=m.e),m}finally{}}function me(r,a,e){for(var t=r.next?r.next.e.nodes_start:e,s=a?a.e.nodes_start:e,i=r.e.nodes_start;i!==t;){var n=Je(i);s.before(i),i=n}}function R(r,a,e){a===null?r.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const pe=[...` 	
\r\fÂ \v\uFEFF`];function sa(r,a,e){var t=""+r;if(e){for(var s in e)if(e[s])t=t?t+" "+s:s;else if(t.length)for(var i=s.length,n=0;(n=t.indexOf(s,n))>=0;){var o=n+i;(n===0||pe.includes(t[n-1]))&&(o===t.length||pe.includes(t[o]))?t=(n===0?"":t.substring(0,n))+t.substring(o+1):n=o}}return t===""?null:t}function na(r,a,e,t,s,i){var n=r.__className;if($||n!==e||n===void 0){var o=sa(e,t,i);(!$||o!==r.getAttribute("class"))&&(o==null?r.removeAttribute("class"):r.className=o),r.__className=e}else if(i&&s!==i)for(var d in i){var c=!!i[d];(s==null||c!==!!s[d])&&r.classList.toggle(d,c)}return i}const oa=Symbol("is custom element"),ia=Symbol("is html");function j(r,a,e,t){var s=la(r);$&&(s[a]=r.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&r.nodeName==="LINK")||s[a]!==(s[a]=e)&&(a==="loading"&&(r[Ke]=e),e==null?r.removeAttribute(a):typeof e!="string"&&va(r).includes(a)?r[a]=e:r.setAttribute(a,e))}function la(r){return r.__attributes??(r.__attributes={[oa]:r.nodeName.includes("-"),[ia]:r.namespaceURI===Ge})}var he=new Map;function va(r){var a=he.get(r.nodeName);if(a)return a;he.set(r.nodeName,a=[]);for(var e,t=r,s=Element.prototype;s!==t;){e=We(t);for(var i in e)e[i].set&&a.push(i);t=qe(t)}return a}function ye(r,a,e){if(r.multiple)return fa(r,a);for(var t of r.options){var s=D(t);if(Qe(s,a)){t.selected=!0;return}}(!e||a!==void 0)&&(r.selectedIndex=-1)}function ca(r,a){Ne(()=>{var e=new MutationObserver(()=>{var t=r.__value;ye(r,t)});return e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function da(r,a,e=a){var t=!0;ea(r,"change",s=>{var i=s?"[selected]":":checked",n;if(r.multiple)n=[].map.call(r.querySelectorAll(i),D);else{var o=r.querySelector(i)??r.querySelector("option:not([disabled])");n=o&&D(o)}e(n)}),Ne(()=>{var s=a();if(ye(r,s,t),t&&s===void 0){var i=r.querySelector(":checked");i!==null&&(s=D(i),e(s))}r.__value=s,t=!1}),ca(r)}function fa(r,a){for(var e of r.options)e.selected=~a.indexOf(D(e))}function D(r){return"__value"in r?r.__value:r.value}const we="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ee={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${Ee.faviconSize}`};async function ua(){const a="/bk"+"/bookmarks";try{const e=await fetch(a+"/index.json");if(e){const t=await e.json();if(Array.isArray(t)?t.length>0:!1){const n=t.sort().map(o=>fetch(a+"/"+o+".json").then(d=>d.json()).then(d=>(d.bookmarkIndexName=o,d)));return await Promise.all(n)}}}catch(e){console.error("bookmarks folder or bookmarks/index.json not found. Error:",e)}}async function ma(r){const a={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const s=r[t],i=s.LINK,n=s.ICON;let o="";if(n)o=n;else if(i){const d=new URL(i),c=d.protocol+"//"+d.hostname;o=Ee.faviconFetchServiceURL(c)}else o=we;s.bookmarkIndexName&&(a[s.bookmarkIndexName]=o)}return a}var pa=w('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),ha=w('<div class="bk-title svelte-1jzx7ns"> </div>'),ga=w('<div class="bk-desc svelte-1jzx7ns"> </div>'),_a=w('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function ge(r,a){J(a,!1);let e=fe(a,"bookmark",8),t=fe(a,"faviconLink",8);const s=e().LINK||"javascript:void(0)";let i=e().NAME||e().LINK;function n(l){const u=l==null?void 0:l.target;u&&(u.src=we)}Y();var o=_a();j(o,"href",s),j(o,"title",i);var d=_(o),c=_(d),v=_(c);g(c);var h=y(c,2);{var p=l=>{var u=pa(),A=_(u),N=_(A,!0);g(A);var E=y(A,2),M=_(E,!0);g(E),g(u),V(()=>{F(N,e().NAME),F(M,e().LINK)}),I(l,u)};L(h,l=>{e().IS_PINNED||l(p)})}g(d);var f=y(d,2);{var m=l=>{var u=ha(),A=_(u,!0);g(u),V(()=>F(A,e().TITLE)),I(l,u)};L(f,l=>{e().TITLE&&l(m)})}var b=y(f,2);{var k=l=>{var u=ga(),A=_(u,!0);g(u),V(()=>F(A,e().DESC)),I(l,u)};L(b,l=>{e().DESC&&l(k)})}g(o),V(()=>{j(o,"data-bookmark-icon",e().ICON),j(v,"src",t())}),se("error",v,n),I(r,o),G()}var ka=w('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),ba=w('<div class="bk-container-grid svelte-1uu4y0a"></div>'),Aa=w('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Na(r,a){J(a,!1);let e=[],t=T([]),s=T([]),i=T({});async function n(){const f=await ua();f&&(e=f.sort((b,k)=>b.NAME.localeCompare(k.NAME)),H(t,e.filter(b=>b.IS_PINNED)),H(s,e.filter(b=>!b.IS_PINNED)))}xe(async()=>{await n();const f=await ma(e);f&&H(i,f)}),Y();var o=Aa(),d=_(o),c=_(d);{var v=f=>{var m=ka();oe(m,5,()=>x(t),ne,(b,k)=>{var l=re(),u=U(l);{var A=N=>{ge(N,{get bookmark(){return x(k)},get faviconLink(){return x(i)[x(k).bookmarkIndexName]}})};L(u,N=>{x(k).bookmarkIndexName&&N(A)})}I(b,l)}),g(m),I(f,m)};L(c,f=>{x(t).length>0&&f(v)})}var h=y(c,2);{var p=f=>{var m=ba();oe(m,5,()=>x(s),ne,(b,k)=>{var l=re(),u=U(l);{var A=N=>{ge(N,{get bookmark(){return x(k)},get faviconLink(){return x(i)[x(k).bookmarkIndexName]}})};L(u,N=>{x(k).bookmarkIndexName&&N(A)})}I(b,l)}),g(m),I(f,m)};L(h,f=>{x(s).length>0&&f(p)})}g(d),g(o),I(r,o),G()}const ie=K("home"),ee=K(null),ae=K(null);var xa=w('<div class="header svelte-yid11a"><a class="brand svelte-yid11a"></a> <select class="view-list svelte-yid11a" id="view-list"><option>Home</option><option>Settings</option></select></div>');function Ia(r){const[a,e]=le(),t=()=>z(ie,"$selectedPage",a),s="https://m9j.github.io/bk";var i=xa(),n=_(i);j(n,"href",s),n.textContent="BOOKMARKS";var o=y(n,2);V(()=>{t(),Ze(()=>{})});var d=_(o);d.value=d.__value="home";var c=y(d);c.value=c.__value="settings",g(o),g(i),da(o,t,v=>Xe(ie,v)),I(r,i),e()}async function ya(){const a="/bk"+"/lambdas";try{const e=await fetch(a+"/index.json");if(e){const t=await e.json();if(Array.isArray(t)?t.length>0:!1){const i=t.map(n=>import(a+"/"+n+".lambda.js"));return await Promise.all(i)}}}catch(e){console.error("lambdas folder or lambdas/index.json not found. Error:",e)}}var wa=w('<div class="lambda svelte-vmgkgn"><div class="lambda-title"> <span class="lambda-result"> </span></div></div>'),Ea=w('<div class="lambdas-container svelte-vmgkgn"></div>');function La(r,a){J(a,!1);let e=T([]);xe(async()=>{const n=await ya();if(n){const o=n.map(c=>c.default);(Array.isArray(o)?o.length>0:!1)&&H(e,o.map(c=>{if(c.mainFn&&typeof c.mainFn=="function"){const v=c.mainFn();return c.result=v,c}else return c}))}}),Y();var t=re(),s=U(t);{var i=n=>{var o=Ea();oe(o,5,()=>x(e),ne,(d,c)=>{var v=wa(),h=_(v),p=_(h),f=y(p),m=_(f,!0);g(f),g(h),g(v),V(()=>{F(p,`${x(c).title??""}: `),F(m,x(c).result)}),I(d,v)}),g(o),I(n,o)};L(s,n=>{x(e).length>0&&n(i)})}I(r,t),G()}function Sa(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(a=>a.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(a=>Promise.all(a.map(e=>caches.delete(e)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(r){if(r){const a=new Date(Number(r)),e=String(a.getFullYear()),t=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0"),n=String(a.getMinutes()).padStart(2,"0"),o=String(a.getSeconds()).padStart(2,"0");return`${e}.${t}${s}.${i}${n}${o}`}}async function $a(){const a="/bk"+"/version.json";try{const e=await fetch(a);if(!e.ok)console.log(new Error("Failed to fetch current version"));else return(await e.json()).version}catch(e){console.error("Current version check failed: ",e)}}async function Ba(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const a=await fetch(r,{cache:"no-store"});if(!a.ok)console.log(new Error("Failed to fetch latest version"));else{const e=await a.json();return JSON.parse(atob(e.content)).version}}catch(a){console.error("Latest version check failed: ",a)}}var Ca=w('<span class="monospace svelte-1kpux3b"> </span> <br>',1),Ra=w("<span> </span><br>",1),Va=w("<div>Versions:<br> <!> <!></div>"),Fa=w('<div class="settings-container hide svelte-1kpux3b" id="settings-container"><div class="columns svelte-1kpux3b"><!></div> <div class="rows svelte-1kpux3b"><button class="settings-button svelte-1kpux3b">Check for latest version</button> <button class="settings-button svelte-1kpux3b">Hard reload application</button></div> <br> <div class="columns svelte-1kpux3b"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function Ma(r,a){J(a,!1);const[e,t]=le(),s=()=>z(ee,"$currentVersion",e),i=()=>z(ae,"$latestVersion",e),n=()=>z(o,"$isNew",e),o=K(!1);(async()=>(await d(),await c()))();async function d(){const l=await $a();ee.update(u=>l)}async function c(){const l=await Ba();ae.update(u=>l),o.update(u=>Number(ue(ae))>Number(ue(ee)))}Y();var v=Fa(),h=_(v),p=_(h);{var f=l=>{var u=Va(),A=y(_(u),3);{var N=S=>{var B=Ca(),C=U(B),O=_(C);g(C),X(2),V(q=>F(O,`${q??""} [CURRENT]`),[()=>_e(s())],te),I(S,B)};L(A,S=>{s()&&S(N)})}var E=y(A,2);{var M=S=>{var B=Ra(),C=U(B);let O;var q=_(C);g(C),X(),V((Le,Se)=>{O=na(C,1,"monospace svelte-1kpux3b",null,O,Le),F(q,`${Se??""} [LATEST]`)},[()=>({"is-new":n()}),()=>_e(i())],te),I(S,B)};L(E,S=>{i()&&S(M)})}g(u),I(l,u)};L(p,l=>{(s()||i())&&l(f)})}g(h);var m=y(h,2),b=_(m),k=y(b,2);g(m),X(4),g(v),se("click",b,()=>c()),se("click",k,()=>Sa()),I(r,v),G(),t()}var Oa=w('<div class="app-wrapper svelte-jtpawk"><!> <!> <div class="app-bottom-wrapper svelte-jtpawk"><!> <!></div></div>');function Ha(r){const[a,e]=le(),t=()=>z(ie,"$selectedPage",a);var s=Oa(),i=_(s);Na(i,{});var n=y(i,2);La(n,{});var o=y(n,2),d=_(o);Ia(d);var c=y(d,2);{var v=h=>{Ma(h,{})};L(c,h=>{t()==="settings"&&h(v)})}g(o),g(s),I(r,s),e()}export{Ha as component};
