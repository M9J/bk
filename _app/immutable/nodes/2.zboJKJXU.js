import{t as L,a as x,c as re}from"../chunks/CyOrqUXm.js";import{i as J}from"../chunks/CL0QEqD9.js";import{A as Q,l as $,a0 as Be,$ as Ce,x as Re,i as Ve,g as y,N as se,y as Oe,z as ce,B as Z,m as j,ad as Me,C as be,j as ke,D as Pe,ah as Ae,a8 as Te,F as D,ap as ve,aq as X,a2 as de,ar as Fe,as as je,at as ze,ag as De,au as Ue,k as He,av as Ye,aw as Je,ab as Ge,ax as Ke,ay as qe,az as We,aA as Qe,aj as Ne,aB as Ze,p as G,s as k,v as p,w as I,t as V,q as K,J as Y,o as F,aC as Xe,aD as ee}from"../chunks/DZpqQ712.js";import{p as fe,i as w,s as T,a as q,b as ea}from"../chunks/B8VvTqyC.js";import{o as xe,w as H,g as ue}from"../chunks/HU1d89I3.js";import{l as aa,e as ne,s as O}from"../chunks/DUnFqAGD.js";function oe(t,e){return e}function ta(t,e,a,r){for(var s=[],n=e.length,o=0;o<n;o++)ze(e[o].e,s,!0);var i=n>0&&s.length===0&&a!==null;if(i){var d=a.parentNode;De(d),d.append(a),r.clear(),R(t,e[0].prev,e[n-1].next)}Ue(s,()=>{for(var m=0;m<n;m++){var l=e[m];i||(r.delete(l.k),R(t,l.prev,l.next)),He(l.e,!i)}})}function ie(t,e,a,r,s,n=null){var o=t,i={flags:e,items:new Map,first:null};{var d=t;o=$?Q(Be(d)):d.appendChild(Ce())}$&&Re();var m=null,l=!1,g=se(()=>{var h=a();return Te(h)?h:h==null?[]:Ae(h)});Ve(()=>{var h=y(g),v=h.length;if(l&&v===0)return;l=v===0;let u=!1;if($){var _=o.data===Oe;_!==(v===0)&&(o=ce(),Q(o),Z(!1),u=!0)}if($){for(var b=null,c,f=0;f<v;f++){if(j.nodeType===8&&j.data===Me){o=j,u=!0,Z(!1);break}var A=h[f],N=r(A,f);c=ye(j,i,b,null,A,N,f,s,e,a),i.items.set(N,c),b=c}v>0&&Q(ce())}$||ra(h,i,o,s,e,r,a),n!==null&&(v===0?m?be(m):m=ke(()=>n(o)):m!==null&&Pe(m,()=>{m=null})),u&&Z(!0),y(g)}),$&&(o=j)}function ra(t,e,a,r,s,n,o){var i=t.length,d=e.items,m=e.first,l=m,g,h=null,v=[],u=[],_,b,c,f;for(f=0;f<i;f+=1){if(_=t[f],b=n(_,f),c=d.get(b),c===void 0){var A=l?l.e.nodes_start:a;h=ye(A,e,h,h===null?e.first:h.next,_,b,f,r,s,o),d.set(b,h),v=[],u=[],l=h.next;continue}if(sa(c,_,f),(c.e.f&X)!==0&&be(c.e),c!==l){if(g!==void 0&&g.has(c)){if(v.length<u.length){var N=u[0],E;h=N.prev;var M=v[0],S=v[v.length-1];for(E=0;E<v.length;E+=1)he(v[E],N,a);for(E=0;E<u.length;E+=1)g.delete(u[E]);R(e,M.prev,S.next),R(e,h,M),R(e,S,N),l=N,h=S,f-=1,v=[],u=[]}else g.delete(c),he(c,l,a),R(e,c.prev,c.next),R(e,c,h===null?e.first:h.next),R(e,h,c),h=c;continue}for(v=[],u=[];l!==null&&l.k!==b;)(l.e.f&X)===0&&(g??(g=new Set)).add(l),u.push(l),l=l.next;if(l===null)continue;c=l}v.push(c),h=c,l=c.next}if(l!==null||g!==void 0){for(var B=g===void 0?[]:Ae(g);l!==null;)(l.e.f&X)===0&&B.push(l),l=l.next;var C=B.length;if(C>0){var P=i===0?a:null;ta(e,B,P,d)}}de.first=e.first&&e.first.e,de.last=h&&h.e}function sa(t,e,a,r){je(t.v,e),t.i=a}function ye(t,e,a,r,s,n,o,i,d,m){var l=(d&Ye)!==0,g=(d&Je)===0,h=l?g?D(s):ve(s):s,v=(d&Fe)===0?o:ve(o),u={i:v,v:h,k:n,a:null,e:null,prev:a,next:r};try{return u.e=ke(()=>i(t,h,v,m),$),u.e.prev=a&&a.e,u.e.next=r&&r.e,a===null?e.first=u:(a.next=u,a.e.next=u.e),r!==null&&(r.prev=u,r.e.prev=u.e),u}finally{}}function he(t,e,a){for(var r=t.next?t.next.e.nodes_start:a,s=e?e.e.nodes_start:a,n=t.e.nodes_start;n!==r;){var o=Ge(n);s.before(n),n=o}}function R(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}const me=[...` 	
\r\fÂ \v\uFEFF`];function na(t,e,a){var r=""+t;if(a){for(var s in a)if(a[s])r=r?r+" "+s:s;else if(r.length)for(var n=s.length,o=0;(o=r.indexOf(s,o))>=0;){var i=o+n;(o===0||me.includes(r[o-1]))&&(i===r.length||me.includes(r[i]))?r=(o===0?"":r.substring(0,o))+r.substring(i+1):o=i}}return r===""?null:r}function oa(t,e,a,r,s,n){var o=t.__className;if($||o!==a||o===void 0){var i=na(a,r,n);(!$||i!==t.getAttribute("class"))&&(i==null?t.removeAttribute("class"):t.className=i),t.__className=a}else if(n&&s!==n)for(var d in n){var m=!!n[d];(s==null||m!==!!s[d])&&t.classList.toggle(d,m)}return n}const ia=Symbol("is custom element"),la=Symbol("is html");function z(t,e,a,r){var s=ca(t);$&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=a)&&(e==="loading"&&(t[qe]=a),a==null?t.removeAttribute(e):typeof a!="string"&&va(t).includes(e)?t[e]=a:t.setAttribute(e,a))}function ca(t){return t.__attributes??(t.__attributes={[ia]:t.nodeName.includes("-"),[la]:t.namespaceURI===Ke})}var ge=new Map;function va(t){var e=ge.get(t.nodeName);if(e)return e;ge.set(t.nodeName,e=[]);for(var a,r=t,s=Element.prototype;s!==r;){a=Qe(r);for(var n in a)a[n].set&&e.push(n);r=We(r)}return e}function Ie(t,e,a){if(t.multiple)return ua(t,e);for(var r of t.options){var s=U(r);if(Ze(s,e)){r.selected=!0;return}}(!a||e!==void 0)&&(t.selectedIndex=-1)}function da(t,e){Ne(()=>{var a=new MutationObserver(()=>{var r=t.__value;Ie(t,r)});return a.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function fa(t,e,a=e){var r=!0;aa(t,"change",s=>{var n=s?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(n),U);else{var i=t.querySelector(n)??t.querySelector("option:not([disabled])");o=i&&U(i)}a(o)}),Ne(()=>{var s=e();if(Ie(t,s,r),r&&s===void 0){var n=t.querySelector(":checked");n!==null&&(s=U(n),a(s))}t.__value=s,r=!1}),da(t)}function ua(t,e){for(var a of t.options)a.selected=~e.indexOf(U(a))}function U(t){return"__value"in t?t.__value:t.value}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ee={faviconSize:128,faviconFetchServiceURL:t=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${t}&size=${Ee.faviconSize}`};async function ha(){const e="/bk"+"/bookmarks";try{const a=await fetch(e+"/index.json");if(a){const r=await a.json();if(Array.isArray(r)?r.length>0:!1){const o=r.sort().map(i=>fetch(e+"/"+i+".json").then(d=>d.json()).then(d=>(d.bookmarkIndexName=i,d)));return await Promise.all(o)}}}catch(a){console.error("bookmarks folder or bookmarks/index.json not found. Error:",a)}}async function ma(t){const e={};if(Array.isArray(t)?t.length>0:!1)for(let r=0;r<t.length;r++){const s=t[r],n=s.LINK,o=s.ICON;let i="";if(o)i=o;else if(n){const d=new URL(n),m=d.protocol+"//"+d.hostname;i=Ee.faviconFetchServiceURL(m)}else i=Le;s.bookmarkIndexName&&(e[s.bookmarkIndexName]=i)}return e}var ga=L('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),pa=L('<div class="bk-title svelte-1jzx7ns"> </div>'),_a=L('<div class="bk-desc svelte-1jzx7ns"> </div>'),ba=L('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function pe(t,e){G(e,!1);let a=fe(e,"bookmark",8),r=fe(e,"faviconLink",8);const s=a().LINK||"javascript:void(0)";let n=a().NAME||a().LINK;function o(c){const f=c==null?void 0:c.target;f&&(f.src=Le)}J();var i=ba();z(i,"href",s),z(i,"title",n);var d=k(i),m=k(d),l=k(m);p(m);var g=I(m,2);{var h=c=>{var f=ga(),A=k(f),N=k(A,!0);p(A);var E=I(A,2),M=k(E,!0);p(E),p(f),V(()=>{O(N,a().NAME),O(M,a().LINK)}),x(c,f)};w(g,c=>{a().IS_PINNED||c(h)})}p(d);var v=I(d,2);{var u=c=>{var f=pa(),A=k(f,!0);p(f),V(()=>O(A,a().TITLE)),x(c,f)};w(v,c=>{a().TITLE&&c(u)})}var _=I(v,2);{var b=c=>{var f=_a(),A=k(f,!0);p(f),V(()=>O(A,a().DESC)),x(c,f)};w(_,c=>{a().DESC&&c(b)})}p(i),V(()=>{z(i,"data-bookmark-icon",a().ICON),z(l,"src",r())}),ne("error",l,o),x(t,i),K()}var ka=L('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),Aa=L('<div class="bk-container-grid svelte-1uu4y0a"></div>'),Na=L('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function xa(t,e){G(e,!1);let a=[],r=D([]),s=D([]),n=D({});async function o(){const v=await ha();v&&(a=v.sort((_,b)=>_.NAME.localeCompare(b.NAME)),Y(r,a.filter(_=>_.IS_PINNED)),Y(s,a.filter(_=>!_.IS_PINNED)))}xe(async()=>{await o();const v=await ma(a);v&&Y(n,v)}),J();var i=Na(),d=k(i),m=k(d);{var l=v=>{var u=ka();ie(u,5,()=>y(r),oe,(_,b)=>{var c=re(),f=F(c);{var A=N=>{pe(N,{get bookmark(){return y(b)},get faviconLink(){return y(n)[y(b).bookmarkIndexName]}})};w(f,N=>{y(b).bookmarkIndexName&&N(A)})}x(_,c)}),p(u),x(v,u)};w(m,v=>{y(r).length>0&&v(l)})}var g=I(m,2);{var h=v=>{var u=Aa();ie(u,5,()=>y(s),oe,(_,b)=>{var c=re(),f=F(c);{var A=N=>{pe(N,{get bookmark(){return y(b)},get faviconLink(){return y(n)[y(b).bookmarkIndexName]}})};w(f,N=>{y(b).bookmarkIndexName&&N(A)})}x(_,c)}),p(u),x(v,u)};w(g,v=>{y(s).length>0&&v(h)})}p(d),p(i),x(t,i),K()}const le=H("home"),ae=H(null),te=H(null);var ya=L('<hr class="separator svelte-obx2py">'),Ia=L('<div class="header svelte-obx2py"><a class="brand svelte-obx2py"></a> <select class="view-list svelte-obx2py" id="view-list"><option>Home</option><option>Settings</option></select></div> <!>',1);function La(t){const[e,a]=q(),r=()=>T(le,"$selectedPage",e),s="https://m9j.github.io/bk";var n=Ia(),o=F(n),i=k(o);z(i,"href",s),i.textContent="BOOKMARKS";var d=I(i,2);V(()=>{r(),Xe(()=>{})});var m=k(d);m.value=m.__value="home";var l=I(m);l.value=l.__value="settings",p(d),p(o);var g=I(o,2);{var h=v=>{var u=ya();x(v,u)};w(g,v=>{r()!=="home"&&v(h)})}fa(d,r,v=>ea(le,v)),x(t,n),a()}async function Ea(t){if(t){let e=setTimeout(()=>{clearTimeout(e),t()},0)}}async function wa(){const e="/bk"+"/lambdas";try{const a=await fetch(e+"/index.json");if(a){const r=await a.json();if(Array.isArray(r)?r.length>0:!1){const n=r.map(o=>import(e+"/"+o+".lambda.js"));return await Promise.all(n)}}}catch(a){console.error("lambdas folder or lambdas/index.json not found. Error:",a)}}async function Sa(t){if(Array.isArray(t)?t.length>0:!1)for(const[a,r]of Object.entries(t))$a(r,Number(a))}const we=H([]);async function $a(t,e){Ea(async()=>{if(t.action&&typeof t.action=="function"){const a=s=>{we.update(n=>(n[e]=s,n))},r=await t.action(a);r&&a(r)}})}var Ba=L('<div class="lambda svelte-vmgkgn"><div class="lambda-title"> <span class="lambda-result"> </span></div></div>'),Ca=L('<div class="lambdas-container svelte-vmgkgn"></div>');function Ra(t,e){G(e,!1);const[a,r]=q(),s=()=>T(o,"$results",a);let n=D([]);const o=we;xe(async()=>{const l=await wa();l&&(Array.isArray(l)&&l.length>0)&&(Y(n,l),Sa(y(n)))}),J();var i=re(),d=F(i);{var m=l=>{var g=Ca();ie(g,5,()=>y(n),oe,(h,v,u)=>{var _=Ba(),b=k(_),c=k(b),f=I(c),A=k(f,!0);p(f),p(b),p(_),V(()=>{O(c,`${y(v).prompt??""}: `),O(A,s()[u]??"...")}),x(h,_)}),p(g),x(l,g)};w(d,l=>{y(n).length>0&&l(m)})}x(t,i),K(),r()}function Va(){navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(a=>caches.delete(a)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(t){if(t){const e=new Date(Number(t)),a=String(e.getFullYear()),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return`${a}.${r}${s}.${n}${o}${i}`}}async function Oa(){const e="/bk"+"/version.json";try{const a=await fetch(e);if(!a.ok)console.log(new Error("Failed to fetch current version"));else return(await a.json()).version}catch(a){console.error("Current version check failed: ",a)}}async function Ma(){const t="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(t,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const a=await e.json();return JSON.parse(atob(a.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var Pa=L('<span class="monospace svelte-2le08x"> </span> <br>',1),Ta=L("<span> </span><br>",1),Fa=L("<div>Versions:<br> <!> <!></div>"),ja=L('<div class="settings-container hide svelte-2le08x" id="settings-container"><div class="columns svelte-2le08x"><!></div> <div class="rows svelte-2le08x"><button class="settings-button svelte-2le08x">Check for latest version</button> <button class="settings-button svelte-2le08x">Hard reload application</button></div> <br> <div class="columns svelte-2le08x"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function za(t,e){G(e,!1);const[a,r]=q(),s=()=>T(ae,"$currentVersion",a),n=()=>T(te,"$latestVersion",a),o=()=>T(i,"$isNew",a),i=H(!1);(async()=>(await d(),await m()))();async function d(){const c=await Oa();ae.update(f=>c)}async function m(){const c=await Ma();te.update(f=>c),i.update(f=>Number(ue(te))>Number(ue(ae)))}J();var l=ja(),g=k(l),h=k(g);{var v=c=>{var f=Fa(),A=I(k(f),3);{var N=S=>{var B=Pa(),C=F(B),P=k(C);p(C),ee(2),V(W=>O(P,`${W??""} [CURRENT]`),[()=>_e(s())],se),x(S,B)};w(A,S=>{s()&&S(N)})}var E=I(A,2);{var M=S=>{var B=Ta(),C=F(B);let P;var W=k(C);p(C),ee(),V((Se,$e)=>{P=oa(C,1,"monospace svelte-2le08x",null,P,Se),O(W,`${$e??""} [LATEST]`)},[()=>({"is-new":o()}),()=>_e(n())],se),x(S,B)};w(E,S=>{n()&&S(M)})}p(f),x(c,f)};w(h,c=>{(s()||n())&&c(v)})}p(g);var u=I(g,2),_=k(u),b=I(_,2);p(u),ee(4),p(l),ne("click",_,()=>m()),ne("click",b,()=>Va()),x(t,l),K(),r()}var Da=L('<div class="app-wrapper svelte-lehtuv"><!> <!> <div class="app-bottom-wrapper svelte-lehtuv"><!> <!></div></div>');function qa(t){const[e,a]=q(),r=()=>T(le,"$selectedPage",e);var s=Da(),n=k(s);xa(n,{});var o=I(n,2);Ra(o,{});var i=I(o,2),d=k(i);La(d);var m=I(d,2);{var l=g=>{za(g,{})};w(m,g=>{r()==="settings"&&g(l)})}p(i),p(s),x(t,s),a()}export{qa as component};
