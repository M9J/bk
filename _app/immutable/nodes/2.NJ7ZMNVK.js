import{t as S,a as L,c as Le}from"../chunks/ShRlSRrh.js";import{i as X}from"../chunks/C4lPoHSt.js";import{$ as we,i as Se,A as Y,l as w,a0 as ye,x as xe,g as V,N as q,y as Ce,z as ae,B as J,m as F,ad as Ve,C as he,j as ke,D as Be,ap as j,ah as ge,a2 as ne,aq as Re,F as W,ar as se,as as $e,at as Oe,ag as Te,au as Me,k as Fe,av as Pe,aw as Ue,ab as ze,a8 as De,ax as He,ay as Ye,az as Je,aA as je,aj as _e,aB as Ge,p as ee,s as b,v as m,w as N,t as M,q as re,J as oe,o as D,aC as Ke,aD as ie}from"../chunks/D-K9HiIO.js";import{p as le,i as $,s as P,a as te,b as qe}from"../chunks/DbvTTcjW.js";import{o as We,w as H,g as ce}from"../chunks/75HYu9UQ.js";import{l as Qe,s as T,e as Q}from"../chunks/C1qIrR1b.js";function Ze(t,e){return e}function Xe(t,e,r,a){for(var n=[],o=e.length,s=0;s<o;s++)Oe(e[s].e,n,!0);var i=o>0&&n.length===0&&r!==null;if(i){var c=r.parentNode;Te(c),c.append(r),a.clear(),B(t,e[0].prev,e[o-1].next)}Me(n,()=>{for(var f=0;f<o;f++){var l=e[f];i||(a.delete(l.k),B(t,l.prev,l.next)),Fe(l.e,!i)}})}function er(t,e,r,a,n,o=null){var s=t,i={flags:e,items:new Map,first:null};{var c=t;s=w?Y(ye(c)):c.appendChild(we())}w&&xe();var f=null,l=!1,h=q(()=>{var v=r();return De(v)?v:v==null?[]:ge(v)});Se(()=>{var v=V(h),k=v.length;if(l&&k===0)return;l=k===0;let d=!1;if(w){var E=s.data===Ce;E!==(k===0)&&(s=ae(),Y(s),J(!1),d=!0)}if(w){for(var A=null,u,g=0;g<k;g++){if(F.nodeType===8&&F.data===Ve){s=F,d=!0,J(!1);break}var y=v[g],_=a(y,g);u=pe(F,i,A,null,y,_,g,n,e,r),i.items.set(_,u),A=u}k>0&&Y(ae())}w||rr(v,i,s,n,e,a,r),o!==null&&(k===0?f?he(f):f=ke(()=>o(s)):f!==null&&Be(f,()=>{f=null})),d&&J(!0),V(h)}),w&&(s=F)}function rr(t,e,r,a,n,o,s){var i=t.length,c=e.items,f=e.first,l=f,h,v=null,k=[],d=[],E,A,u,g;for(g=0;g<i;g+=1){if(E=t[g],A=o(E,g),u=c.get(A),u===void 0){var y=l?l.e.nodes_start:r;v=pe(y,e,v,v===null?e.first:v.next,E,A,g,a,n,s),c.set(A,v),k=[],d=[],l=v.next;continue}if(tr(u,E,g),(u.e.f&j)!==0&&he(u.e),u!==l){if(h!==void 0&&h.has(u)){if(k.length<d.length){var _=d[0],p;v=_.prev;var C=k[0],I=k[k.length-1];for(p=0;p<k.length;p+=1)ve(k[p],_,r);for(p=0;p<d.length;p+=1)h.delete(d[p]);B(e,C.prev,I.next),B(e,v,C),B(e,I,_),l=_,v=I,g-=1,k=[],d=[]}else h.delete(u),ve(u,l,r),B(e,u.prev,u.next),B(e,u,v===null?e.first:v.next),B(e,v,u),v=u;continue}for(k=[],d=[];l!==null&&l.k!==A;)(l.e.f&j)===0&&(h??(h=new Set)).add(l),d.push(l),l=l.next;if(l===null)continue;u=l}k.push(u),v=u,l=u.next}if(l!==null||h!==void 0){for(var x=h===void 0?[]:ge(h);l!==null;)(l.e.f&j)===0&&x.push(l),l=l.next;var R=x.length;if(R>0){var O=i===0?r:null;Xe(e,x,O,c)}}ne.first=e.first&&e.first.e,ne.last=v&&v.e}function tr(t,e,r,a){Re(t.v,e),t.i=r}function pe(t,e,r,a,n,o,s,i,c,f){var l=(c&Pe)!==0,h=(c&Ue)===0,v=l?h?W(n):se(n):n,k=(c&$e)===0?s:se(s),d={i:k,v,k:o,a:null,e:null,prev:r,next:a};try{return d.e=ke(()=>i(t,v,k,f),w),d.e.prev=r&&r.e,d.e.next=a&&a.e,r===null?e.first=d:(r.next=d,r.e.next=d.e),a!==null&&(a.prev=d,a.e.prev=d.e),d}finally{}}function ve(t,e,r){for(var a=t.next?t.next.e.nodes_start:r,n=e?e.e.nodes_start:r,o=t.e.nodes_start;o!==a;){var s=ze(o);n.before(o),o=s}}function B(t,e,r){e===null?t.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}const fe=[...` 	
\r\fÂ \v\uFEFF`];function ar(t,e,r){var a=""+t;if(r){for(var n in r)if(r[n])a=a?a+" "+n:n;else if(a.length)for(var o=n.length,s=0;(s=a.indexOf(n,s))>=0;){var i=s+o;(s===0||fe.includes(a[s-1]))&&(i===a.length||fe.includes(a[i]))?a=(s===0?"":a.substring(0,s))+a.substring(i+1):s=i}}return a===""?null:a}function nr(t,e,r,a,n,o){var s=t.__className;if(w||s!==r||s===void 0){var i=ar(r,a,o);(!w||i!==t.getAttribute("class"))&&(i==null?t.removeAttribute("class"):t.className=i),t.__className=r}else if(o&&n!==o)for(var c in o){var f=!!o[c];(n==null||f!==!!n[c])&&t.classList.toggle(c,f)}return o}const sr=Symbol("is custom element"),or=Symbol("is html");function z(t,e,r,a){var n=ir(t);w&&(n[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||n[e]!==(n[e]=r)&&(e==="loading"&&(t[He]=r),r==null?t.removeAttribute(e):typeof r!="string"&&lr(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function ir(t){return t.__attributes??(t.__attributes={[sr]:t.nodeName.includes("-"),[or]:t.namespaceURI===Ye})}var ue=new Map;function lr(t){var e=ue.get(t.nodeName);if(e)return e;ue.set(t.nodeName,e=[]);for(var r,a=t,n=Element.prototype;n!==a;){r=je(a);for(var o in r)r[o].set&&e.push(o);a=Je(a)}return e}function me(t,e,r){if(t.multiple)return fr(t,e);for(var a of t.options){var n=U(a);if(Ge(n,e)){a.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function cr(t,e){_e(()=>{var r=new MutationObserver(()=>{var a=t.__value;me(t,a)});return r.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function vr(t,e,r=e){var a=!0;Qe(t,"change",n=>{var o=n?"[selected]":":checked",s;if(t.multiple)s=[].map.call(t.querySelectorAll(o),U);else{var i=t.querySelector(o)??t.querySelector("option:not([disabled])");s=i&&U(i)}r(s)}),_e(()=>{var n=e();if(me(t,n,a),a&&n===void 0){var o=t.querySelector(":checked");o!==null&&(n=U(o),r(n))}t.__value=n,a=!1}),cr(t)}function fr(t,e){for(var r of t.options)r.selected=~e.indexOf(U(r))}function U(t){return"__value"in t?t.__value:t.value}const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ae={faviconSize:24,faviconFetchServiceURL:t=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${t}&size=${Ae.faviconSize}`};async function ur(){const e="/bk"+"/bookmarks";try{const r=await fetch(e+"/index.json");if(r){const a=await r.json();if(Array.isArray(a)?a.length>0:!1){const s=a.sort().map(i=>fetch(e+"/"+i+".json").then(c=>c.json()).then(c=>(c.bookmarkIndexName=i,c)));return await Promise.all(s)}}}catch(r){console.error("bookmarks folder or bookmarks/index.json not found. Error:",r)}}async function dr(t){const e={};if(Array.isArray(t)?t.length>0:!1)for(let a=0;a<t.length;a++){const n=t[a],o=n.LINK,s=n.ICON;let i="";if(s)i=s;else if(o){const c=new URL(o),f=c.protocol+"//"+c.hostname;i=Ae.faviconFetchServiceURL(f)}else i=be;n.bookmarkIndexName&&(e[n.bookmarkIndexName]=i)}return e}var hr=S('<div class="bk-title svelte-1lplrkt"> </div>'),kr=S('<div class="bk-desc svelte-1lplrkt"> </div>'),gr=S('<a class="bk svelte-1lplrkt" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1lplrkt"><div class="bk-icon svelte-1lplrkt"><img alt="icon" width="100%" height="100%" loading="lazy"></div> <div class="bk-meta-info svelte-1lplrkt"><div class="bk-name svelte-1lplrkt"> </div> <div class="bk-link svelte-1lplrkt"> </div></div></div> <!> <!></a>');function _r(t,e){ee(e,!1);let r=le(e,"bookmark",8),a=le(e,"faviconLink",8);const n=r().LINK||"javascript:void(0)";let o=r().NAME||r().LINK;function s(_){const p=_==null?void 0:_.target;p&&(p.src=be)}X();var i=gr();z(i,"href",n),z(i,"title",o);var c=b(i),f=b(c),l=b(f);m(f);var h=N(f,2),v=b(h),k=b(v,!0);m(v);var d=N(v,2),E=b(d,!0);m(d),m(h),m(c);var A=N(c,2);{var u=_=>{var p=hr(),C=b(p,!0);m(p),M(()=>T(C,r().TITLE)),L(_,p)};$(A,_=>{r().TITLE&&_(u)})}var g=N(A,2);{var y=_=>{var p=kr(),C=b(p,!0);m(p),M(()=>T(C,r().DESC)),L(_,p)};$(g,_=>{r().DESC&&_(y)})}m(i),M(()=>{z(i,"data-bookmark-icon",r().ICON),z(l,"src",a()),T(k,r().NAME),T(E,r().LINK)}),Q("error",l,s),L(t,i),re()}var pr=S('<div class="bookmark-container svelte-1k3hbth" id="bookmark-container"></div>');function mr(t,e){ee(e,!1);let r=W([]),a=W({});async function n(){const s=await ur();s&&oe(r,s)}We(async()=>{await n();const s=await dr(V(r));s&&oe(a,s)}),X();var o=pr();er(o,5,()=>V(r),Ze,(s,i)=>{var c=Le(),f=D(c);{var l=h=>{_r(h,{get bookmark(){return V(i)},get faviconLink(){return V(a)[V(i).bookmarkIndexName]}})};$(f,h=>{V(i).bookmarkIndexName&&h(l)})}L(s,c)}),m(o),L(t,o),re()}const Z=H("home"),G=H(null),K=H(null);var br=S('<div class="header svelte-1btxz3n"><a class="brand svelte-1btxz3n" href="https://m9j.github.io/bookmarks"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function Ar(t){const[e,r]=te(),a=()=>P(Z,"$selectedPage",e);var n=br(),o=b(n);o.textContent="BOOKMARKS";var s=N(o,2);M(()=>{a(),Ke(()=>{})});var i=b(s);i.value=i.__value="home";var c=N(i);c.value=c.__value="settings",m(s),m(n),vr(s,a,f=>qe(Z,f)),L(t,n),r()}function Nr(){navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(r=>caches.delete(r)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function de(t){if(t){const e=new Date(Number(t)),r=String(e.getFullYear()),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),o=e.getHours()*3600+e.getMinutes()*60+e.getSeconds(),s=String(o).padStart(5,"0");return`${r}.${a}${n}.${s}`}}async function Er(){const e="/bk"+"/version.json";try{const r=await fetch(e);if(!r.ok)console.log(new Error("Failed to fetch current version"));else return(await r.json()).version}catch(r){console.error("Current version check failed: ",r)}}async function Ir(){const t="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(t,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const r=await e.json();return JSON.parse(atob(r.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var Lr=S(" <br>",1),wr=S("<span> </span><br>",1),Sr=S("<div>Versions:<br> <!> <!></div>"),yr=S('<div class="settings-container hide svelte-18fnlk3" id="settings-container"><div class="columns svelte-18fnlk3"><!></div> <div class="rows svelte-18fnlk3"><button class="settings-button svelte-18fnlk3">Check for latest version</button> <button class="settings-button svelte-18fnlk3">Hard reload application</button></div></div>');function xr(t,e){ee(e,!1);const[r,a]=te(),n=()=>P(G,"$currentVersion",r),o=()=>P(K,"$latestVersion",r),s=()=>P(i,"$isNew",r);c();const i=H(!1);async function c(){const u=await Er();G.update(g=>u)}async function f(){const u=await Ir();K.update(g=>u),i.update(g=>Number(ce(K))>Number(ce(G)))}X();var l=yr(),h=b(l),v=b(h);{var k=u=>{var g=Sr(),y=N(b(g),3);{var _=I=>{var x=Lr(),R=D(x);ie(),M(O=>T(R,`${O??""} [CURRENT] `),[()=>de(n())],q),L(I,x)};$(y,I=>{n()&&I(_)})}var p=N(y,2);{var C=I=>{var x=wr(),R=D(x);let O;var Ne=b(R);m(R),ie(),M((Ee,Ie)=>{O=nr(R,1,"svelte-18fnlk3",null,O,Ee),T(Ne,`${Ie??""} [LATEST]`)},[()=>({"is-new":s()}),()=>de(o())],q),L(I,x)};$(p,I=>{o()&&I(C)})}m(g),L(u,g)};$(v,u=>{(n()||o())&&u(k)})}m(h);var d=N(h,2),E=b(d),A=N(E,2);m(d),m(l),Q("click",E,()=>f()),Q("click",A,()=>Nr()),L(t,l),re(),a()}var Cr=S("<!> <!> <!>",1);function Mr(t){const[e,r]=te(),a=()=>P(Z,"$selectedPage",e);var n=Cr(),o=D(n);mr(o,{});var s=N(o,2);Ar(s);var i=N(s,2);{var c=f=>{xr(f,{})};$(i,f=>{a()==="settings"&&f(c)})}L(t,n),r()}export{Mr as component};
