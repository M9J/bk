import{t as L,a as I,c as se}from"../chunks/CyOrqUXm.js";import{i as re}from"../chunks/CL0QEqD9.js";import{A as J,l as B,a0 as ye,$ as Be,x as Ce,i as $e,g as E,N as Z,y as Ve,z as oe,B as G,m as T,ad as Re,C as me,j as be,D as ze,ah as Ae,a8 as Oe,F as D,ap as ie,aq as K,a2 as le,ar as Me,as as Te,at as Pe,ag as Fe,au as Ue,k as De,av as je,aw as He,ab as Ye,ax as Je,ay as Ge,az as Ke,aA as qe,aj as Ne,aB as We,p as ae,s as b,v as h,w,t as R,q as te,J as q,o as j,aC as Qe,aD as ve}from"../chunks/DZpqQ712.js";import{p as ce,i as y,s as F,a as ne,b as Ze}from"../chunks/B8VvTqyC.js";import{o as Xe,w as H,g as fe}from"../chunks/HU1d89I3.js";import{l as er,e as X,s as M}from"../chunks/DUnFqAGD.js";function ue(a,e){return e}function rr(a,e,r,t){for(var n=[],s=e.length,o=0;o<s;o++)Pe(e[o].e,n,!0);var i=s>0&&n.length===0&&r!==null;if(i){var c=r.parentNode;Fe(c),c.append(r),t.clear(),V(a,e[0].prev,e[s-1].next)}Ue(n,()=>{for(var k=0;k<s;k++){var v=e[k];i||(t.delete(v.k),V(a,v.prev,v.next)),De(v.e,!i)}})}function de(a,e,r,t,n,s=null){var o=a,i={flags:e,items:new Map,first:null};{var c=a;o=B?J(ye(c)):c.appendChild(Be())}B&&Ce();var k=null,v=!1,p=Z(()=>{var _=r();return Oe(_)?_:_==null?[]:Ae(_)});$e(()=>{var _=E(p),u=_.length;if(v&&u===0)return;v=u===0;let d=!1;if(B){var m=o.data===Ve;m!==(u===0)&&(o=oe(),J(o),G(!1),d=!0)}if(B){for(var g=null,l,f=0;f<u;f++){if(T.nodeType===8&&T.data===Re){o=T,d=!0,G(!1);break}var A=_[f],N=t(A,f);l=Ie(T,i,g,null,A,N,f,n,e,r),i.items.set(N,l),g=l}u>0&&J(oe())}B||ar(_,i,o,n,e,t,r),s!==null&&(u===0?k?me(k):k=be(()=>s(o)):k!==null&&ze(k,()=>{k=null})),d&&G(!0),E(p)}),B&&(o=T)}function ar(a,e,r,t,n,s,o){var i=a.length,c=e.items,k=e.first,v=k,p,_=null,u=[],d=[],m,g,l,f;for(f=0;f<i;f+=1){if(m=a[f],g=s(m,f),l=c.get(g),l===void 0){var A=v?v.e.nodes_start:r;_=Ie(A,e,_,_===null?e.first:_.next,m,g,f,t,n,o),c.set(g,_),u=[],d=[],v=_.next;continue}if(tr(l,m,f),(l.e.f&K)!==0&&me(l.e),l!==v){if(p!==void 0&&p.has(l)){if(u.length<d.length){var N=d[0],x;_=N.prev;var z=u[0],S=u[u.length-1];for(x=0;x<u.length;x+=1)ke(u[x],N,r);for(x=0;x<d.length;x+=1)p.delete(d[x]);V(e,z.prev,S.next),V(e,_,z),V(e,S,N),v=N,_=S,f-=1,u=[],d=[]}else p.delete(l),ke(l,v,r),V(e,l.prev,l.next),V(e,l,_===null?e.first:_.next),V(e,_,l),_=l;continue}for(u=[],d=[];v!==null&&v.k!==g;)(v.e.f&K)===0&&(p??(p=new Set)).add(v),d.push(v),v=v.next;if(v===null)continue;l=v}u.push(l),_=l,v=l.next}if(v!==null||p!==void 0){for(var C=p===void 0?[]:Ae(p);v!==null;)(v.e.f&K)===0&&C.push(v),v=v.next;var $=C.length;if($>0){var O=i===0?r:null;rr(e,C,O,c)}}le.first=e.first&&e.first.e,le.last=_&&_.e}function tr(a,e,r,t){Te(a.v,e),a.i=r}function Ie(a,e,r,t,n,s,o,i,c,k){var v=(c&je)!==0,p=(c&He)===0,_=v?p?D(n):ie(n):n,u=(c&Me)===0?o:ie(o),d={i:u,v:_,k:s,a:null,e:null,prev:r,next:t};try{return d.e=be(()=>i(a,_,u,k),B),d.e.prev=r&&r.e,d.e.next=t&&t.e,r===null?e.first=d:(r.next=d,r.e.next=d.e),t!==null&&(t.prev=d,t.e.prev=d.e),d}finally{}}function ke(a,e,r){for(var t=a.next?a.next.e.nodes_start:r,n=e?e.e.nodes_start:r,s=a.e.nodes_start;s!==t;){var o=Ye(s);n.before(s),s=o}}function V(a,e,r){e===null?a.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}const _e=[...` 	
\r\fÂ \v\uFEFF`];function nr(a,e,r){var t=""+a;if(r){for(var n in r)if(r[n])t=t?t+" "+n:n;else if(t.length)for(var s=n.length,o=0;(o=t.indexOf(n,o))>=0;){var i=o+s;(o===0||_e.includes(t[o-1]))&&(i===t.length||_e.includes(t[i]))?t=(o===0?"":t.substring(0,o))+t.substring(i+1):o=i}}return t===""?null:t}function sr(a,e,r,t,n,s){var o=a.__className;if(B||o!==r||o===void 0){var i=nr(r,t,s);(!B||i!==a.getAttribute("class"))&&(i==null?a.removeAttribute("class"):a.className=i),a.__className=r}else if(s&&n!==s)for(var c in s){var k=!!s[c];(n==null||k!==!!n[c])&&a.classList.toggle(c,k)}return s}const or=Symbol("is custom element"),ir=Symbol("is html");function P(a,e,r,t){var n=lr(a);B&&(n[e]=a.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&a.nodeName==="LINK")||n[e]!==(n[e]=r)&&(e==="loading"&&(a[Ge]=r),r==null?a.removeAttribute(e):typeof r!="string"&&vr(a).includes(e)?a[e]=r:a.setAttribute(e,r))}function lr(a){return a.__attributes??(a.__attributes={[or]:a.nodeName.includes("-"),[ir]:a.namespaceURI===Je})}var ge=new Map;function vr(a){var e=ge.get(a.nodeName);if(e)return e;ge.set(a.nodeName,e=[]);for(var r,t=a,n=Element.prototype;n!==t;){r=qe(t);for(var s in r)r[s].set&&e.push(s);t=Ke(t)}return e}function Ee(a,e,r){if(a.multiple)return ur(a,e);for(var t of a.options){var n=U(t);if(We(n,e)){t.selected=!0;return}}(!r||e!==void 0)&&(a.selectedIndex=-1)}function cr(a,e){Ne(()=>{var r=new MutationObserver(()=>{var t=a.__value;Ee(a,t)});return r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function fr(a,e,r=e){var t=!0;er(a,"change",n=>{var s=n?"[selected]":":checked",o;if(a.multiple)o=[].map.call(a.querySelectorAll(s),U);else{var i=a.querySelector(s)??a.querySelector("option:not([disabled])");o=i&&U(i)}r(o)}),Ne(()=>{var n=e();if(Ee(a,n,t),t&&n===void 0){var s=a.querySelector(":checked");s!==null&&(n=U(s),r(n))}a.__value=n,t=!1}),cr(a)}function ur(a,e){for(var r of a.options)r.selected=~e.indexOf(U(r))}function U(a){return"__value"in a?a.__value:a.value}const xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",we={faviconSize:128,faviconFetchServiceURL:a=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${a}&size=${we.faviconSize}`};async function dr(){const e="/bk"+"/bookmarks";try{const r=await fetch(e+"/index.json");if(r){const t=await r.json();if(Array.isArray(t)?t.length>0:!1){const o=t.sort().map(i=>fetch(e+"/"+i+".json").then(c=>c.json()).then(c=>(c.bookmarkIndexName=i,c)));return await Promise.all(o)}}}catch(r){console.error("bookmarks folder or bookmarks/index.json not found. Error:",r)}}async function kr(a){const e={};if(Array.isArray(a)?a.length>0:!1)for(let t=0;t<a.length;t++){const n=a[t],s=n.LINK,o=n.ICON;let i="";if(o)i=o;else if(s){const c=new URL(s),k=c.protocol+"//"+c.hostname;i=we.faviconFetchServiceURL(k)}else i=xe;n.bookmarkIndexName&&(e[n.bookmarkIndexName]=i)}return e}var _r=L('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),gr=L('<div class="bk-title svelte-1jzx7ns"> </div>'),hr=L('<div class="bk-desc svelte-1jzx7ns"> </div>'),pr=L('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function he(a,e){ae(e,!1);let r=ce(e,"bookmark",8),t=ce(e,"faviconLink",8);const n=r().LINK||"javascript:void(0)";let s=r().NAME||r().LINK;function o(l){const f=l==null?void 0:l.target;f&&(f.src=xe)}re();var i=pr();P(i,"href",n),P(i,"title",s);var c=b(i),k=b(c),v=b(k);h(k);var p=w(k,2);{var _=l=>{var f=_r(),A=b(f),N=b(A,!0);h(A);var x=w(A,2),z=b(x,!0);h(x),h(f),R(()=>{M(N,r().NAME),M(z,r().LINK)}),I(l,f)};y(p,l=>{r().IS_PINNED||l(_)})}h(c);var u=w(c,2);{var d=l=>{var f=gr(),A=b(f,!0);h(f),R(()=>M(A,r().TITLE)),I(l,f)};y(u,l=>{r().TITLE&&l(d)})}var m=w(u,2);{var g=l=>{var f=hr(),A=b(f,!0);h(f),R(()=>M(A,r().DESC)),I(l,f)};y(m,l=>{r().DESC&&l(g)})}h(i),R(()=>{P(i,"data-bookmark-icon",r().ICON),P(v,"src",t())}),X("error",v,o),I(a,i),te()}var mr=L('<div class="bk-container-pinned svelte-k5eelo"></div>'),br=L('<div class="bk-container-grid svelte-k5eelo"></div>'),Ar=L('<div class="bk-wrapper svelte-k5eelo"><div class="bk-container svelte-k5eelo"><!> <!></div></div>');function Nr(a,e){ae(e,!1);let r=[],t=D([]),n=D([]),s=D({});async function o(){const u=await dr();u&&(r=u.sort((m,g)=>m.NAME.localeCompare(g.NAME)),q(t,r.filter(m=>m.IS_PINNED)),q(n,r.filter(m=>!m.IS_PINNED)))}Xe(async()=>{await o();const u=await kr(r);u&&q(s,u)}),re();var i=Ar(),c=b(i),k=b(c);{var v=u=>{var d=mr();de(d,5,()=>E(t),ue,(m,g)=>{var l=se(),f=j(l);{var A=N=>{he(N,{get bookmark(){return E(g)},get faviconLink(){return E(s)[E(g).bookmarkIndexName]}})};y(f,N=>{E(g).bookmarkIndexName&&N(A)})}I(m,l)}),h(d),I(u,d)};y(k,u=>{E(t).length>0&&u(v)})}var p=w(k,2);{var _=u=>{var d=br();de(d,5,()=>E(n),ue,(m,g)=>{var l=se(),f=j(l);{var A=N=>{he(N,{get bookmark(){return E(g)},get faviconLink(){return E(s)[E(g).bookmarkIndexName]}})};y(f,N=>{E(g).bookmarkIndexName&&N(A)})}I(m,l)}),h(d),I(u,d)};y(p,u=>{E(n).length>0&&u(_)})}h(c),h(i),I(a,i),te()}const ee=H("home"),W=H(null),Q=H(null);var Ir=L('<div class="header svelte-148zt7e"><a class="brand svelte-148zt7e"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function Er(a){const[e,r]=ne(),t=()=>F(ee,"$selectedPage",e),n="https://m9j.github.io/bk";var s=Ir(),o=b(s);P(o,"href",n),o.textContent="BOOKMARKS";var i=w(o,2);R(()=>{t(),Qe(()=>{})});var c=b(i);c.value=c.__value="home";var k=w(c);k.value=k.__value="settings",h(i),h(s),fr(i,t,v=>Ze(ee,v)),I(a,s),r()}function xr(){navigator.serviceWorker.getRegistrations().then(a=>{a.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(r=>caches.delete(r)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function pe(a){if(a){const e=new Date(Number(a)),r=String(e.getFullYear()),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()),o=String(e.getMinutes()),i=String(e.getSeconds());return`${r}.${t}${n}.${s}${o}${i}`}}async function wr(){const e="/bk"+"/version.json";try{const r=await fetch(e);if(!r.ok)console.log(new Error("Failed to fetch current version"));else return(await r.json()).version}catch(r){console.error("Current version check failed: ",r)}}async function Lr(){const a="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(a,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const r=await e.json();return JSON.parse(atob(r.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var Sr=L('<span class="monospace svelte-1kpux3b"> </span> <br>',1),yr=L("<span> </span><br>",1),Br=L("<div>Versions:<br> <!> <!></div>"),Cr=L('<div class="settings-container hide svelte-1kpux3b" id="settings-container"><div class="columns svelte-1kpux3b"><!></div> <div class="rows svelte-1kpux3b"><button class="settings-button svelte-1kpux3b">Check for latest version</button> <button class="settings-button svelte-1kpux3b">Hard reload application</button></div></div>');function $r(a,e){ae(e,!1);const[r,t]=ne(),n=()=>F(W,"$currentVersion",r),s=()=>F(Q,"$latestVersion",r),o=()=>F(i,"$isNew",r),i=H(!1);(async()=>(await c(),await k()))();async function c(){const l=await wr();W.update(f=>l)}async function k(){const l=await Lr();Q.update(f=>l),i.update(f=>Number(fe(Q))>Number(fe(W)))}re();var v=Cr(),p=b(v),_=b(p);{var u=l=>{var f=Br(),A=w(b(f),3);{var N=S=>{var C=Sr(),$=j(C),O=b($);h($),ve(2),R(Y=>M(O,`${Y??""} [CURRENT]`),[()=>pe(n())],Z),I(S,C)};y(A,S=>{n()&&S(N)})}var x=w(A,2);{var z=S=>{var C=yr(),$=j(C);let O;var Y=b($);h($),ve(),R((Le,Se)=>{O=sr($,1,"monospace svelte-1kpux3b",null,O,Le),M(Y,`${Se??""} [LATEST]`)},[()=>({"is-new":o()}),()=>pe(s())],Z),I(S,C)};y(x,S=>{s()&&S(z)})}h(f),I(l,f)};y(_,l=>{(n()||s())&&l(u)})}h(p);var d=w(p,2),m=b(d),g=w(m,2);h(d),h(v),X("click",m,()=>k()),X("click",g,()=>xr()),I(a,v),te(),t()}var Vr=L('<div class="app-wrapper svelte-17nvpzi"><!> <div class="app-bottom-wrapper svelte-17nvpzi"><!> <!></div></div>');function Fr(a){const[e,r]=ne(),t=()=>F(ee,"$selectedPage",e);var n=Vr(),s=b(n);Nr(s,{});var o=w(s,2),i=b(o);Er(i);var c=w(i,2);{var k=v=>{$r(v,{})};y(c,v=>{t()==="settings"&&v(k)})}h(o),h(n),I(a,n),r()}export{Fr as component};
