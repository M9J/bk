import{t as L,a as w,c as we}from"../chunks/CBEUVfTW.js";import{i as ee}from"../chunks/BahYZabk.js";import{$ as Ie,i as Le,A as H,l as I,a0 as Se,x as ye,g as V,N as q,y as Ce,z as ne,B as Y,m as M,ad as $e,C as pe,j as ge,D as Ve,ap as J,ah as _e,a2 as se,aq as Be,F as W,ar as oe,as as Re,at as ze,ag as Oe,au as Te,k as Me,av as Fe,aw as Pe,ab as Ue,a8 as je,ax as De,ay as He,az as Ye,aA as Je,aj as ke,aB as Ge,p as ae,s as m,v as b,w as N,t as T,q as re,J as ie,o as Q,aC as Ke,aD as le}from"../chunks/DMh_EkK9.js";import{p as ce,i as R,s as P,a as te,b as qe}from"../chunks/Ca4NpeuK.js";import{o as We,w as j,g as ve}from"../chunks/Cu0qqruq.js";import{l as Qe,s as O,e as Z}from"../chunks/ssx_aiUo.js";function Ze(r,e){return e}function Xe(r,e,a,t){for(var n=[],o=e.length,i=0;i<o;i++)ze(e[i].e,n,!0);var s=o>0&&n.length===0&&a!==null;if(s){var c=a.parentNode;Oe(c),c.append(a),t.clear(),B(r,e[0].prev,e[o-1].next)}Te(n,()=>{for(var f=0;f<o;f++){var l=e[f];s||(t.delete(l.k),B(r,l.prev,l.next)),Me(l.e,!s)}})}function ea(r,e,a,t,n,o=null){var i=r,s={flags:e,items:new Map,first:null};{var c=r;i=I?H(Se(c)):c.appendChild(Ie())}I&&ye();var f=null,l=!1,g=q(()=>{var v=a();return je(v)?v:v==null?[]:_e(v)});Le(()=>{var v=V(g),h=v.length;if(l&&h===0)return;l=h===0;let d=!1;if(I){var x=i.data===Ce;x!==(h===0)&&(i=ne(),H(i),Y(!1),d=!0)}if(I){for(var A=null,u,p=0;p<h;p++){if(M.nodeType===8&&M.data===$e){i=M,d=!0,Y(!1);break}var S=v[p],_=t(S,p);u=be(M,s,A,null,S,_,p,n,e,a),s.items.set(_,u),A=u}h>0&&H(ne())}I||aa(v,s,i,n,e,t,a),o!==null&&(h===0?f?pe(f):f=ge(()=>o(i)):f!==null&&Ve(f,()=>{f=null})),d&&Y(!0),V(g)}),I&&(i=M)}function aa(r,e,a,t,n,o,i){var s=r.length,c=e.items,f=e.first,l=f,g,v=null,h=[],d=[],x,A,u,p;for(p=0;p<s;p+=1){if(x=r[p],A=o(x,p),u=c.get(A),u===void 0){var S=l?l.e.nodes_start:a;v=be(S,e,v,v===null?e.first:v.next,x,A,p,t,n,i),c.set(A,v),h=[],d=[],l=v.next;continue}if(ra(u,x,p),(u.e.f&J)!==0&&pe(u.e),u!==l){if(g!==void 0&&g.has(u)){if(h.length<d.length){var _=d[0],k;v=_.prev;var C=h[0],E=h[h.length-1];for(k=0;k<h.length;k+=1)fe(h[k],_,a);for(k=0;k<d.length;k+=1)g.delete(d[k]);B(e,C.prev,E.next),B(e,v,C),B(e,E,_),l=_,v=E,p-=1,h=[],d=[]}else g.delete(u),fe(u,l,a),B(e,u.prev,u.next),B(e,u,v===null?e.first:v.next),B(e,v,u),v=u;continue}for(h=[],d=[];l!==null&&l.k!==A;)(l.e.f&J)===0&&(g??(g=new Set)).add(l),d.push(l),l=l.next;if(l===null)continue;u=l}h.push(u),v=u,l=u.next}if(l!==null||g!==void 0){for(var y=g===void 0?[]:_e(g);l!==null;)(l.e.f&J)===0&&y.push(l),l=l.next;var $=y.length;if($>0){var z=s===0?a:null;Xe(e,y,z,c)}}se.first=e.first&&e.first.e,se.last=v&&v.e}function ra(r,e,a,t){Be(r.v,e),r.i=a}function be(r,e,a,t,n,o,i,s,c,f){var l=(c&Fe)!==0,g=(c&Pe)===0,v=l?g?W(n):oe(n):n,h=(c&Re)===0?i:oe(i),d={i:h,v,k:o,a:null,e:null,prev:a,next:t};try{return d.e=ge(()=>s(r,v,h,f),I),d.e.prev=a&&a.e,d.e.next=t&&t.e,a===null?e.first=d:(a.next=d,a.e.next=d.e),t!==null&&(t.prev=d,t.e.prev=d.e),d}finally{}}function fe(r,e,a){for(var t=r.next?r.next.e.nodes_start:a,n=e?e.e.nodes_start:a,o=r.e.nodes_start;o!==t;){var i=Ue(o);n.before(o),o=i}}function B(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}const ue=[...` 	
\r\fÂ \v\uFEFF`];function ta(r,e,a){var t=""+r;if(a){for(var n in a)if(a[n])t=t?t+" "+n:n;else if(t.length)for(var o=n.length,i=0;(i=t.indexOf(n,i))>=0;){var s=i+o;(i===0||ue.includes(t[i-1]))&&(s===t.length||ue.includes(t[s]))?t=(i===0?"":t.substring(0,i))+t.substring(s+1):i=s}}return t===""?null:t}function na(r,e,a,t,n,o){var i=r.__className;if(I||i!==a||i===void 0){var s=ta(a,t,o);(!I||s!==r.getAttribute("class"))&&(s==null?r.removeAttribute("class"):r.className=s),r.__className=a}else if(o&&n!==o)for(var c in o){var f=!!o[c];(n==null||f!==!!n[c])&&r.classList.toggle(c,f)}return o}const sa=Symbol("is custom element"),oa=Symbol("is html");function F(r,e,a,t){var n=ia(r);I&&(n[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||n[e]!==(n[e]=a)&&(e==="loading"&&(r[He]=a),a==null?r.removeAttribute(e):typeof a!="string"&&la(r).includes(e)?r[e]=a:r.setAttribute(e,a))}function ia(r){return r.__attributes??(r.__attributes={[sa]:r.nodeName.includes("-"),[oa]:r.namespaceURI===De})}var de=new Map;function la(r){var e=de.get(r.nodeName);if(e)return e;de.set(r.nodeName,e=[]);for(var a,t=r,n=Element.prototype;n!==t;){a=Je(t);for(var o in a)a[o].set&&e.push(o);t=Ye(t)}return e}function me(r,e,a){if(r.multiple)return fa(r,e);for(var t of r.options){var n=U(t);if(Ge(n,e)){t.selected=!0;return}}(!a||e!==void 0)&&(r.selectedIndex=-1)}function ca(r,e){ke(()=>{var a=new MutationObserver(()=>{var t=r.__value;me(r,t)});return a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function va(r,e,a=e){var t=!0;Qe(r,"change",n=>{var o=n?"[selected]":":checked",i;if(r.multiple)i=[].map.call(r.querySelectorAll(o),U);else{var s=r.querySelector(o)??r.querySelector("option:not([disabled])");i=s&&U(s)}a(i)}),ke(()=>{var n=e();if(me(r,n,t),t&&n===void 0){var o=r.querySelector(":checked");o!==null&&(n=U(o),a(n))}r.__value=n,t=!1}),ca(r)}function fa(r,e){for(var a of r.options)a.selected=~e.indexOf(U(a))}function U(r){return"__value"in r?r.__value:r.value}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ne={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${Ne.faviconSize}`};async function ua(){const e="/bk"+"/bookmarks";try{const a=await fetch(e+"/index.json");if(a){const t=await a.json();if(Array.isArray(t)?t.length>0:!1){const i=t.sort().map(s=>fetch(e+"/"+s+".json").then(c=>c.json()).then(c=>(c.bookmarkIndexName=s,c)));return await Promise.all(i)}}}catch(a){console.error("bookmarks folder or bookmarks/index.json not found. Error:",a)}}async function da(r){const e={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const n=r[t],o=n.LINK,i=n.ICON;let s="";if(i)s=i;else if(o){const c=new URL(o),f=c.protocol+"//"+c.hostname;s=Ne.faviconFetchServiceURL(f)}else s=Ae;n.bookmarkIndexName&&(e[n.bookmarkIndexName]=s)}return e}var ha=L('<div class="bk-title svelte-1jzx7ns"> </div>'),pa=L('<div class="bk-desc svelte-1jzx7ns"> </div>'),ga=L('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div></div> <!> <!></a>');function _a(r,e){ae(e,!1);let a=ce(e,"bookmark",8),t=ce(e,"faviconLink",8);const n=a().LINK||"javascript:void(0)";let o=a().NAME||a().LINK;function i(_){const k=_==null?void 0:_.target;k&&(k.src=Ae)}ee();var s=ga();F(s,"href",n),F(s,"title",o);var c=m(s),f=m(c),l=m(f);b(f);var g=N(f,2),v=m(g),h=m(v,!0);b(v);var d=N(v,2),x=m(d,!0);b(d),b(g),b(c);var A=N(c,2);{var u=_=>{var k=ha(),C=m(k,!0);b(k),T(()=>O(C,a().TITLE)),w(_,k)};R(A,_=>{a().TITLE&&_(u)})}var p=N(A,2);{var S=_=>{var k=pa(),C=m(k,!0);b(k),T(()=>O(C,a().DESC)),w(_,k)};R(p,_=>{a().DESC&&_(S)})}b(s),T(()=>{F(s,"data-bookmark-icon",a().ICON),F(l,"src",t()),O(h,a().NAME),O(x,a().LINK)}),Z("error",l,i),w(r,s),re()}var ka=L('<div class="bk-wrapper svelte-16cb4x4"><div class="bk-container svelte-16cb4x4"></div></div>');function ba(r,e){ae(e,!1);let a=W([]),t=W({});async function n(){const s=await ua();s&&ie(a,s)}We(async()=>{await n();const s=await da(V(a));s&&ie(t,s)}),ee();var o=ka(),i=m(o);ea(i,5,()=>V(a),Ze,(s,c)=>{var f=we(),l=Q(f);{var g=v=>{_a(v,{get bookmark(){return V(c)},get faviconLink(){return V(t)[V(c).bookmarkIndexName]}})};R(l,v=>{V(c).bookmarkIndexName&&v(g)})}w(s,f)}),b(i),b(o),w(r,o),re()}const X=j("home"),G=j(null),K=j(null);var ma=L('<div class="header svelte-148zt7e"><a class="brand svelte-148zt7e"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function Aa(r){const[e,a]=te(),t=()=>P(X,"$selectedPage",e),n="https://m9j.github.io/bk";var o=ma(),i=m(o);F(i,"href",n),i.textContent="BOOKMARKS";var s=N(i,2);T(()=>{t(),Ke(()=>{})});var c=m(s);c.value=c.__value="home";var f=N(c);f.value=f.__value="settings",b(s),b(o),va(s,t,l=>qe(X,l)),w(r,o),a()}function Na(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(a=>caches.delete(a)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function he(r){if(r){const e=new Date(Number(r)),a=String(e.getFullYear()),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()),i=String(e.getMinutes()),s=String(e.getSeconds());return`${a}.${t}${n}.${o}${i}${s}`}}async function xa(){const e="/bk"+"/version.json";try{const a=await fetch(e);if(!a.ok)console.log(new Error("Failed to fetch current version"));else return(await a.json()).version}catch(a){console.error("Current version check failed: ",a)}}async function Ea(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(r,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const a=await e.json();return JSON.parse(atob(a.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var wa=L('<span class="monospace svelte-1kpux3b"> </span> <br>',1),Ia=L("<span> </span><br>",1),La=L("<div>Versions:<br> <!> <!></div>"),Sa=L('<div class="settings-container hide svelte-1kpux3b" id="settings-container"><div class="columns svelte-1kpux3b"><!></div> <div class="rows svelte-1kpux3b"><button class="settings-button svelte-1kpux3b">Check for latest version</button> <button class="settings-button svelte-1kpux3b">Hard reload application</button></div></div>');function ya(r,e){ae(e,!1);const[a,t]=te(),n=()=>P(G,"$currentVersion",a),o=()=>P(K,"$latestVersion",a),i=()=>P(s,"$isNew",a),s=j(!1);(async()=>(await c(),await f()))();async function c(){const u=await xa();G.update(p=>u)}async function f(){const u=await Ea();K.update(p=>u),s.update(p=>Number(ve(K))>Number(ve(G)))}ee();var l=Sa(),g=m(l),v=m(g);{var h=u=>{var p=La(),S=N(m(p),3);{var _=E=>{var y=wa(),$=Q(y),z=m($);b($),le(2),T(D=>O(z,`${D??""} [CURRENT]`),[()=>he(n())],q),w(E,y)};R(S,E=>{n()&&E(_)})}var k=N(S,2);{var C=E=>{var y=Ia(),$=Q(y);let z;var D=m($);b($),le(),T((xe,Ee)=>{z=na($,1,"monospace svelte-1kpux3b",null,z,xe),O(D,`${Ee??""} [LATEST]`)},[()=>({"is-new":i()}),()=>he(o())],q),w(E,y)};R(k,E=>{o()&&E(C)})}b(p),w(u,p)};R(v,u=>{(n()||o())&&u(h)})}b(g);var d=N(g,2),x=m(d),A=N(x,2);b(d),b(l),Z("click",x,()=>f()),Z("click",A,()=>Na()),w(r,l),re(),t()}var Ca=L('<div class="app-wrapper svelte-17nvpzi"><!> <div class="app-bottom-wrapper svelte-17nvpzi"><!> <!></div></div>');function Ta(r){const[e,a]=te(),t=()=>P(X,"$selectedPage",e);var n=Ca(),o=m(n);ba(o,{});var i=N(o,2),s=m(i);Aa(s);var c=N(s,2);{var f=l=>{ya(l,{})};R(c,l=>{t()==="settings"&&l(f)})}b(i),b(n),w(r,n),a()}export{Ta as component};
