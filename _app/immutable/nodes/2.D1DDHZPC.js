import{t as S,a as I,c as Ie}from"../chunks/CBEUVfTW.js";import{i as ee}from"../chunks/BahYZabk.js";import{$ as Le,i as Se,A as Y,l as L,a0 as xe,x as ye,g as V,N as q,y as Ce,z as ne,B as J,m as F,ad as $e,C as ge,j as ke,D as Ve,ap as j,ah as pe,a2 as se,aq as Be,F as W,ar as oe,as as Re,at as Oe,ag as Te,au as Me,k as Fe,av as Pe,aw as Ue,ab as ze,a8 as De,ax as He,ay as Ye,az as Je,aA as je,aj as _e,aB as Ge,p as re,s as m,v as b,w as N,t as M,q as ae,J as ie,o as Q,aC as Ke,aD as le}from"../chunks/DMh_EkK9.js";import{p as ce,i as R,s as U,a as te,b as qe}from"../chunks/Ca4NpeuK.js";import{o as We,w as D,g as ve}from"../chunks/Cu0qqruq.js";import{l as Qe,s as T,e as Z}from"../chunks/ssx_aiUo.js";function Ze(a,e){return e}function Xe(a,e,r,t){for(var n=[],o=e.length,i=0;i<o;i++)Oe(e[i].e,n,!0);var s=o>0&&n.length===0&&r!==null;if(s){var c=r.parentNode;Te(c),c.append(r),t.clear(),B(a,e[0].prev,e[o-1].next)}Me(n,()=>{for(var f=0;f<o;f++){var l=e[f];s||(t.delete(l.k),B(a,l.prev,l.next)),Fe(l.e,!s)}})}function er(a,e,r,t,n,o=null){var i=a,s={flags:e,items:new Map,first:null};{var c=a;i=L?Y(xe(c)):c.appendChild(Le())}L&&ye();var f=null,l=!1,k=q(()=>{var v=r();return De(v)?v:v==null?[]:pe(v)});Se(()=>{var v=V(k),h=v.length;if(l&&h===0)return;l=h===0;let d=!1;if(L){var E=i.data===Ce;E!==(h===0)&&(i=ne(),Y(i),J(!1),d=!0)}if(L){for(var A=null,u,g=0;g<h;g++){if(F.nodeType===8&&F.data===$e){i=F,d=!0,J(!1);break}var x=v[g],p=t(x,g);u=be(F,s,A,null,x,p,g,n,e,r),s.items.set(p,u),A=u}h>0&&Y(ne())}L||rr(v,s,i,n,e,t,r),o!==null&&(h===0?f?ge(f):f=ke(()=>o(i)):f!==null&&Ve(f,()=>{f=null})),d&&J(!0),V(k)}),L&&(i=F)}function rr(a,e,r,t,n,o,i){var s=a.length,c=e.items,f=e.first,l=f,k,v=null,h=[],d=[],E,A,u,g;for(g=0;g<s;g+=1){if(E=a[g],A=o(E,g),u=c.get(A),u===void 0){var x=l?l.e.nodes_start:r;v=be(x,e,v,v===null?e.first:v.next,E,A,g,t,n,i),c.set(A,v),h=[],d=[],l=v.next;continue}if(ar(u,E,g),(u.e.f&j)!==0&&ge(u.e),u!==l){if(k!==void 0&&k.has(u)){if(h.length<d.length){var p=d[0],_;v=p.prev;var C=h[0],w=h[h.length-1];for(_=0;_<h.length;_+=1)fe(h[_],p,r);for(_=0;_<d.length;_+=1)k.delete(d[_]);B(e,C.prev,w.next),B(e,v,C),B(e,w,p),l=p,v=w,g-=1,h=[],d=[]}else k.delete(u),fe(u,l,r),B(e,u.prev,u.next),B(e,u,v===null?e.first:v.next),B(e,v,u),v=u;continue}for(h=[],d=[];l!==null&&l.k!==A;)(l.e.f&j)===0&&(k??(k=new Set)).add(l),d.push(l),l=l.next;if(l===null)continue;u=l}h.push(u),v=u,l=u.next}if(l!==null||k!==void 0){for(var y=k===void 0?[]:pe(k);l!==null;)(l.e.f&j)===0&&y.push(l),l=l.next;var $=y.length;if($>0){var O=s===0?r:null;Xe(e,y,O,c)}}se.first=e.first&&e.first.e,se.last=v&&v.e}function ar(a,e,r,t){Be(a.v,e),a.i=r}function be(a,e,r,t,n,o,i,s,c,f){var l=(c&Pe)!==0,k=(c&Ue)===0,v=l?k?W(n):oe(n):n,h=(c&Re)===0?i:oe(i),d={i:h,v,k:o,a:null,e:null,prev:r,next:t};try{return d.e=ke(()=>s(a,v,h,f),L),d.e.prev=r&&r.e,d.e.next=t&&t.e,r===null?e.first=d:(r.next=d,r.e.next=d.e),t!==null&&(t.prev=d,t.e.prev=d.e),d}finally{}}function fe(a,e,r){for(var t=a.next?a.next.e.nodes_start:r,n=e?e.e.nodes_start:r,o=a.e.nodes_start;o!==t;){var i=ze(o);n.before(o),o=i}}function B(a,e,r){e===null?a.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}const ue=[...` 	
\r\fÂ \v\uFEFF`];function tr(a,e,r){var t=""+a;if(r){for(var n in r)if(r[n])t=t?t+" "+n:n;else if(t.length)for(var o=n.length,i=0;(i=t.indexOf(n,i))>=0;){var s=i+o;(i===0||ue.includes(t[i-1]))&&(s===t.length||ue.includes(t[s]))?t=(i===0?"":t.substring(0,i))+t.substring(s+1):i=s}}return t===""?null:t}function nr(a,e,r,t,n,o){var i=a.__className;if(L||i!==r||i===void 0){var s=tr(r,t,o);(!L||s!==a.getAttribute("class"))&&(s==null?a.removeAttribute("class"):a.className=s),a.__className=r}else if(o&&n!==o)for(var c in o){var f=!!o[c];(n==null||f!==!!n[c])&&a.classList.toggle(c,f)}return o}const sr=Symbol("is custom element"),or=Symbol("is html");function P(a,e,r,t){var n=ir(a);L&&(n[e]=a.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&a.nodeName==="LINK")||n[e]!==(n[e]=r)&&(e==="loading"&&(a[Ye]=r),r==null?a.removeAttribute(e):typeof r!="string"&&lr(a).includes(e)?a[e]=r:a.setAttribute(e,r))}function ir(a){return a.__attributes??(a.__attributes={[sr]:a.nodeName.includes("-"),[or]:a.namespaceURI===He})}var de=new Map;function lr(a){var e=de.get(a.nodeName);if(e)return e;de.set(a.nodeName,e=[]);for(var r,t=a,n=Element.prototype;n!==t;){r=je(t);for(var o in r)r[o].set&&e.push(o);t=Je(t)}return e}function me(a,e,r){if(a.multiple)return fr(a,e);for(var t of a.options){var n=z(t);if(Ge(n,e)){t.selected=!0;return}}(!r||e!==void 0)&&(a.selectedIndex=-1)}function cr(a,e){_e(()=>{var r=new MutationObserver(()=>{var t=a.__value;me(a,t)});return r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function vr(a,e,r=e){var t=!0;Qe(a,"change",n=>{var o=n?"[selected]":":checked",i;if(a.multiple)i=[].map.call(a.querySelectorAll(o),z);else{var s=a.querySelector(o)??a.querySelector("option:not([disabled])");i=s&&z(s)}r(i)}),_e(()=>{var n=e();if(me(a,n,t),t&&n===void 0){var o=a.querySelector(":checked");o!==null&&(n=z(o),r(n))}a.__value=n,t=!1}),cr(a)}function fr(a,e){for(var r of a.options)r.selected=~e.indexOf(z(r))}function z(a){return"__value"in a?a.__value:a.value}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ne={faviconSize:128,faviconFetchServiceURL:a=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${a}&size=${Ne.faviconSize}`};async function ur(){const e="/bk"+"/bookmarks";try{const r=await fetch(e+"/index.json");if(r){const t=await r.json();if(Array.isArray(t)?t.length>0:!1){const i=t.sort().map(s=>fetch(e+"/"+s+".json").then(c=>c.json()).then(c=>(c.bookmarkIndexName=s,c)));return await Promise.all(i)}}}catch(r){console.error("bookmarks folder or bookmarks/index.json not found. Error:",r)}}async function dr(a){const e={};if(Array.isArray(a)?a.length>0:!1)for(let t=0;t<a.length;t++){const n=a[t],o=n.LINK,i=n.ICON;let s="";if(i)s=i;else if(o){const c=new URL(o),f=c.protocol+"//"+c.hostname;s=Ne.faviconFetchServiceURL(f)}else s=Ae;n.bookmarkIndexName&&(e[n.bookmarkIndexName]=s)}return e}var hr=S('<div class="bk-title svelte-rbrhkd"> </div>'),gr=S('<div class="bk-desc svelte-rbrhkd"> </div>'),kr=S('<a class="bk svelte-rbrhkd" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-rbrhkd"><div class="bk-icon svelte-rbrhkd"><img class="bk-icon-img svelte-rbrhkd" alt="icon" width="100%" height="100%" loading="lazy"></div> <div class="bk-meta-info svelte-rbrhkd"><div class="bk-name svelte-rbrhkd"> </div> <div class="bk-link svelte-rbrhkd"> </div></div></div> <!> <!></a>');function pr(a,e){re(e,!1);let r=ce(e,"bookmark",8),t=ce(e,"faviconLink",8);const n=r().LINK||"javascript:void(0)";let o=r().NAME||r().LINK;function i(p){const _=p==null?void 0:p.target;_&&(_.src=Ae)}ee();var s=kr();P(s,"href",n),P(s,"title",o);var c=m(s),f=m(c),l=m(f);b(f);var k=N(f,2),v=m(k),h=m(v,!0);b(v);var d=N(v,2),E=m(d,!0);b(d),b(k),b(c);var A=N(c,2);{var u=p=>{var _=hr(),C=m(_,!0);b(_),M(()=>T(C,r().TITLE)),I(p,_)};R(A,p=>{r().TITLE&&p(u)})}var g=N(A,2);{var x=p=>{var _=gr(),C=m(_,!0);b(_),M(()=>T(C,r().DESC)),I(p,_)};R(g,p=>{r().DESC&&p(x)})}b(s),M(()=>{P(s,"data-bookmark-icon",r().ICON),P(l,"src",t()),T(h,r().NAME),T(E,r().LINK)}),Z("error",l,i),I(a,s),ae()}var _r=S('<div class="bk-wrapper svelte-bu7dhk"><div class="bk-container svelte-bu7dhk"></div></div>');function br(a,e){re(e,!1);let r=W([]),t=W({});async function n(){const s=await ur();s&&ie(r,s)}We(async()=>{await n();const s=await dr(V(r));s&&ie(t,s)}),ee();var o=_r(),i=m(o);er(i,5,()=>V(r),Ze,(s,c)=>{var f=Ie(),l=Q(f);{var k=v=>{pr(v,{get bookmark(){return V(c)},get faviconLink(){return V(t)[V(c).bookmarkIndexName]}})};R(l,v=>{V(c).bookmarkIndexName&&v(k)})}I(s,f)}),b(i),b(o),I(a,o),ae()}const X=D("home"),G=D(null),K=D(null);var mr=S('<div class="header svelte-148zt7e"><a class="brand svelte-148zt7e"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function Ar(a){const[e,r]=te(),t=()=>U(X,"$selectedPage",e),n="https://m9j.github.io/bk";var o=mr(),i=m(o);P(i,"href",n),i.textContent="BOOKMARKS";var s=N(i,2);M(()=>{t(),Ke(()=>{})});var c=m(s);c.value=c.__value="home";var f=N(c);f.value=f.__value="settings",b(s),b(o),vr(s,t,l=>qe(X,l)),I(a,o),r()}function Nr(){navigator.serviceWorker.getRegistrations().then(a=>{a.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(r=>caches.delete(r)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function he(a){if(a){const e=new Date(Number(a)),r=String(e.getFullYear()),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),o=e.getHours()*3600+e.getMinutes()*60+e.getSeconds();String(o).padStart(5,"0");const i=String(e.getHours()),s=String(e.getMinutes()),c=String(e.getSeconds());return`${r}.${t}${n}.${i}${s}${c}`}}async function Er(){const e="/bk"+"/version.json";try{const r=await fetch(e);if(!r.ok)console.log(new Error("Failed to fetch current version"));else return(await r.json()).version}catch(r){console.error("Current version check failed: ",r)}}async function wr(){const a="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(a,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const r=await e.json();return JSON.parse(atob(r.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var Ir=S('<span class="monospace svelte-1kpux3b"> </span> <br>',1),Lr=S("<span> </span><br>",1),Sr=S("<div>Versions:<br> <!> <!></div>"),xr=S('<div class="settings-container hide svelte-1kpux3b" id="settings-container"><div class="columns svelte-1kpux3b"><!></div> <div class="rows svelte-1kpux3b"><button class="settings-button svelte-1kpux3b">Check for latest version</button> <button class="settings-button svelte-1kpux3b">Hard reload application</button></div></div>');function yr(a,e){re(e,!1);const[r,t]=te(),n=()=>U(G,"$currentVersion",r),o=()=>U(K,"$latestVersion",r),i=()=>U(s,"$isNew",r),s=D(!1);(async()=>(await c(),await f()))();async function c(){const u=await Er();G.update(g=>u)}async function f(){const u=await wr();K.update(g=>u),s.update(g=>Number(ve(K))>Number(ve(G)))}ee();var l=xr(),k=m(l),v=m(k);{var h=u=>{var g=Sr(),x=N(m(g),3);{var p=w=>{var y=Ir(),$=Q(y),O=m($);b($),le(2),M(H=>T(O,`${H??""} [CURRENT]`),[()=>he(n())],q),I(w,y)};R(x,w=>{n()&&w(p)})}var _=N(x,2);{var C=w=>{var y=Lr(),$=Q(y);let O;var H=m($);b($),le(),M((Ee,we)=>{O=nr($,1,"monospace svelte-1kpux3b",null,O,Ee),T(H,`${we??""} [LATEST]`)},[()=>({"is-new":i()}),()=>he(o())],q),I(w,y)};R(_,w=>{o()&&w(C)})}b(g),I(u,g)};R(v,u=>{(n()||o())&&u(h)})}b(k);var d=N(k,2),E=m(d),A=N(E,2);b(d),b(l),Z("click",E,()=>f()),Z("click",A,()=>Nr()),I(a,l),ae(),t()}var Cr=S('<div class="app-wrapper svelte-17nvpzi"><!> <div class="app-bottom-wrapper svelte-17nvpzi"><!> <!></div></div>');function Mr(a){const[e,r]=te(),t=()=>U(X,"$selectedPage",e);var n=Cr(),o=m(n);br(o,{});var i=N(o,2),s=m(i);Ar(s);var c=N(s,2);{var f=l=>{yr(l,{})};R(c,l=>{t()==="settings"&&l(f)})}b(i),b(n),I(a,n),r()}export{Mr as component};
