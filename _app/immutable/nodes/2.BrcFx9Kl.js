import{t as L,a as y,c as ye}from"../chunks/CBEUVfTW.js";import{i as ee}from"../chunks/BahYZabk.js";import{$ as Ie,i as Le,A as Y,l as I,a0 as Se,x as xe,g as V,N as W,y as Ce,z as ne,B as J,m as F,ad as $e,C as he,j as _e,D as Ve,ap as j,ah as ke,a2 as se,aq as Be,F as Q,ar as oe,as as Re,at as Oe,ag as Te,au as Me,k as Fe,av as Pe,aw as Ue,ab as qe,a8 as De,ax as He,ay as ze,az as Ye,aA as Je,aj as pe,aB as je,p as ae,s as b,v as m,w,t as M,q as re,J as ie,o as D,aC as Ge,aD as le}from"../chunks/DMh_EkK9.js";import{p as ce,i as R,s as U,a as te,b as Ke}from"../chunks/Ca4NpeuK.js";import{o as We,w as H,g as ve}from"../chunks/Cu0qqruq.js";import{l as Qe,s as T,e as Z}from"../chunks/ssx_aiUo.js";function Ze(r,e){return e}function Xe(r,e,a,t){for(var n=[],o=e.length,i=0;i<o;i++)Oe(e[i].e,n,!0);var s=o>0&&n.length===0&&a!==null;if(s){var l=a.parentNode;Te(l),l.append(a),t.clear(),B(r,e[0].prev,e[o-1].next)}Me(n,()=>{for(var f=0;f<o;f++){var c=e[f];s||(t.delete(c.k),B(r,c.prev,c.next)),Fe(c.e,!s)}})}function ea(r,e,a,t,n,o=null){var i=r,s={flags:e,items:new Map,first:null};{var l=r;i=I?Y(Se(l)):l.appendChild(Ie())}I&&xe();var f=null,c=!1,_=W(()=>{var v=a();return De(v)?v:v==null?[]:ke(v)});Le(()=>{var v=V(_),g=v.length;if(c&&g===0)return;c=g===0;let d=!1;if(I){var N=i.data===Ce;N!==(g===0)&&(i=ne(),Y(i),J(!1),d=!0)}if(I){for(var A=null,u,h=0;h<g;h++){if(F.nodeType===8&&F.data===$e){i=F,d=!0,J(!1);break}var S=v[h],k=t(S,h);u=me(F,s,A,null,S,k,h,n,e,a),s.items.set(k,u),A=u}g>0&&Y(ne())}I||aa(v,s,i,n,e,t,a),o!==null&&(g===0?f?he(f):f=_e(()=>o(i)):f!==null&&Ve(f,()=>{f=null})),d&&J(!0),V(_)}),I&&(i=F)}function aa(r,e,a,t,n,o,i){var s=r.length,l=e.items,f=e.first,c=f,_,v=null,g=[],d=[],N,A,u,h;for(h=0;h<s;h+=1){if(N=r[h],A=o(N,h),u=l.get(A),u===void 0){var S=c?c.e.nodes_start:a;v=me(S,e,v,v===null?e.first:v.next,N,A,h,t,n,i),l.set(A,v),g=[],d=[],c=v.next;continue}if(ra(u,N,h),(u.e.f&j)!==0&&he(u.e),u!==c){if(_!==void 0&&_.has(u)){if(g.length<d.length){var k=d[0],p;v=k.prev;var C=g[0],E=g[g.length-1];for(p=0;p<g.length;p+=1)fe(g[p],k,a);for(p=0;p<d.length;p+=1)_.delete(d[p]);B(e,C.prev,E.next),B(e,v,C),B(e,E,k),c=k,v=E,h-=1,g=[],d=[]}else _.delete(u),fe(u,c,a),B(e,u.prev,u.next),B(e,u,v===null?e.first:v.next),B(e,v,u),v=u;continue}for(g=[],d=[];c!==null&&c.k!==A;)(c.e.f&j)===0&&(_??(_=new Set)).add(c),d.push(c),c=c.next;if(c===null)continue;u=c}g.push(u),v=u,c=u.next}if(c!==null||_!==void 0){for(var x=_===void 0?[]:ke(_);c!==null;)(c.e.f&j)===0&&x.push(c),c=c.next;var $=x.length;if($>0){var O=s===0?a:null;Xe(e,x,O,l)}}se.first=e.first&&e.first.e,se.last=v&&v.e}function ra(r,e,a,t){Be(r.v,e),r.i=a}function me(r,e,a,t,n,o,i,s,l,f){var c=(l&Pe)!==0,_=(l&Ue)===0,v=c?_?Q(n):oe(n):n,g=(l&Re)===0?i:oe(i),d={i:g,v,k:o,a:null,e:null,prev:a,next:t};try{return d.e=_e(()=>s(r,v,g,f),I),d.e.prev=a&&a.e,d.e.next=t&&t.e,a===null?e.first=d:(a.next=d,a.e.next=d.e),t!==null&&(t.prev=d,t.e.prev=d.e),d}finally{}}function fe(r,e,a){for(var t=r.next?r.next.e.nodes_start:a,n=e?e.e.nodes_start:a,o=r.e.nodes_start;o!==t;){var i=qe(o);n.before(o),o=i}}function B(r,e,a){e===null?r.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}const ue=[...` 	
\r\fÂ \v\uFEFF`];function ta(r,e,a){var t=""+r;if(a){for(var n in a)if(a[n])t=t?t+" "+n:n;else if(t.length)for(var o=n.length,i=0;(i=t.indexOf(n,i))>=0;){var s=i+o;(i===0||ue.includes(t[i-1]))&&(s===t.length||ue.includes(t[s]))?t=(i===0?"":t.substring(0,i))+t.substring(s+1):i=s}}return t===""?null:t}function na(r,e,a,t,n,o){var i=r.__className;if(I||i!==a||i===void 0){var s=ta(a,t,o);(!I||s!==r.getAttribute("class"))&&(s==null?r.removeAttribute("class"):r.className=s),r.__className=a}else if(o&&n!==o)for(var l in o){var f=!!o[l];(n==null||f!==!!n[l])&&r.classList.toggle(l,f)}return o}const sa=Symbol("is custom element"),oa=Symbol("is html");function P(r,e,a,t){var n=ia(r);I&&(n[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||n[e]!==(n[e]=a)&&(e==="loading"&&(r[ze]=a),a==null?r.removeAttribute(e):typeof a!="string"&&la(r).includes(e)?r[e]=a:r.setAttribute(e,a))}function ia(r){return r.__attributes??(r.__attributes={[sa]:r.nodeName.includes("-"),[oa]:r.namespaceURI===He})}var de=new Map;function la(r){var e=de.get(r.nodeName);if(e)return e;de.set(r.nodeName,e=[]);for(var a,t=r,n=Element.prototype;n!==t;){a=Je(t);for(var o in a)a[o].set&&e.push(o);t=Ye(t)}return e}function be(r,e,a){if(r.multiple)return fa(r,e);for(var t of r.options){var n=q(t);if(je(n,e)){t.selected=!0;return}}(!a||e!==void 0)&&(r.selectedIndex=-1)}function ca(r,e){pe(()=>{var a=new MutationObserver(()=>{var t=r.__value;be(r,t)});return a.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function va(r,e,a=e){var t=!0;Qe(r,"change",n=>{var o=n?"[selected]":":checked",i;if(r.multiple)i=[].map.call(r.querySelectorAll(o),q);else{var s=r.querySelector(o)??r.querySelector("option:not([disabled])");i=s&&q(s)}a(i)}),pe(()=>{var n=e();if(be(r,n,t),t&&n===void 0){var o=r.querySelector(":checked");o!==null&&(n=q(o),a(n))}r.__value=n,t=!1}),ca(r)}function fa(r,e){for(var a of r.options)a.selected=~e.indexOf(q(a))}function q(r){return"__value"in r?r.__value:r.value}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",we={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${we.faviconSize}`};async function ua(){const e="/bk"+"/bookmarks";try{const a=await fetch(e+"/index.json");if(a){const t=await a.json();if(Array.isArray(t)?t.length>0:!1){const i=t.sort().map(s=>fetch(e+"/"+s+".json").then(l=>l.json()).then(l=>(l.bookmarkIndexName=s,l)));return await Promise.all(i)}}}catch(a){console.error("bookmarks folder or bookmarks/index.json not found. Error:",a)}}async function da(r){const e={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const n=r[t],o=n.LINK,i=n.ICON;let s="";if(i)s=i;else if(o){const l=new URL(o),f=l.protocol+"//"+l.hostname;s=we.faviconFetchServiceURL(f)}else s=Ae;n.bookmarkIndexName&&(e[n.bookmarkIndexName]=s)}return e}var ga=L('<div class="bk-title svelte-aawquw"> </div>'),ha=L('<div class="bk-desc svelte-aawquw"> </div>'),_a=L('<a class="bk svelte-aawquw" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-aawquw"><div class="bk-icon svelte-aawquw"><img class="bk-icon-img svelte-aawquw" alt="icon" width="100%" height="100%" loading="lazy"></div> <div class="bk-meta-info svelte-aawquw"><div class="bk-name svelte-aawquw"> </div> <div class="bk-link svelte-aawquw"> </div></div></div> <!> <!></a>');function ka(r,e){ae(e,!1);let a=ce(e,"bookmark",8),t=ce(e,"faviconLink",8);const n=a().LINK||"javascript:void(0)";let o=a().NAME||a().LINK;function i(k){const p=k==null?void 0:k.target;p&&(p.src=Ae)}ee();var s=_a();P(s,"href",n),P(s,"title",o);var l=b(s),f=b(l),c=b(f);m(f);var _=w(f,2),v=b(_),g=b(v,!0);m(v);var d=w(v,2),N=b(d,!0);m(d),m(_),m(l);var A=w(l,2);{var u=k=>{var p=ga(),C=b(p,!0);m(p),M(()=>T(C,a().TITLE)),y(k,p)};R(A,k=>{a().TITLE&&k(u)})}var h=w(A,2);{var S=k=>{var p=ha(),C=b(p,!0);m(p),M(()=>T(C,a().DESC)),y(k,p)};R(h,k=>{a().DESC&&k(S)})}m(s),M(()=>{P(s,"data-bookmark-icon",a().ICON),P(c,"src",t()),T(g,a().NAME),T(N,a().LINK)}),Z("error",c,i),y(r,s),re()}var pa=L('<div class="bk-wrapper svelte-lq30lx"><div class="bk-container svelte-lq30lx"></div></div>');function ma(r,e){ae(e,!1);let a=Q([]),t=Q({});async function n(){const s=await ua();s&&ie(a,s)}We(async()=>{await n();const s=await da(V(a));s&&ie(t,s)}),ee();var o=pa(),i=b(o);ea(i,5,()=>V(a),Ze,(s,l)=>{var f=ye(),c=D(f);{var _=v=>{ka(v,{get bookmark(){return V(l)},get faviconLink(){return V(t)[V(l).bookmarkIndexName]}})};R(c,v=>{V(l).bookmarkIndexName&&v(_)})}y(s,f)}),m(i),m(o),y(r,o),re()}const X=H("home"),G=H(null),K=H(null);var ba=L('<div class="header svelte-1x3n51a"><a class="brand svelte-1x3n51a"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function Aa(r){const[e,a]=te(),t=()=>U(X,"$selectedPage",e),n="https://m9j.github.io/bk";var o=ba(),i=b(o);P(i,"href",n),i.textContent="BOOKMARKS";var s=w(i,2);M(()=>{t(),Ge(()=>{})});var l=b(s);l.value=l.__value="home";var f=w(l);f.value=f.__value="settings",m(s),m(o),va(s,t,c=>Ke(X,c)),y(r,o),a()}function wa(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(a=>caches.delete(a)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function ge(r){if(r){const e=new Date(Number(r)),a=String(e.getFullYear()),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),o=e.getHours()*3600+e.getMinutes()*60+e.getSeconds();String(o).padStart(5,"0");const i=String(e.getHours()),s=String(e.getMinutes()),l=String(e.getSeconds());return`${a}.${t}${n}.${i}${s}${l}`}}async function Na(){const e="/bk"+"/version.json";try{const a=await fetch(e);if(!a.ok)console.log(new Error("Failed to fetch current version"));else return(await a.json()).version}catch(a){console.error("Current version check failed: ",a)}}async function Ea(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(r,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const a=await e.json();return JSON.parse(atob(a.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var ya=L('<span class="monospace svelte-1xvnuyl"> </span> <br>',1),Ia=L("<span> </span><br>",1),La=L("<div>Versions:<br> <!> <!></div>"),Sa=L('<div class="settings-container hide svelte-1xvnuyl" id="settings-container"><div class="columns svelte-1xvnuyl"><!></div> <div class="rows svelte-1xvnuyl"><button class="settings-button svelte-1xvnuyl">Check for latest version</button> <button class="settings-button svelte-1xvnuyl">Hard reload application</button></div></div>');function xa(r,e){ae(e,!1);const[a,t]=te(),n=()=>U(G,"$currentVersion",a),o=()=>U(K,"$latestVersion",a),i=()=>U(s,"$isNew",a),s=H(!1);(async()=>(await l(),await f()))();async function l(){const u=await Na();G.update(h=>u)}async function f(){const u=await Ea();K.update(h=>u),s.update(h=>Number(ve(K))>Number(ve(G)))}ee();var c=Sa(),_=b(c),v=b(_);{var g=u=>{var h=La(),S=w(b(h),3);{var k=E=>{var x=ya(),$=D(x),O=b($);m($),le(2),M(z=>T(O,`${z??""} [CURRENT]`),[()=>ge(n())],W),y(E,x)};R(S,E=>{n()&&E(k)})}var p=w(S,2);{var C=E=>{var x=Ia(),$=D(x);let O;var z=b($);m($),le(),M((Ne,Ee)=>{O=na($,1,"monospace svelte-1xvnuyl",null,O,Ne),T(z,`${Ee??""} [LATEST]`)},[()=>({"is-new":i()}),()=>ge(o())],W),y(E,x)};R(p,E=>{o()&&E(C)})}m(h),y(u,h)};R(v,u=>{(n()||o())&&u(g)})}m(_);var d=w(_,2),N=b(d),A=w(N,2);m(d),m(c),Z("click",N,()=>f()),Z("click",A,()=>wa()),y(r,c),re(),t()}var Ca=L("<!> <!> <!>",1);function Ma(r){const[e,a]=te(),t=()=>U(X,"$selectedPage",e);var n=Ca(),o=D(n);ma(o,{});var i=w(o,2);Aa(i);var s=w(i,2);{var l=f=>{xa(f,{})};R(s,f=>{t()==="settings"&&f(l)})}y(r,n),a()}export{Ma as component};
