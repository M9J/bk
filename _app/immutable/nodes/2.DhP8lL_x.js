import{t as w,a as I,c as Ae}from"../chunks/ShRlSRrh.js";import{i as X}from"../chunks/C4lPoHSt.js";import{$ as Ne,i as Ee,A as Y,l as S,a0 as Ie,x as Le,g as V,N as q,y as Se,z as ae,B as J,m as M,ad as we,C as de,j as he,D as ye,ap as j,ah as ke,a2 as ne,aq as xe,F as W,ar as se,as as Ce,at as Ve,ag as Be,au as Re,k as $e,av as Oe,aw as Te,ab as Me,a8 as Fe,ax as Pe,ay as Ue,az as ze,aA as De,aj as ge,aB as He,p as ee,s as A,v as b,w as E,t as O,q as re,J as oe,o as U,aC as Ye,aD as ie}from"../chunks/D-K9HiIO.js";import{p as le,i as R,s as z,a as te,b as Je}from"../chunks/DbvTTcjW.js";import{o as je,w as D}from"../chunks/75HYu9UQ.js";import{l as Ge,s as $,e as Q}from"../chunks/C1qIrR1b.js";function Ke(t,e){return e}function qe(t,e,r,a){for(var n=[],o=e.length,s=0;s<o;s++)Ve(e[s].e,n,!0);var i=o>0&&n.length===0&&r!==null;if(i){var c=r.parentNode;Be(c),c.append(r),a.clear(),B(t,e[0].prev,e[o-1].next)}Re(n,()=>{for(var v=0;v<o;v++){var l=e[v];i||(a.delete(l.k),B(t,l.prev,l.next)),$e(l.e,!i)}})}function We(t,e,r,a,n,o=null){var s=t,i={flags:e,items:new Map,first:null};{var c=t;s=S?Y(Ie(c)):c.appendChild(Ne())}S&&Le();var v=null,l=!1,k=q(()=>{var f=r();return Fe(f)?f:f==null?[]:ke(f)});Ee(()=>{var f=V(k),h=f.length;if(l&&h===0)return;l=h===0;let d=!1;if(S){var L=s.data===Se;L!==(h===0)&&(s=ae(),Y(s),J(!1),d=!0)}if(S){for(var p=null,u,m=0;m<h;m++){if(M.nodeType===8&&M.data===we){s=M,d=!0,J(!1);break}var C=f[m],g=a(C,m);u=_e(M,i,p,null,C,g,m,n,e,r),i.items.set(g,u),p=u}h>0&&Y(ae())}S||Qe(f,i,s,n,e,a,r),o!==null&&(h===0?v?de(v):v=he(()=>o(s)):v!==null&&ye(v,()=>{v=null})),d&&J(!0),V(k)}),S&&(s=M)}function Qe(t,e,r,a,n,o,s){var i=t.length,c=e.items,v=e.first,l=v,k,f=null,h=[],d=[],L,p,u,m;for(m=0;m<i;m+=1){if(L=t[m],p=o(L,m),u=c.get(p),u===void 0){var C=l?l.e.nodes_start:r;f=_e(C,e,f,f===null?e.first:f.next,L,p,m,a,n,s),c.set(p,f),h=[],d=[],l=f.next;continue}if(Ze(u,L,m),(u.e.f&j)!==0&&de(u.e),u!==l){if(k!==void 0&&k.has(u)){if(h.length<d.length){var g=d[0],_;f=g.prev;var N=h[0],y=h[h.length-1];for(_=0;_<h.length;_+=1)ce(h[_],g,r);for(_=0;_<d.length;_+=1)k.delete(d[_]);B(e,N.prev,y.next),B(e,f,N),B(e,y,g),l=g,f=y,m-=1,h=[],d=[]}else k.delete(u),ce(u,l,r),B(e,u.prev,u.next),B(e,u,f===null?e.first:f.next),B(e,f,u),f=u;continue}for(h=[],d=[];l!==null&&l.k!==p;)(l.e.f&j)===0&&(k??(k=new Set)).add(l),d.push(l),l=l.next;if(l===null)continue;u=l}h.push(u),f=u,l=u.next}if(l!==null||k!==void 0){for(var x=k===void 0?[]:ke(k);l!==null;)(l.e.f&j)===0&&x.push(l),l=l.next;var T=x.length;if(T>0){var H=i===0?r:null;qe(e,x,H,c)}}ne.first=e.first&&e.first.e,ne.last=f&&f.e}function Ze(t,e,r,a){xe(t.v,e),t.i=r}function _e(t,e,r,a,n,o,s,i,c,v){var l=(c&Oe)!==0,k=(c&Te)===0,f=l?k?W(n):se(n):n,h=(c&Ce)===0?s:se(s),d={i:h,v:f,k:o,a:null,e:null,prev:r,next:a};try{return d.e=he(()=>i(t,f,h,v),S),d.e.prev=r&&r.e,d.e.next=a&&a.e,r===null?e.first=d:(r.next=d,r.e.next=d.e),a!==null&&(a.prev=d,a.e.prev=d.e),d}finally{}}function ce(t,e,r){for(var a=t.next?t.next.e.nodes_start:r,n=e?e.e.nodes_start:r,o=t.e.nodes_start;o!==a;){var s=Me(o);n.before(o),o=s}}function B(t,e,r){e===null?t.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}const ve=[...` 	
\r\fÂ \v\uFEFF`];function Xe(t,e,r){var a=""+t;if(r){for(var n in r)if(r[n])a=a?a+" "+n:n;else if(a.length)for(var o=n.length,s=0;(s=a.indexOf(n,s))>=0;){var i=s+o;(s===0||ve.includes(a[s-1]))&&(i===a.length||ve.includes(a[i]))?a=(s===0?"":a.substring(0,s))+a.substring(i+1):s=i}}return a===""?null:a}function er(t,e,r,a,n,o){var s=t.__className;if(S||s!==r||s===void 0){var i=Xe(r,a,o);(!S||i!==t.getAttribute("class"))&&(i==null?t.removeAttribute("class"):t.className=i),t.__className=r}else if(o&&n!==o)for(var c in o){var v=!!o[c];(n==null||v!==!!n[c])&&t.classList.toggle(c,v)}return o}const rr=Symbol("is custom element"),tr=Symbol("is html");function P(t,e,r,a){var n=ar(t);S&&(n[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||n[e]!==(n[e]=r)&&(e==="loading"&&(t[Pe]=r),r==null?t.removeAttribute(e):typeof r!="string"&&nr(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function ar(t){return t.__attributes??(t.__attributes={[rr]:t.nodeName.includes("-"),[tr]:t.namespaceURI===Ue})}var fe=new Map;function nr(t){var e=fe.get(t.nodeName);if(e)return e;fe.set(t.nodeName,e=[]);for(var r,a=t,n=Element.prototype;n!==a;){r=De(a);for(var o in r)r[o].set&&e.push(o);a=ze(a)}return e}function pe(t,e,r){if(t.multiple)return ir(t,e);for(var a of t.options){var n=F(a);if(He(n,e)){a.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function sr(t,e){ge(()=>{var r=new MutationObserver(()=>{var a=t.__value;pe(t,a)});return r.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function or(t,e,r=e){var a=!0;Ge(t,"change",n=>{var o=n?"[selected]":":checked",s;if(t.multiple)s=[].map.call(t.querySelectorAll(o),F);else{var i=t.querySelector(o)??t.querySelector("option:not([disabled])");s=i&&F(i)}r(s)}),ge(()=>{var n=e();if(pe(t,n,a),a&&n===void 0){var o=t.querySelector(":checked");o!==null&&(n=F(o),r(n))}t.__value=n,a=!1}),sr(t)}function ir(t,e){for(var r of t.options)r.selected=~e.indexOf(F(r))}function F(t){return"__value"in t?t.__value:t.value}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",be={faviconSize:24,faviconFetchServiceURL:t=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${t}&size=${be.faviconSize}`};async function lr(){const e="/bk"+"/bookmarks";try{const r=await fetch(e+"/index.json");if(r){const a=await r.json();if(Array.isArray(a)?a.length>0:!1){const s=a.sort().map(i=>fetch(e+"/"+i+".json").then(c=>c.json()).then(c=>(c.bookmarkIndexName=i,c)));return await Promise.all(s)}}}catch(r){console.error("bookmarks folder or bookmarks/index.json not found. Error:",r)}}async function cr(t){const e={};if(Array.isArray(t)?t.length>0:!1)for(let a=0;a<t.length;a++){const n=t[a],o=n.LINK,s=n.ICON;let i="";if(s)i=s;else if(o){const c=new URL(o),v=c.protocol+"//"+c.hostname;i=be.faviconFetchServiceURL(v)}else i=me;n.bookmarkIndexName&&(e[n.bookmarkIndexName]=i)}return e}var vr=w('<div class="bk-title svelte-1lplrkt"> </div>'),fr=w('<div class="bk-desc svelte-1lplrkt"> </div>'),ur=w('<a class="bk svelte-1lplrkt" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1lplrkt"><div class="bk-icon svelte-1lplrkt"><img alt="icon" width="100%" height="100%" loading="lazy"></div> <div class="bk-meta-info svelte-1lplrkt"><div class="bk-name svelte-1lplrkt"> </div> <div class="bk-link svelte-1lplrkt"> </div></div></div> <!> <!></a>');function dr(t,e){ee(e,!1);let r=le(e,"bookmark",8),a=le(e,"faviconLink",8);const n=r().LINK||"javascript:void(0)";let o=r().NAME||r().LINK;function s(g){const _=g==null?void 0:g.target;_&&(_.src=me)}X();var i=ur();P(i,"href",n),P(i,"title",o);var c=A(i),v=A(c),l=A(v);b(v);var k=E(v,2),f=A(k),h=A(f,!0);b(f);var d=E(f,2),L=A(d,!0);b(d),b(k),b(c);var p=E(c,2);{var u=g=>{var _=vr(),N=A(_,!0);b(_),O(()=>$(N,r().TITLE)),I(g,_)};R(p,g=>{r().TITLE&&g(u)})}var m=E(p,2);{var C=g=>{var _=fr(),N=A(_,!0);b(_),O(()=>$(N,r().DESC)),I(g,_)};R(m,g=>{r().DESC&&g(C)})}b(i),O(()=>{P(i,"data-bookmark-icon",r().ICON),P(l,"src",a()),$(h,r().NAME),$(L,r().LINK)}),Q("error",l,s),I(t,i),re()}var hr=w('<div class="bookmark-container svelte-1k3hbth" id="bookmark-container"></div>');function kr(t,e){ee(e,!1);let r=W([]),a=W({});async function n(){const s=await lr();s&&oe(r,s)}je(async()=>{await n();const s=await cr(V(r));s&&oe(a,s)}),X();var o=hr();We(o,5,()=>V(r),Ke,(s,i)=>{var c=Ae(),v=U(c);{var l=k=>{dr(k,{get bookmark(){return V(i)},get faviconLink(){return V(a)[V(i).bookmarkIndexName]}})};R(v,k=>{V(i).bookmarkIndexName&&k(l)})}I(s,c)}),b(o),I(t,o),re()}const Z=D("home"),G=D(null),K=D(null);var gr=w('<div class="header svelte-1btxz3n"><a class="brand svelte-1btxz3n" href="https://m9j.github.io/bookmarks"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function _r(t){const[e,r]=te(),a=()=>z(Z,"$selectedPage",e);var n=gr(),o=A(n);o.textContent="BOOKMARKS";var s=E(o,2);O(()=>{a(),Ye(()=>{})});var i=A(s);i.value=i.__value="home";var c=E(i);c.value=c.__value="settings",b(s),b(n),or(s,a,v=>Je(Z,v)),I(t,n),r()}function pr(){navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(e=>e.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(e=>Promise.all(e.map(r=>caches.delete(r)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function ue(t){if(t){const e=new Date(Number(t)),r=String(e.getFullYear()),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),o=e.getHours()*3600+e.getMinutes()*60+e.getSeconds(),s=String(o).padStart(5,"0");return`${r}.${a}${n}.${s}`}}async function mr(){const e="/bk"+"/version.json";try{const r=await fetch(e);if(!r.ok)console.log(new Error("Failed to fetch current version"));else return(await r.json()).version}catch(r){console.error("Current version check failed: ",r)}}async function br(){const t="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const e=await fetch(t,{cache:"no-store"});if(!e.ok)console.log(new Error("Failed to fetch latest version"));else{const r=await e.json();return JSON.parse(atob(r.content)).version}}catch(e){console.error("Latest version check failed: ",e)}}var Ar=w(" <br>",1),Nr=w("<span> </span><br>",1),Er=w("<div>Versions:<br> <!> <!></div>"),Ir=w('<div class="settings-container hide svelte-18fnlk3" id="settings-container"><div class="columns svelte-18fnlk3"><!></div> <div class="rows svelte-18fnlk3"><button class="settings-button svelte-18fnlk3">Check for latest version</button> <button class="settings-button svelte-18fnlk3">Hard reload application</button></div></div>');function Lr(t,e){ee(e,!1);const[r,a]=te(),n=()=>z(G,"$currentVersion",r),o=()=>z(K,"$latestVersion",r);i();const s=D(!1);async function i(){const p=await mr();G.update(u=>p)}async function c(){const p=await br();K.update(u=>p),s.update(u=>Number(K)>Number(G))}X();var v=Ir(),l=A(v),k=A(l);{var f=p=>{var u=Er(),m=E(A(u),3);{var C=N=>{var y=Ar(),x=U(y);ie(),O(T=>$(x,`${T??""} [CURRENT] `),[()=>ue(n())],q),I(N,y)};R(m,N=>{n()&&N(C)})}var g=E(m,2);{var _=N=>{var y=Nr(),x=U(y);er(x,1,"svelte-18fnlk3",null,{},{"is-new":s});var T=A(x);b(x),ie(),O(H=>$(T,`${H??""} [LATEST]`),[()=>ue(o())],q),I(N,y)};R(g,N=>{o()&&N(_)})}b(u),I(p,u)};R(k,p=>{(n()||o())&&p(f)})}b(l);var h=E(l,2),d=A(h),L=E(d,2);b(h),b(v),Q("click",d,()=>c()),Q("click",L,()=>pr()),I(t,v),re(),a()}var Sr=w("<!> <!> <!>",1);function Rr(t){const[e,r]=te(),a=()=>z(Z,"$selectedPage",e);var n=Sr(),o=U(n);kr(o,{});var s=E(o,2);_r(s);var i=E(s,2);{var c=v=>{Lr(v,{})};R(i,v=>{a()==="settings"&&v(c)})}I(t,n),r()}export{Rr as component};
