import{t as L,a as I,c as we}from"../chunks/Ch8OM0rz.js";import"../chunks/ChshRU8A.js";import{ai as Ie,v as Le,y as J,h as S,a9 as ye,l as xe,f as B,Q as W,w as Se,x as ne,z as q,D as P,ac as Ce,A as he,B as ke,C as Ve,at as G,ag as ge,a5 as se,au as Be,G as Q,av as oe,aw as $e,ax as Re,af as Oe,ay as Te,az as Fe,aA as Pe,aB as Ue,aa as ze,a6 as Me,an as be,aC as De,p as ee,o as p,q as _,s as N,t as F,n as ae,K as ie,m as D,aD as He,aE as le}from"../chunks/BARSMQnY.js";import{p as ce,i as R,s as z,a as re,b as Ye}from"../chunks/BEGXO0ep.js";import{i as te}from"../chunks/BUGv2RUA.js";import{o as Je,w as H,g as ve}from"../chunks/Bel0n3e7.js";import{l as qe,s as T,e as Z}from"../chunks/DWFtwJbO.js";import{s as U}from"../chunks/D70-fji-.js";function Ge(r,a){return a}function Ke(r,a,e,t){for(var o=[],i=a.length,s=0;s<i;s++)Re(a[s].e,o,!0);var n=i>0&&o.length===0&&e!==null;if(n){var c=e.parentNode;Oe(c),c.append(e),t.clear(),$(r,a[0].prev,a[i-1].next)}Te(o,()=>{for(var f=0;f<i;f++){var l=a[f];n||(t.delete(l.k),$(r,l.prev,l.next)),Fe(l.e,!n)}})}function je(r,a,e,t,o,i=null){var s=r,n={flags:a,items:new Map,first:null};{var c=r;s=S?J(ye(c)):c.appendChild(Ie())}S&&xe();var f=null,l=!1,g=W(()=>{var v=e();return Me(v)?v:v==null?[]:ge(v)});Le(()=>{var v=B(g),h=v.length;if(l&&h===0)return;l=h===0;let d=!1;if(S){var E=s.data===Se;E!==(h===0)&&(s=ne(),J(s),q(!1),d=!0)}if(S){for(var A=null,u,k=0;k<h;k++){if(P.nodeType===8&&P.data===Ce){s=P,d=!0,q(!1);break}var y=v[k],b=t(y,k);u=me(P,n,A,null,y,b,k,o,a,e),n.items.set(b,u),A=u}h>0&&J(ne())}S||We(v,n,s,o,a,t,e),i!==null&&(h===0?f?he(f):f=ke(()=>i(s)):f!==null&&Ve(f,()=>{f=null})),d&&q(!0),B(g)}),S&&(s=P)}function We(r,a,e,t,o,i,s){var n=r.length,c=a.items,f=a.first,l=f,g,v=null,h=[],d=[],E,A,u,k;for(k=0;k<n;k+=1){if(E=r[k],A=i(E,k),u=c.get(A),u===void 0){var y=l?l.e.nodes_start:e;v=me(y,a,v,v===null?a.first:v.next,E,A,k,t,o,s),c.set(A,v),h=[],d=[],l=v.next;continue}if(Qe(u,E,k),(u.e.f&G)!==0&&he(u.e),u!==l){if(g!==void 0&&g.has(u)){if(h.length<d.length){var b=d[0],m;v=b.prev;var C=h[0],w=h[h.length-1];for(m=0;m<h.length;m+=1)fe(h[m],b,e);for(m=0;m<d.length;m+=1)g.delete(d[m]);$(a,C.prev,w.next),$(a,v,C),$(a,w,b),l=b,v=w,k-=1,h=[],d=[]}else g.delete(u),fe(u,l,e),$(a,u.prev,u.next),$(a,u,v===null?a.first:v.next),$(a,v,u),v=u;continue}for(h=[],d=[];l!==null&&l.k!==A;)(l.e.f&G)===0&&(g??(g=new Set)).add(l),d.push(l),l=l.next;if(l===null)continue;u=l}h.push(u),v=u,l=u.next}if(l!==null||g!==void 0){for(var x=g===void 0?[]:ge(g);l!==null;)(l.e.f&G)===0&&x.push(l),l=l.next;var V=x.length;if(V>0){var O=n===0?e:null;Ke(a,x,O,c)}}se.first=a.first&&a.first.e,se.last=v&&v.e}function Qe(r,a,e,t){Be(r.v,a),r.i=e}function me(r,a,e,t,o,i,s,n,c,f){var l=(c&Pe)!==0,g=(c&Ue)===0,v=l?g?Q(o):oe(o):o,h=(c&$e)===0?s:oe(s),d={i:h,v,k:i,a:null,e:null,prev:e,next:t};try{return d.e=ke(()=>n(r,v,h,f),S),d.e.prev=e&&e.e,d.e.next=t&&t.e,e===null?a.first=d:(e.next=d,e.e.next=d.e),t!==null&&(t.prev=d,t.e.prev=d.e),d}finally{}}function fe(r,a,e){for(var t=r.next?r.next.e.nodes_start:e,o=a?a.e.nodes_start:e,i=r.e.nodes_start;i!==t;){var s=ze(i);o.before(i),i=s}}function $(r,a,e){a===null?r.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const ue=[...` 	
\r\fÂ \v\uFEFF`];function Ze(r,a,e){var t=""+r;if(e){for(var o in e)if(e[o])t=t?t+" "+o:o;else if(t.length)for(var i=o.length,s=0;(s=t.indexOf(o,s))>=0;){var n=s+i;(s===0||ue.includes(t[s-1]))&&(n===t.length||ue.includes(t[n]))?t=(s===0?"":t.substring(0,s))+t.substring(n+1):s=n}}return t===""?null:t}function Xe(r,a,e,t,o,i){var s=r.__className;if(S||s!==e||s===void 0){var n=Ze(e,t,i);(!S||n!==r.getAttribute("class"))&&(n==null?r.removeAttribute("class"):r.className=n),r.__className=e}else if(i&&o!==i)for(var c in i){var f=!!i[c];(o==null||f!==!!o[c])&&r.classList.toggle(c,f)}return i}function _e(r,a,e){if(r.multiple)return ra(r,a);for(var t of r.options){var o=M(t);if(De(o,a)){t.selected=!0;return}}(!e||a!==void 0)&&(r.selectedIndex=-1)}function ea(r,a){be(()=>{var e=new MutationObserver(()=>{var t=r.__value;_e(r,t)});return e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function aa(r,a,e=a){var t=!0;qe(r,"change",o=>{var i=o?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(i),M);else{var n=r.querySelector(i)??r.querySelector("option:not([disabled])");s=n&&M(n)}e(s)}),be(()=>{var o=a();if(_e(r,o,t),t&&o===void 0){var i=r.querySelector(":checked");i!==null&&(o=M(i),e(o))}r.__value=o,t=!1}),ea(r)}function ra(r,a){for(var e of r.options)e.selected=~a.indexOf(M(e))}function M(r){return"__value"in r?r.__value:r.value}const pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ae={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${Ae.faviconSize}`};async function ta(){const a="/bk"+"/bookmarks";try{const e=await fetch(a+"/index.json");if(e){const t=await e.json();if(Array.isArray(t)?t.length>0:!1){const s=t.sort().map(n=>fetch(a+"/"+n+".json").then(c=>c.json()).then(c=>(c.bookmarkIndexName=n,c)));return await Promise.all(s)}}}catch(e){console.error("bookmarks folder or bookmarks/index.json not found. Error:",e)}}async function na(r){const a={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const o=r[t],i=o.LINK,s=o.ICON;let n="";if(s)n=s;else if(i){const c=new URL(i),f=c.protocol+"//"+c.hostname;n=Ae.faviconFetchServiceURL(f)}else n=pe;o.bookmarkIndexName&&(a[o.bookmarkIndexName]=n)}return a}var sa=L('<div class="bk-title svelte-rbrhkd"> </div>'),oa=L('<div class="bk-desc svelte-rbrhkd"> </div>'),ia=L('<a class="bk svelte-rbrhkd" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-rbrhkd"><div class="bk-icon svelte-rbrhkd"><img class="bk-icon-img svelte-rbrhkd" alt="icon" width="100%" height="100%" loading="lazy"></div> <div class="bk-meta-info svelte-rbrhkd"><div class="bk-name svelte-rbrhkd"> </div> <div class="bk-link svelte-rbrhkd"> </div></div></div> <!> <!></a>');function la(r,a){ee(a,!1);let e=ce(a,"bookmark",8),t=ce(a,"faviconLink",8);const o=e().LINK||"javascript:void(0)";let i=e().NAME||e().LINK;function s(b){const m=b==null?void 0:b.target;m&&(m.src=pe)}te();var n=ia();U(n,"href",o),U(n,"title",i);var c=p(n),f=p(c),l=p(f);_(f);var g=N(f,2),v=p(g),h=p(v,!0);_(v);var d=N(v,2),E=p(d,!0);_(d),_(g),_(c);var A=N(c,2);{var u=b=>{var m=sa(),C=p(m,!0);_(m),F(()=>T(C,e().TITLE)),I(b,m)};R(A,b=>{e().TITLE&&b(u)})}var k=N(A,2);{var y=b=>{var m=oa(),C=p(m,!0);_(m),F(()=>T(C,e().DESC)),I(b,m)};R(k,b=>{e().DESC&&b(y)})}_(n),F(()=>{U(n,"data-bookmark-icon",e().ICON),U(l,"src",t()),T(h,e().NAME),T(E,e().LINK)}),Z("error",l,s),I(r,n),ae()}var ca=L('<div class="bk-wrapper svelte-bnesaq"><div class="bk-container svelte-bnesaq"></div></div>');function va(r,a){ee(a,!1);let e=Q([]),t=Q({});async function o(){const n=await ta();n&&ie(e,n)}Je(async()=>{await o();const n=await na(B(e));n&&ie(t,n)}),te();var i=ca(),s=p(i);je(s,5,()=>B(e),Ge,(n,c)=>{var f=we(),l=D(f);{var g=v=>{la(v,{get bookmark(){return B(c)},get faviconLink(){return B(t)[B(c).bookmarkIndexName]}})};R(l,v=>{B(c).bookmarkIndexName&&v(g)})}I(n,f)}),_(s),_(i),I(r,i),ae()}const X=H("home"),K=H(null),j=H(null);var fa=L('<div class="header svelte-1btxz3n"><a class="brand svelte-1btxz3n"></a> <select class="view-list" id="view-list"><option>Home</option><option>Settings</option></select></div>');function ua(r){const[a,e]=re(),t=()=>z(X,"$selectedPage",a),o="https://m9j.github.io/bk";var i=fa(),s=p(i);U(s,"href",o),s.textContent="BOOKMARKS";var n=N(s,2);F(()=>{t(),He(()=>{})});var c=p(n);c.value=c.__value="home";var f=N(c);f.value=f.__value="settings",_(n),_(i),aa(n,t,l=>Ye(X,l)),I(r,i),e()}function da(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(a=>a.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(a=>Promise.all(a.map(e=>caches.delete(e)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function de(r){if(r){const a=new Date(Number(r)),e=String(a.getFullYear()),t=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0"),i=a.getHours()*3600+a.getMinutes()*60+a.getSeconds(),s=String(i).padStart(5,"0");return`${e}.${t}${o}.${s}`}}async function ha(){const a="/bk"+"/version.json";try{const e=await fetch(a);if(!e.ok)console.log(new Error("Failed to fetch current version"));else return(await e.json()).version}catch(e){console.error("Current version check failed: ",e)}}async function ka(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const a=await fetch(r,{cache:"no-store"});if(!a.ok)console.log(new Error("Failed to fetch latest version"));else{const e=await a.json();return JSON.parse(atob(e.content)).version}}catch(a){console.error("Latest version check failed: ",a)}}var ga=L('<span class="monospace svelte-lc56ie"> </span> <br>',1),ba=L("<span> </span><br>",1),ma=L("<div>Versions:<br> <!> <!></div>"),_a=L('<div class="settings-container hide svelte-lc56ie" id="settings-container"><div class="columns svelte-lc56ie"><!></div> <div class="rows svelte-lc56ie"><button class="settings-button svelte-lc56ie">Check for latest version</button> <button class="settings-button svelte-lc56ie">Hard reload application</button></div></div>');function pa(r,a){ee(a,!1);const[e,t]=re(),o=()=>z(K,"$currentVersion",e),i=()=>z(j,"$latestVersion",e),s=()=>z(n,"$isNew",e),n=H(!1);(async()=>(await c(),await f()))();async function c(){const u=await ha();K.update(k=>u)}async function f(){const u=await ka();j.update(k=>u),n.update(k=>Number(ve(j))>Number(ve(K)))}te();var l=_a(),g=p(l),v=p(g);{var h=u=>{var k=ma(),y=N(p(k),3);{var b=w=>{var x=ga(),V=D(x),O=p(V);_(V),le(2),F(Y=>T(O,`${Y??""} [CURRENT]`),[()=>de(o())],W),I(w,x)};R(y,w=>{o()&&w(b)})}var m=N(y,2);{var C=w=>{var x=ba(),V=D(x);let O;var Y=p(V);_(V),le(),F((Ne,Ee)=>{O=Xe(V,1,"monospace svelte-lc56ie",null,O,Ne),T(Y,`${Ee??""} [LATEST]`)},[()=>({"is-new":s()}),()=>de(i())],W),I(w,x)};R(m,w=>{i()&&w(C)})}_(k),I(u,k)};R(v,u=>{(o()||i())&&u(h)})}_(g);var d=N(g,2),E=p(d),A=N(E,2);_(d),_(l),Z("click",E,()=>f()),Z("click",A,()=>da()),I(r,l),ae(),t()}var Aa=L("<!> <!> <!>",1);function Ca(r){const[a,e]=re(),t=()=>z(X,"$selectedPage",a);var o=Aa(),i=D(o);va(i,{});var s=N(i,2);ua(s);var n=N(s,2);{var c=f=>{pa(f,{})};R(n,f=>{t()==="settings"&&f(c)})}I(r,o),e()}export{Ca as component};
