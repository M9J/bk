import{t as E,a as y,c as re}from"../chunks/CyOrqUXm.js";import{i as Y}from"../chunks/CL0QEqD9.js";import{A as W,l as $,a0 as $e,$ as Be,x as Ce,i as Re,g as x,N as te,y as Ve,z as ve,B as Q,m as T,ad as Me,C as ke,j as be,D as Oe,ah as Ae,a8 as Pe,F as z,ap as ce,aq as Z,a2 as de,ar as Fe,as as Te,at as je,ag as ze,au as De,k as Ue,av as He,aw as Ye,ab as Je,ax as Ge,ay as Ke,az as qe,aA as We,aj as Ne,aB as Qe,p as J,s as _,v as p,w as I,t as V,q as G,J as H,o as F,aC as Ze,aD as X}from"../chunks/DZpqQ712.js";import{p as fe,i as w,s as D,a as le,b as Xe}from"../chunks/B8VvTqyC.js";import{o as xe,w as K,g as ue}from"../chunks/HU1d89I3.js";import{l as ea,e as se,s as M}from"../chunks/DUnFqAGD.js";function ne(r,a){return a}function aa(r,a,e,t){for(var s=[],i=a.length,n=0;n<i;n++)je(a[n].e,s,!0);var o=i>0&&s.length===0&&e!==null;if(o){var f=e.parentNode;ze(f),f.append(e),t.clear(),R(r,a[0].prev,a[i-1].next)}De(s,()=>{for(var d=0;d<i;d++){var v=a[d];o||(t.delete(v.k),R(r,v.prev,v.next)),Ue(v.e,!o)}})}function oe(r,a,e,t,s,i=null){var n=r,o={flags:a,items:new Map,first:null};{var f=r;n=$?W($e(f)):f.appendChild(Be())}$&&Ce();var d=null,v=!1,m=te(()=>{var g=e();return Pe(g)?g:g==null?[]:Ae(g)});Re(()=>{var g=x(m),c=g.length;if(v&&c===0)return;v=c===0;let u=!1;if($){var b=n.data===Ve;b!==(c===0)&&(n=ve(),W(n),Q(!1),u=!0)}if($){for(var k=null,l,h=0;h<c;h++){if(T.nodeType===8&&T.data===Me){n=T,u=!0,Q(!1);break}var A=g[h],N=t(A,h);l=ye(T,o,k,null,A,N,h,s,a,e),o.items.set(N,l),k=l}c>0&&W(ve())}$||ra(g,o,n,s,a,t,e),i!==null&&(c===0?d?ke(d):d=be(()=>i(n)):d!==null&&Oe(d,()=>{d=null})),u&&Q(!0),x(m)}),$&&(n=T)}function ra(r,a,e,t,s,i,n){var o=r.length,f=a.items,d=a.first,v=d,m,g=null,c=[],u=[],b,k,l,h;for(h=0;h<o;h+=1){if(b=r[h],k=i(b,h),l=f.get(k),l===void 0){var A=v?v.e.nodes_start:e;g=ye(A,a,g,g===null?a.first:g.next,b,k,h,t,s,n),f.set(k,g),c=[],u=[],v=g.next;continue}if(ta(l,b,h),(l.e.f&Z)!==0&&ke(l.e),l!==v){if(m!==void 0&&m.has(l)){if(c.length<u.length){var N=u[0],L;g=N.prev;var O=c[0],S=c[c.length-1];for(L=0;L<c.length;L+=1)he(c[L],N,e);for(L=0;L<u.length;L+=1)m.delete(u[L]);R(a,O.prev,S.next),R(a,g,O),R(a,S,N),v=N,g=S,h-=1,c=[],u=[]}else m.delete(l),he(l,v,e),R(a,l.prev,l.next),R(a,l,g===null?a.first:g.next),R(a,g,l),g=l;continue}for(c=[],u=[];v!==null&&v.k!==k;)(v.e.f&Z)===0&&(m??(m=new Set)).add(v),u.push(v),v=v.next;if(v===null)continue;l=v}c.push(l),g=l,v=l.next}if(v!==null||m!==void 0){for(var B=m===void 0?[]:Ae(m);v!==null;)(v.e.f&Z)===0&&B.push(v),v=v.next;var C=B.length;if(C>0){var P=o===0?e:null;aa(a,B,P,f)}}de.first=a.first&&a.first.e,de.last=g&&g.e}function ta(r,a,e,t){Te(r.v,a),r.i=e}function ye(r,a,e,t,s,i,n,o,f,d){var v=(f&He)!==0,m=(f&Ye)===0,g=v?m?z(s):ce(s):s,c=(f&Fe)===0?n:ce(n),u={i:c,v:g,k:i,a:null,e:null,prev:e,next:t};try{return u.e=be(()=>o(r,g,c,d),$),u.e.prev=e&&e.e,u.e.next=t&&t.e,e===null?a.first=u:(e.next=u,e.e.next=u.e),t!==null&&(t.prev=u,t.e.prev=u.e),u}finally{}}function he(r,a,e){for(var t=r.next?r.next.e.nodes_start:e,s=a?a.e.nodes_start:e,i=r.e.nodes_start;i!==t;){var n=Je(i);s.before(i),i=n}}function R(r,a,e){a===null?r.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const ge=[...` 	
\r\fÂ \v\uFEFF`];function sa(r,a,e){var t=""+r;if(e){for(var s in e)if(e[s])t=t?t+" "+s:s;else if(t.length)for(var i=s.length,n=0;(n=t.indexOf(s,n))>=0;){var o=n+i;(n===0||ge.includes(t[n-1]))&&(o===t.length||ge.includes(t[o]))?t=(n===0?"":t.substring(0,n))+t.substring(o+1):n=o}}return t===""?null:t}function na(r,a,e,t,s,i){var n=r.__className;if($||n!==e||n===void 0){var o=sa(e,t,i);(!$||o!==r.getAttribute("class"))&&(o==null?r.removeAttribute("class"):r.className=o),r.__className=e}else if(i&&s!==i)for(var f in i){var d=!!i[f];(s==null||d!==!!s[f])&&r.classList.toggle(f,d)}return i}const oa=Symbol("is custom element"),ia=Symbol("is html");function j(r,a,e,t){var s=la(r);$&&(s[a]=r.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&r.nodeName==="LINK")||s[a]!==(s[a]=e)&&(a==="loading"&&(r[Ke]=e),e==null?r.removeAttribute(a):typeof e!="string"&&va(r).includes(a)?r[a]=e:r.setAttribute(a,e))}function la(r){return r.__attributes??(r.__attributes={[oa]:r.nodeName.includes("-"),[ia]:r.namespaceURI===Ge})}var me=new Map;function va(r){var a=me.get(r.nodeName);if(a)return a;me.set(r.nodeName,a=[]);for(var e,t=r,s=Element.prototype;s!==t;){e=We(t);for(var i in e)e[i].set&&a.push(i);t=qe(t)}return a}function Ie(r,a,e){if(r.multiple)return fa(r,a);for(var t of r.options){var s=U(t);if(Qe(s,a)){t.selected=!0;return}}(!e||a!==void 0)&&(r.selectedIndex=-1)}function ca(r,a){Ne(()=>{var e=new MutationObserver(()=>{var t=r.__value;Ie(r,t)});return e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function da(r,a,e=a){var t=!0;ea(r,"change",s=>{var i=s?"[selected]":":checked",n;if(r.multiple)n=[].map.call(r.querySelectorAll(i),U);else{var o=r.querySelector(i)??r.querySelector("option:not([disabled])");n=o&&U(o)}e(n)}),Ne(()=>{var s=a();if(Ie(r,s,t),t&&s===void 0){var i=r.querySelector(":checked");i!==null&&(s=U(i),e(s))}r.__value=s,t=!1}),ca(r)}function fa(r,a){for(var e of r.options)e.selected=~a.indexOf(U(e))}function U(r){return"__value"in r?r.__value:r.value}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Le={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${Le.faviconSize}`};async function ua(){const a="/bk"+"/bookmarks";try{const e=await fetch(a+"/index.json");if(e){const t=await e.json();if(Array.isArray(t)?t.length>0:!1){const n=t.sort().map(o=>fetch(a+"/"+o+".json").then(f=>f.json()).then(f=>(f.bookmarkIndexName=o,f)));return await Promise.all(n)}}}catch(e){console.error("bookmarks folder or bookmarks/index.json not found. Error:",e)}}async function ha(r){const a={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const s=r[t],i=s.LINK,n=s.ICON;let o="";if(n)o=n;else if(i){const f=new URL(i),d=f.protocol+"//"+f.hostname;o=Le.faviconFetchServiceURL(d)}else o=Ee;s.bookmarkIndexName&&(a[s.bookmarkIndexName]=o)}return a}var ga=E('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),ma=E('<div class="bk-title svelte-1jzx7ns"> </div>'),pa=E('<div class="bk-desc svelte-1jzx7ns"> </div>'),_a=E('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function pe(r,a){J(a,!1);let e=fe(a,"bookmark",8),t=fe(a,"faviconLink",8);const s=e().LINK||"javascript:void(0)";let i=e().NAME||e().LINK;function n(l){const h=l==null?void 0:l.target;h&&(h.src=Ee)}Y();var o=_a();j(o,"href",s),j(o,"title",i);var f=_(o),d=_(f),v=_(d);p(d);var m=I(d,2);{var g=l=>{var h=ga(),A=_(h),N=_(A,!0);p(A);var L=I(A,2),O=_(L,!0);p(L),p(h),V(()=>{M(N,e().NAME),M(O,e().LINK)}),y(l,h)};w(m,l=>{e().IS_PINNED||l(g)})}p(f);var c=I(f,2);{var u=l=>{var h=ma(),A=_(h,!0);p(h),V(()=>M(A,e().TITLE)),y(l,h)};w(c,l=>{e().TITLE&&l(u)})}var b=I(c,2);{var k=l=>{var h=pa(),A=_(h,!0);p(h),V(()=>M(A,e().DESC)),y(l,h)};w(b,l=>{e().DESC&&l(k)})}p(o),V(()=>{j(o,"data-bookmark-icon",e().ICON),j(v,"src",t())}),se("error",v,n),y(r,o),G()}var ka=E('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),ba=E('<div class="bk-container-grid svelte-1uu4y0a"></div>'),Aa=E('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Na(r,a){J(a,!1);let e=[],t=z([]),s=z([]),i=z({});async function n(){const c=await ua();c&&(e=c.sort((b,k)=>b.NAME.localeCompare(k.NAME)),H(t,e.filter(b=>b.IS_PINNED)),H(s,e.filter(b=>!b.IS_PINNED)))}xe(async()=>{await n();const c=await ha(e);c&&H(i,c)}),Y();var o=Aa(),f=_(o),d=_(f);{var v=c=>{var u=ka();oe(u,5,()=>x(t),ne,(b,k)=>{var l=re(),h=F(l);{var A=N=>{pe(N,{get bookmark(){return x(k)},get faviconLink(){return x(i)[x(k).bookmarkIndexName]}})};w(h,N=>{x(k).bookmarkIndexName&&N(A)})}y(b,l)}),p(u),y(c,u)};w(d,c=>{x(t).length>0&&c(v)})}var m=I(d,2);{var g=c=>{var u=ba();oe(u,5,()=>x(s),ne,(b,k)=>{var l=re(),h=F(l);{var A=N=>{pe(N,{get bookmark(){return x(k)},get faviconLink(){return x(i)[x(k).bookmarkIndexName]}})};w(h,N=>{x(k).bookmarkIndexName&&N(A)})}y(b,l)}),p(u),y(c,u)};w(m,c=>{x(s).length>0&&c(g)})}p(f),p(o),y(r,o),G()}const ie=K("home"),ee=K(null),ae=K(null);var xa=E('<hr class="separator svelte-obx2py">'),ya=E('<div class="header svelte-obx2py"><a class="brand svelte-obx2py"></a> <select class="view-list svelte-obx2py" id="view-list"><option>Home</option><option>Settings</option></select></div> <!>',1);function Ia(r){const[a,e]=le(),t=()=>D(ie,"$selectedPage",a),s="https://m9j.github.io/bk";var i=ya(),n=F(i),o=_(n);j(o,"href",s),o.textContent="BOOKMARKS";var f=I(o,2);V(()=>{t(),Ze(()=>{})});var d=_(f);d.value=d.__value="home";var v=I(d);v.value=v.__value="settings",p(f),p(n);var m=I(n,2);{var g=c=>{var u=xa();y(c,u)};w(m,c=>{t()!=="home"&&c(g)})}da(f,t,c=>Xe(ie,c)),y(r,i),e()}async function Ea(){const a="/bk"+"/lambdas";try{const e=await fetch(a+"/index.json");if(e){const t=await e.json();if(Array.isArray(t)?t.length>0:!1){const i=t.map(n=>import(a+"/"+n+".lambda.js"));return await Promise.all(i)}}}catch(e){console.error("lambdas folder or lambdas/index.json not found. Error:",e)}}var La=E('<div class="lambda svelte-vmgkgn"><div class="lambda-title"> <span class="lambda-result"> </span></div></div>'),wa=E('<div class="lambdas-container svelte-vmgkgn"></div>');function Sa(r,a){J(a,!1);let e=z([]);xe(async()=>{const n=await Ea();if(n){const o=n.map(d=>d.default);(Array.isArray(o)?o.length>0:!1)&&(H(e,o),x(e).forEach(d=>{!d.result&&d.action&&typeof d.action=="function"&&(d.result=d.action())}))}}),Y();var t=re(),s=F(t);{var i=n=>{var o=wa();oe(o,5,()=>x(e),ne,(f,d)=>{var v=La(),m=_(v),g=_(m),c=I(g),u=_(c,!0);p(c),p(m),p(v),V(()=>{M(g,`${x(d).prompt??""}: `),M(u,x(d).result)}),y(f,v)}),p(o),y(n,o)};w(s,n=>{x(e).length>0&&n(i)})}y(r,t),G()}function $a(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(a=>a.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(a=>Promise.all(a.map(e=>caches.delete(e)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(r){if(r){const a=new Date(Number(r)),e=String(a.getFullYear()),t=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0"),n=String(a.getMinutes()).padStart(2,"0"),o=String(a.getSeconds()).padStart(2,"0");return`${e}.${t}${s}.${i}${n}${o}`}}async function Ba(){const a="/bk"+"/version.json";try{const e=await fetch(a);if(!e.ok)console.log(new Error("Failed to fetch current version"));else return(await e.json()).version}catch(e){console.error("Current version check failed: ",e)}}async function Ca(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const a=await fetch(r,{cache:"no-store"});if(!a.ok)console.log(new Error("Failed to fetch latest version"));else{const e=await a.json();return JSON.parse(atob(e.content)).version}}catch(a){console.error("Latest version check failed: ",a)}}var Ra=E('<span class="monospace svelte-2le08x"> </span> <br>',1),Va=E("<span> </span><br>",1),Ma=E("<div>Versions:<br> <!> <!></div>"),Oa=E('<div class="settings-container hide svelte-2le08x" id="settings-container"><div class="columns svelte-2le08x"><!></div> <div class="rows svelte-2le08x"><button class="settings-button svelte-2le08x">Check for latest version</button> <button class="settings-button svelte-2le08x">Hard reload application</button></div> <br> <div class="columns svelte-2le08x"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function Pa(r,a){J(a,!1);const[e,t]=le(),s=()=>D(ee,"$currentVersion",e),i=()=>D(ae,"$latestVersion",e),n=()=>D(o,"$isNew",e),o=K(!1);(async()=>(await f(),await d()))();async function f(){const l=await Ba();ee.update(h=>l)}async function d(){const l=await Ca();ae.update(h=>l),o.update(h=>Number(ue(ae))>Number(ue(ee)))}Y();var v=Oa(),m=_(v),g=_(m);{var c=l=>{var h=Ma(),A=I(_(h),3);{var N=S=>{var B=Ra(),C=F(B),P=_(C);p(C),X(2),V(q=>M(P,`${q??""} [CURRENT]`),[()=>_e(s())],te),y(S,B)};w(A,S=>{s()&&S(N)})}var L=I(A,2);{var O=S=>{var B=Va(),C=F(B);let P;var q=_(C);p(C),X(),V((we,Se)=>{P=na(C,1,"monospace svelte-2le08x",null,P,we),M(q,`${Se??""} [LATEST]`)},[()=>({"is-new":n()}),()=>_e(i())],te),y(S,B)};w(L,S=>{i()&&S(O)})}p(h),y(l,h)};w(g,l=>{(s()||i())&&l(c)})}p(m);var u=I(m,2),b=_(u),k=I(b,2);p(u),X(4),p(v),se("click",b,()=>d()),se("click",k,()=>$a()),y(r,v),G(),t()}var Fa=E('<div class="app-wrapper svelte-lehtuv"><!> <!> <div class="app-bottom-wrapper svelte-lehtuv"><!> <!></div></div>');function Ya(r){const[a,e]=le(),t=()=>D(ie,"$selectedPage",a);var s=Fa(),i=_(s);Na(i,{});var n=I(i,2);Sa(n,{});var o=I(n,2),f=_(o);Ia(f);var d=I(f,2);{var v=m=>{Pa(m,{})};w(d,m=>{t()==="settings"&&m(v)})}p(o),p(s),y(r,s),e()}export{Ya as component};
