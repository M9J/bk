import{t as L,a as y,c as re}from"../chunks/CyOrqUXm.js";import{i as Y}from"../chunks/CL0QEqD9.js";import{A as W,l as $,a0 as $e,$ as Ce,x as Be,i as Re,g as x,N as te,y as Ve,z as ve,B as Q,m as T,ad as Me,C as be,j as ke,D as Oe,ah as Ae,a8 as Pe,F as z,ap as ce,aq as Z,a2 as de,ar as Fe,as as Te,at as je,ag as ze,au as De,k as Ue,av as He,aw as Ye,ab as Je,ax as Ge,ay as Ke,az as qe,aA as We,aj as Ne,aB as Qe,p as J,s as k,v as p,w as I,t as V,q as G,J as H,o as F,aC as Ze,aD as X}from"../chunks/DZpqQ712.js";import{p as fe,i as w,s as D,a as le,b as Xe}from"../chunks/B8VvTqyC.js";import{o as xe,w as K,g as ue}from"../chunks/HU1d89I3.js";import{l as ea,e as se,s as M}from"../chunks/DUnFqAGD.js";function ne(r,a){return a}function aa(r,a,e,t){for(var s=[],o=a.length,i=0;i<o;i++)je(a[i].e,s,!0);var l=o>0&&s.length===0&&e!==null;if(l){var n=e.parentNode;ze(n),n.append(e),t.clear(),R(r,a[0].prev,a[o-1].next)}De(s,()=>{for(var f=0;f<o;f++){var v=a[f];l||(t.delete(v.k),R(r,v.prev,v.next)),Ue(v.e,!l)}})}function oe(r,a,e,t,s,o=null){var i=r,l={flags:a,items:new Map,first:null};{var n=r;i=$?W($e(n)):n.appendChild(Ce())}$&&Be();var f=null,v=!1,m=te(()=>{var h=e();return Pe(h)?h:h==null?[]:Ae(h)});Re(()=>{var h=x(m),d=h.length;if(v&&d===0)return;v=d===0;let u=!1;if($){var _=i.data===Ve;_!==(d===0)&&(i=ve(),W(i),Q(!1),u=!0)}if($){for(var b=null,c,g=0;g<d;g++){if(T.nodeType===8&&T.data===Me){i=T,u=!0,Q(!1);break}var A=h[g],N=t(A,g);c=ye(T,l,b,null,A,N,g,s,a,e),l.items.set(N,c),b=c}d>0&&W(ve())}$||ra(h,l,i,s,a,t,e),o!==null&&(d===0?f?be(f):f=ke(()=>o(i)):f!==null&&Oe(f,()=>{f=null})),u&&Q(!0),x(m)}),$&&(i=T)}function ra(r,a,e,t,s,o,i){var l=r.length,n=a.items,f=a.first,v=f,m,h=null,d=[],u=[],_,b,c,g;for(g=0;g<l;g+=1){if(_=r[g],b=o(_,g),c=n.get(b),c===void 0){var A=v?v.e.nodes_start:e;h=ye(A,a,h,h===null?a.first:h.next,_,b,g,t,s,i),n.set(b,h),d=[],u=[],v=h.next;continue}if(ta(c,_,g),(c.e.f&Z)!==0&&be(c.e),c!==v){if(m!==void 0&&m.has(c)){if(d.length<u.length){var N=u[0],E;h=N.prev;var O=d[0],S=d[d.length-1];for(E=0;E<d.length;E+=1)he(d[E],N,e);for(E=0;E<u.length;E+=1)m.delete(u[E]);R(a,O.prev,S.next),R(a,h,O),R(a,S,N),v=N,h=S,g-=1,d=[],u=[]}else m.delete(c),he(c,v,e),R(a,c.prev,c.next),R(a,c,h===null?a.first:h.next),R(a,h,c),h=c;continue}for(d=[],u=[];v!==null&&v.k!==b;)(v.e.f&Z)===0&&(m??(m=new Set)).add(v),u.push(v),v=v.next;if(v===null)continue;c=v}d.push(c),h=c,v=c.next}if(v!==null||m!==void 0){for(var C=m===void 0?[]:Ae(m);v!==null;)(v.e.f&Z)===0&&C.push(v),v=v.next;var B=C.length;if(B>0){var P=l===0?e:null;aa(a,C,P,n)}}de.first=a.first&&a.first.e,de.last=h&&h.e}function ta(r,a,e,t){Te(r.v,a),r.i=e}function ye(r,a,e,t,s,o,i,l,n,f){var v=(n&He)!==0,m=(n&Ye)===0,h=v?m?z(s):ce(s):s,d=(n&Fe)===0?i:ce(i),u={i:d,v:h,k:o,a:null,e:null,prev:e,next:t};try{return u.e=ke(()=>l(r,h,d,f),$),u.e.prev=e&&e.e,u.e.next=t&&t.e,e===null?a.first=u:(e.next=u,e.e.next=u.e),t!==null&&(t.prev=u,t.e.prev=u.e),u}finally{}}function he(r,a,e){for(var t=r.next?r.next.e.nodes_start:e,s=a?a.e.nodes_start:e,o=r.e.nodes_start;o!==t;){var i=Je(o);s.before(o),o=i}}function R(r,a,e){a===null?r.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const ge=[...` 	
\r\fÂ \v\uFEFF`];function sa(r,a,e){var t=""+r;if(e){for(var s in e)if(e[s])t=t?t+" "+s:s;else if(t.length)for(var o=s.length,i=0;(i=t.indexOf(s,i))>=0;){var l=i+o;(i===0||ge.includes(t[i-1]))&&(l===t.length||ge.includes(t[l]))?t=(i===0?"":t.substring(0,i))+t.substring(l+1):i=l}}return t===""?null:t}function na(r,a,e,t,s,o){var i=r.__className;if($||i!==e||i===void 0){var l=sa(e,t,o);(!$||l!==r.getAttribute("class"))&&(l==null?r.removeAttribute("class"):r.className=l),r.__className=e}else if(o&&s!==o)for(var n in o){var f=!!o[n];(s==null||f!==!!s[n])&&r.classList.toggle(n,f)}return o}const oa=Symbol("is custom element"),ia=Symbol("is html");function j(r,a,e,t){var s=la(r);$&&(s[a]=r.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&r.nodeName==="LINK")||s[a]!==(s[a]=e)&&(a==="loading"&&(r[Ke]=e),e==null?r.removeAttribute(a):typeof e!="string"&&va(r).includes(a)?r[a]=e:r.setAttribute(a,e))}function la(r){return r.__attributes??(r.__attributes={[oa]:r.nodeName.includes("-"),[ia]:r.namespaceURI===Ge})}var me=new Map;function va(r){var a=me.get(r.nodeName);if(a)return a;me.set(r.nodeName,a=[]);for(var e,t=r,s=Element.prototype;s!==t;){e=We(t);for(var o in e)e[o].set&&a.push(o);t=qe(t)}return a}function Ie(r,a,e){if(r.multiple)return fa(r,a);for(var t of r.options){var s=U(t);if(Qe(s,a)){t.selected=!0;return}}(!e||a!==void 0)&&(r.selectedIndex=-1)}function ca(r,a){Ne(()=>{var e=new MutationObserver(()=>{var t=r.__value;Ie(r,t)});return e.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function da(r,a,e=a){var t=!0;ea(r,"change",s=>{var o=s?"[selected]":":checked",i;if(r.multiple)i=[].map.call(r.querySelectorAll(o),U);else{var l=r.querySelector(o)??r.querySelector("option:not([disabled])");i=l&&U(l)}e(i)}),Ne(()=>{var s=a();if(Ie(r,s,t),t&&s===void 0){var o=r.querySelector(":checked");o!==null&&(s=U(o),e(s))}r.__value=s,t=!1}),ca(r)}function fa(r,a){for(var e of r.options)e.selected=~a.indexOf(U(e))}function U(r){return"__value"in r?r.__value:r.value}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAAAAACPAi4CAAABH0lEQVRYw2NgGAVUArGNZIBYJAPa/pMB2kYNGDVg1IBRA0YNGDVg1IARacCO6KQdFBjwcpI1C6v11JfkGvC4QoWFgYFFvfoxmQYkCTGBJJmE48ky4KoNM0ya2eoqyQbc7VNnRMgzak68S5oBZzNlGJHbgYwy6WdJMWCvpyB6U1LA8xDxBszUYsNsjLLpzCHWgFoJRmzNWUbxSqIMOBLPj6tFzBd7hLABi5zYcbep2Z3nEzDgZaUmE75WOaN62WN8BhyPEiPUsBeLPoXbgEOunIS7BhxO+3EY8HKDAXG9C811L7EZcLxYnNj+iVjBEUwD1vnzE9/D4fNeiW7AfFNOUvpIHEazUA3ok2QmrZfFLN6JbIAdC+kdNRa70c4qtQAA7m/LhSePmzgAAAAASUVORK5CYII=",Ee={faviconSize:128,faviconFetchServiceURL:r=>`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${r}&size=${Ee.faviconSize}`};async function ua(){const a="/bk"+"/bookmarks";try{const e=await fetch(a+"/index.json");if(e){const t=await e.json();if(Array.isArray(t)?t.length>0:!1){const i=t.sort().map(l=>fetch(a+"/"+l+".json").then(n=>n.json()).then(n=>(n.bookmarkIndexName=l,n)));return await Promise.all(i)}}}catch(e){console.error("bookmarks folder or bookmarks/index.json not found. Error:",e)}}async function ha(r){const a={};if(Array.isArray(r)?r.length>0:!1)for(let t=0;t<r.length;t++){const s=r[t],o=s.LINK,i=s.ICON;let l="";if(i)l=i;else if(o){const n=new URL(o),f=n.protocol+"//"+n.hostname;l=Ee.faviconFetchServiceURL(f)}else l=Le;s.bookmarkIndexName&&(a[s.bookmarkIndexName]=l)}return a}var ga=L('<div class="bk-meta-info svelte-1jzx7ns"><div class="bk-name svelte-1jzx7ns"> </div> <div class="bk-link svelte-1jzx7ns"> </div></div>'),ma=L('<div class="bk-title svelte-1jzx7ns"> </div>'),pa=L('<div class="bk-desc svelte-1jzx7ns"> </div>'),_a=L('<a class="bk svelte-1jzx7ns" target="_blank" rel="noopener noreferrer"><div class="bk-meta svelte-1jzx7ns"><div class="bk-icon svelte-1jzx7ns"><img class="bk-icon-img svelte-1jzx7ns" alt="icon" width="100%" height="100%" loading="lazy"></div> <!></div> <!> <!></a>');function pe(r,a){J(a,!1);let e=fe(a,"bookmark",8),t=fe(a,"faviconLink",8);const s=e().LINK||"javascript:void(0)";let o=e().NAME||e().LINK;function i(c){const g=c==null?void 0:c.target;g&&(g.src=Le)}Y();var l=_a();j(l,"href",s),j(l,"title",o);var n=k(l),f=k(n),v=k(f);p(f);var m=I(f,2);{var h=c=>{var g=ga(),A=k(g),N=k(A,!0);p(A);var E=I(A,2),O=k(E,!0);p(E),p(g),V(()=>{M(N,e().NAME),M(O,e().LINK)}),y(c,g)};w(m,c=>{e().IS_PINNED||c(h)})}p(n);var d=I(n,2);{var u=c=>{var g=ma(),A=k(g,!0);p(g),V(()=>M(A,e().TITLE)),y(c,g)};w(d,c=>{e().TITLE&&c(u)})}var _=I(d,2);{var b=c=>{var g=pa(),A=k(g,!0);p(g),V(()=>M(A,e().DESC)),y(c,g)};w(_,c=>{e().DESC&&c(b)})}p(l),V(()=>{j(l,"data-bookmark-icon",e().ICON),j(v,"src",t())}),se("error",v,i),y(r,l),G()}var ba=L('<div class="bk-container-pinned svelte-1uu4y0a"></div>'),ka=L('<div class="bk-container-grid svelte-1uu4y0a"></div>'),Aa=L('<div class="bk-wrapper svelte-1uu4y0a"><div class="bk-container svelte-1uu4y0a"><!> <!></div></div>');function Na(r,a){J(a,!1);let e=[],t=z([]),s=z([]),o=z({});async function i(){const d=await ua();d&&(e=d.sort((_,b)=>_.NAME.localeCompare(b.NAME)),H(t,e.filter(_=>_.IS_PINNED)),H(s,e.filter(_=>!_.IS_PINNED)))}xe(async()=>{await i();const d=await ha(e);d&&H(o,d)}),Y();var l=Aa(),n=k(l),f=k(n);{var v=d=>{var u=ba();oe(u,5,()=>x(t),ne,(_,b)=>{var c=re(),g=F(c);{var A=N=>{pe(N,{get bookmark(){return x(b)},get faviconLink(){return x(o)[x(b).bookmarkIndexName]}})};w(g,N=>{x(b).bookmarkIndexName&&N(A)})}y(_,c)}),p(u),y(d,u)};w(f,d=>{x(t).length>0&&d(v)})}var m=I(f,2);{var h=d=>{var u=ka();oe(u,5,()=>x(s),ne,(_,b)=>{var c=re(),g=F(c);{var A=N=>{pe(N,{get bookmark(){return x(b)},get faviconLink(){return x(o)[x(b).bookmarkIndexName]}})};w(g,N=>{x(b).bookmarkIndexName&&N(A)})}y(_,c)}),p(u),y(d,u)};w(m,d=>{x(s).length>0&&d(h)})}p(n),p(l),y(r,l),G()}const ie=K("home"),ee=K(null),ae=K(null);var xa=L('<hr class="separator svelte-obx2py">'),ya=L('<div class="header svelte-obx2py"><a class="brand svelte-obx2py"></a> <select class="view-list svelte-obx2py" id="view-list"><option>Home</option><option>Settings</option></select></div> <!>',1);function Ia(r){const[a,e]=le(),t=()=>D(ie,"$selectedPage",a),s="https://m9j.github.io/bk";var o=ya(),i=F(o),l=k(i);j(l,"href",s),l.textContent="BOOKMARKS";var n=I(l,2);V(()=>{t(),Ze(()=>{})});var f=k(n);f.value=f.__value="home";var v=I(f);v.value=v.__value="settings",p(n),p(i);var m=I(i,2);{var h=d=>{var u=xa();y(d,u)};w(m,d=>{t()!=="home"&&d(h)})}da(n,t,d=>Xe(ie,d)),y(r,o),e()}async function La(){const a="/bk"+"/lambdas";try{const e=await fetch(a+"/index.json");if(e){const t=await e.json();if(Array.isArray(t)?t.length>0:!1){const o=t.map(i=>import(a+"/"+i+".lambda.js"));return await Promise.all(o)}}}catch(e){console.error("lambdas folder or lambdas/index.json not found. Error:",e)}}var Ea=L('<div class="lambda svelte-vmgkgn"><div class="lambda-title"> <span class="lambda-result"> </span></div></div>'),wa=L('<div class="lambdas-container svelte-vmgkgn"></div>');function Sa(r,a){J(a,!1);let e=z([]);xe(async()=>{const n=await La();if(n&&(console.log("lambdaModules",n),Array.isArray(n)?n.length>0:!1)){for(let m=0;m<2;m++)n.push(...n);const v=[];for(const m of n)v.push({...m,result:null});H(e,v),t(x(e))}});async function t(n){if(Array.isArray(n)?n.length>0:!1)for(const v of n)s(v)}async function s(n){n.action&&typeof n.action=="function"&&(n.result=n.action())}Y();var o=re(),i=F(o);{var l=n=>{var f=wa();oe(f,5,()=>x(e),ne,(v,m)=>{var h=Ea(),d=k(h),u=k(d),_=I(u),b=k(_,!0);p(_),p(d),p(h),V(()=>{M(u,`${x(m).prompt??""}: `),M(b,x(m).result)}),y(v,h)}),p(f),y(n,f)};w(i,n=>{x(e).length>0&&n(l)})}y(r,o),G()}function $a(){navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(a=>a.unregister()),console.log("All service workers have been unregistered."),caches.keys().then(a=>Promise.all(a.map(e=>caches.delete(e)))).then(()=>{console.log("All caches have been cleared."),location.reload()})})}function _e(r){if(r){const a=new Date(Number(r)),e=String(a.getFullYear()),t=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),o=String(a.getHours()).padStart(2,"0"),i=String(a.getMinutes()).padStart(2,"0"),l=String(a.getSeconds()).padStart(2,"0");return`${e}.${t}${s}.${o}${i}${l}`}}async function Ca(){const a="/bk"+"/version.json";try{const e=await fetch(a);if(!e.ok)console.log(new Error("Failed to fetch current version"));else return(await e.json()).version}catch(e){console.error("Current version check failed: ",e)}}async function Ba(){const r="https://api.github.com/repos/m9j/bk/contents/version.json?ref=gh-pages";try{const a=await fetch(r,{cache:"no-store"});if(!a.ok)console.log(new Error("Failed to fetch latest version"));else{const e=await a.json();return JSON.parse(atob(e.content)).version}}catch(a){console.error("Latest version check failed: ",a)}}var Ra=L('<span class="monospace svelte-2le08x"> </span> <br>',1),Va=L("<span> </span><br>",1),Ma=L("<div>Versions:<br> <!> <!></div>"),Oa=L('<div class="settings-container hide svelte-2le08x" id="settings-container"><div class="columns svelte-2le08x"><!></div> <div class="rows svelte-2le08x"><button class="settings-button svelte-2le08x">Check for latest version</button> <button class="settings-button svelte-2le08x">Hard reload application</button></div> <br> <div class="columns svelte-2le08x"><div>Repo deploy status:</div> <div><img src="https://github.com/m9j/bk/actions/workflows/deploy.yml/badge.svg" alt="Github Deploy Status"></div></div></div>');function Pa(r,a){J(a,!1);const[e,t]=le(),s=()=>D(ee,"$currentVersion",e),o=()=>D(ae,"$latestVersion",e),i=()=>D(l,"$isNew",e),l=K(!1);(async()=>(await n(),await f()))();async function n(){const c=await Ca();ee.update(g=>c)}async function f(){const c=await Ba();ae.update(g=>c),l.update(g=>Number(ue(ae))>Number(ue(ee)))}Y();var v=Oa(),m=k(v),h=k(m);{var d=c=>{var g=Ma(),A=I(k(g),3);{var N=S=>{var C=Ra(),B=F(C),P=k(B);p(B),X(2),V(q=>M(P,`${q??""} [CURRENT]`),[()=>_e(s())],te),y(S,C)};w(A,S=>{s()&&S(N)})}var E=I(A,2);{var O=S=>{var C=Va(),B=F(C);let P;var q=k(B);p(B),X(),V((we,Se)=>{P=na(B,1,"monospace svelte-2le08x",null,P,we),M(q,`${Se??""} [LATEST]`)},[()=>({"is-new":i()}),()=>_e(o())],te),y(S,C)};w(E,S=>{o()&&S(O)})}p(g),y(c,g)};w(h,c=>{(s()||o())&&c(d)})}p(m);var u=I(m,2),_=k(u),b=I(_,2);p(u),X(4),p(v),se("click",_,()=>f()),se("click",b,()=>$a()),y(r,v),G(),t()}var Fa=L('<div class="app-wrapper svelte-lehtuv"><!> <!> <div class="app-bottom-wrapper svelte-lehtuv"><!> <!></div></div>');function Ya(r){const[a,e]=le(),t=()=>D(ie,"$selectedPage",a);var s=Fa(),o=k(s);Na(o,{});var i=I(o,2);Sa(i,{});var l=I(i,2),n=k(l);Ia(n);var f=I(n,2);{var v=m=>{Pa(m,{})};w(f,m=>{t()==="settings"&&m(v)})}p(l),p(s),y(r,s),e()}export{Ya as component};
